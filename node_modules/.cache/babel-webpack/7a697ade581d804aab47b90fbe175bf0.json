{"ast":null,"code":"\"use strict\";\n\nvar _createForOfIteratorHelper = require(\"/Users/abdillahihussein/Documents/GitHub/angularProject/node_modules/@babel/runtime/helpers/createForOfIteratorHelper\");\n\nvar _inherits = require(\"/Users/abdillahihussein/Documents/GitHub/angularProject/node_modules/@babel/runtime/helpers/inherits\");\n\nvar _createSuper = require(\"/Users/abdillahihussein/Documents/GitHub/angularProject/node_modules/@babel/runtime/helpers/createSuper\");\n\nvar _classCallCheck = require(\"/Users/abdillahihussein/Documents/GitHub/angularProject/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/Users/abdillahihussein/Documents/GitHub/angularProject/node_modules/@babel/runtime/helpers/createClass\");\n\nvar _regeneratorRuntime = require(\"/Users/abdillahihussein/Documents/GitHub/angularProject/node_modules/@babel/runtime/regenerator\");\n\nvar _marked = /*#__PURE__*/_regeneratorRuntime.mark(calculateThresholds),\n    _marked2 = /*#__PURE__*/_regeneratorRuntime.mark(checkBudgets),\n    _marked3 = /*#__PURE__*/_regeneratorRuntime.mark(checkThresholds);\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.checkThresholds = exports.checkBudgets = exports.calculateThresholds = exports.ThresholdSeverity = void 0;\n\nvar schema_1 = require(\"../browser/schema\");\n\nvar stats_1 = require(\"../webpack/utils/stats\");\n\nvar ThresholdType;\n\n(function (ThresholdType) {\n  ThresholdType[\"Max\"] = \"maximum\";\n  ThresholdType[\"Min\"] = \"minimum\";\n})(ThresholdType || (ThresholdType = {}));\n\nvar ThresholdSeverity;\n\n(function (ThresholdSeverity) {\n  ThresholdSeverity[\"Warning\"] = \"warning\";\n  ThresholdSeverity[\"Error\"] = \"error\";\n})(ThresholdSeverity = exports.ThresholdSeverity || (exports.ThresholdSeverity = {}));\n\nvar DifferentialBuildType;\n\n(function (DifferentialBuildType) {\n  // FIXME: this should match the actual file suffix and not hardcoded.\n  DifferentialBuildType[\"ORIGINAL\"] = \"es2015\";\n  DifferentialBuildType[\"DOWNLEVEL\"] = \"es5\";\n})(DifferentialBuildType || (DifferentialBuildType = {}));\n\nfunction calculateThresholds(budget) {\n  return _regeneratorRuntime.wrap(function calculateThresholds$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          if (!budget.maximumWarning) {\n            _context.next = 3;\n            break;\n          }\n\n          _context.next = 3;\n          return {\n            limit: calculateBytes(budget.maximumWarning, budget.baseline, 1),\n            type: ThresholdType.Max,\n            severity: ThresholdSeverity.Warning\n          };\n\n        case 3:\n          if (!budget.maximumError) {\n            _context.next = 6;\n            break;\n          }\n\n          _context.next = 6;\n          return {\n            limit: calculateBytes(budget.maximumError, budget.baseline, 1),\n            type: ThresholdType.Max,\n            severity: ThresholdSeverity.Error\n          };\n\n        case 6:\n          if (!budget.minimumWarning) {\n            _context.next = 9;\n            break;\n          }\n\n          _context.next = 9;\n          return {\n            limit: calculateBytes(budget.minimumWarning, budget.baseline, -1),\n            type: ThresholdType.Min,\n            severity: ThresholdSeverity.Warning\n          };\n\n        case 9:\n          if (!budget.minimumError) {\n            _context.next = 12;\n            break;\n          }\n\n          _context.next = 12;\n          return {\n            limit: calculateBytes(budget.minimumError, budget.baseline, -1),\n            type: ThresholdType.Min,\n            severity: ThresholdSeverity.Error\n          };\n\n        case 12:\n          if (!budget.warning) {\n            _context.next = 17;\n            break;\n          }\n\n          _context.next = 15;\n          return {\n            limit: calculateBytes(budget.warning, budget.baseline, -1),\n            type: ThresholdType.Min,\n            severity: ThresholdSeverity.Warning\n          };\n\n        case 15:\n          _context.next = 17;\n          return {\n            limit: calculateBytes(budget.warning, budget.baseline, 1),\n            type: ThresholdType.Max,\n            severity: ThresholdSeverity.Warning\n          };\n\n        case 17:\n          if (!budget.error) {\n            _context.next = 22;\n            break;\n          }\n\n          _context.next = 20;\n          return {\n            limit: calculateBytes(budget.error, budget.baseline, -1),\n            type: ThresholdType.Min,\n            severity: ThresholdSeverity.Error\n          };\n\n        case 20:\n          _context.next = 22;\n          return {\n            limit: calculateBytes(budget.error, budget.baseline, 1),\n            type: ThresholdType.Max,\n            severity: ThresholdSeverity.Error\n          };\n\n        case 22:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, _marked);\n}\n\nexports.calculateThresholds = calculateThresholds;\n/**\n * Calculates the sizes for bundles in the budget type provided.\n */\n\nfunction calculateSizes(budget, stats, processResults) {\n  if (budget.type === schema_1.Type.AnyComponentStyle) {\n    // Component style size information is not available post-build, this must\n    // be checked mid-build via the `AnyComponentStyleBudgetChecker` plugin.\n    throw new Error('Can not calculate size of AnyComponentStyle. Use `AnyComponentStyleBudgetChecker` instead.');\n  }\n\n  var calculatorMap = {\n    all: AllCalculator,\n    allScript: AllScriptCalculator,\n    any: AnyCalculator,\n    anyScript: AnyScriptCalculator,\n    bundle: BundleCalculator,\n    initial: InitialCalculator\n  };\n  var ctor = calculatorMap[budget.type];\n  var chunks = stats.chunks,\n      assets = stats.assets;\n\n  if (!chunks) {\n    throw new Error('Webpack stats output did not include chunk information.');\n  }\n\n  if (!assets) {\n    throw new Error('Webpack stats output did not include asset information.');\n  }\n\n  var calculator = new ctor(budget, chunks, assets, processResults);\n  return calculator.calculate();\n}\n\nvar Calculator = /*#__PURE__*/function () {\n  function Calculator(budget, chunks, assets, processResults) {\n    _classCallCheck(this, Calculator);\n\n    this.budget = budget;\n    this.chunks = chunks;\n    this.assets = assets;\n    this.processResults = processResults;\n  }\n  /** Calculates the size of the given chunk for the provided build type. */\n\n\n  _createClass(Calculator, [{\n    key: \"calculateChunkSize\",\n    value: function calculateChunkSize(chunk, buildType) {\n      var _this = this;\n\n      // Look for a process result containing different builds for this chunk.\n      var processResult = this.processResults.find(function (processResult) {\n        return processResult.name === chunk.id.toString();\n      });\n\n      if (processResult) {\n        // Found a differential build, use the correct size information.\n        var processResultFile = getDifferentialBuildResult(processResult, buildType);\n        return processResultFile && processResultFile.size || 0;\n      } else {\n        // No differential builds, get the chunk size by summing its assets.\n        return chunk.files.filter(function (file) {\n          return !file.endsWith('.map');\n        }).map(function (file) {\n          var asset = _this.assets.find(function (asset) {\n            return asset.name === file;\n          });\n\n          if (!asset) {\n            throw new Error(\"Could not find asset for file: \".concat(file));\n          }\n\n          return asset.size;\n        }).reduce(function (l, r) {\n          return l + r;\n        }, 0);\n      }\n    }\n  }]);\n\n  return Calculator;\n}();\n/**\n * A named bundle.\n */\n\n\nvar BundleCalculator = /*#__PURE__*/function (_Calculator) {\n  _inherits(BundleCalculator, _Calculator);\n\n  var _super = _createSuper(BundleCalculator);\n\n  function BundleCalculator() {\n    _classCallCheck(this, BundleCalculator);\n\n    return _super.apply(this, arguments);\n  }\n\n  _createClass(BundleCalculator, [{\n    key: \"calculate\",\n    value: function calculate() {\n      var _this2 = this;\n\n      var budgetName = this.budget.name;\n\n      if (!budgetName) {\n        return [];\n      } // The chunk may or may not have differential builds. Compute the size for\n      // each then check afterwards if they are all the same.\n\n\n      var buildSizes = Object.values(DifferentialBuildType).map(function (buildType) {\n        var size = _this2.chunks.filter(function (chunk) {\n          return chunk.names.indexOf(budgetName) !== -1;\n        }).map(function (chunk) {\n          return _this2.calculateChunkSize(chunk, buildType);\n        }).reduce(function (l, r) {\n          return l + r;\n        }, 0);\n\n        return {\n          size: size,\n          label: \"bundle \".concat(_this2.budget.name, \"-\").concat(buildType)\n        };\n      }); // If this bundle was not actually generated by a differential build, then\n      // merge the results into a single value.\n\n      if (allEquivalent(buildSizes.map(function (buildSize) {\n        return buildSize.size;\n      }))) {\n        return mergeDifferentialBuildSizes(buildSizes, budgetName);\n      } else {\n        return buildSizes;\n      }\n    }\n  }]);\n\n  return BundleCalculator;\n}(Calculator);\n/**\n * The sum of all initial chunks (marked as initial).\n */\n\n\nvar InitialCalculator = /*#__PURE__*/function (_Calculator2) {\n  _inherits(InitialCalculator, _Calculator2);\n\n  var _super2 = _createSuper(InitialCalculator);\n\n  function InitialCalculator() {\n    _classCallCheck(this, InitialCalculator);\n\n    return _super2.apply(this, arguments);\n  }\n\n  _createClass(InitialCalculator, [{\n    key: \"calculate\",\n    value: function calculate() {\n      var _this3 = this;\n\n      var buildSizes = Object.values(DifferentialBuildType).map(function (buildType) {\n        return {\n          label: \"bundle initial-\".concat(buildType),\n          size: _this3.chunks.filter(function (chunk) {\n            return chunk.initial;\n          }).map(function (chunk) {\n            return _this3.calculateChunkSize(chunk, buildType);\n          }).reduce(function (l, r) {\n            return l + r;\n          }, 0)\n        };\n      }); // If this bundle was not actually generated by a differential build, then\n      // merge the results into a single value.\n\n      if (allEquivalent(buildSizes.map(function (buildSize) {\n        return buildSize.size;\n      }))) {\n        return mergeDifferentialBuildSizes(buildSizes, 'initial');\n      } else {\n        return buildSizes;\n      }\n    }\n  }]);\n\n  return InitialCalculator;\n}(Calculator);\n/**\n * The sum of all the scripts portions.\n */\n\n\nvar AllScriptCalculator = /*#__PURE__*/function (_Calculator3) {\n  _inherits(AllScriptCalculator, _Calculator3);\n\n  var _super3 = _createSuper(AllScriptCalculator);\n\n  function AllScriptCalculator() {\n    _classCallCheck(this, AllScriptCalculator);\n\n    return _super3.apply(this, arguments);\n  }\n\n  _createClass(AllScriptCalculator, [{\n    key: \"calculate\",\n    value: function calculate() {\n      var size = this.assets.filter(function (asset) {\n        return asset.name.endsWith('.js');\n      }).map(function (asset) {\n        return asset.size;\n      }).reduce(function (total, size) {\n        return total + size;\n      }, 0);\n      return [{\n        size: size,\n        label: 'total scripts'\n      }];\n    }\n  }]);\n\n  return AllScriptCalculator;\n}(Calculator);\n/**\n * All scripts and assets added together.\n */\n\n\nvar AllCalculator = /*#__PURE__*/function (_Calculator4) {\n  _inherits(AllCalculator, _Calculator4);\n\n  var _super4 = _createSuper(AllCalculator);\n\n  function AllCalculator() {\n    _classCallCheck(this, AllCalculator);\n\n    return _super4.apply(this, arguments);\n  }\n\n  _createClass(AllCalculator, [{\n    key: \"calculate\",\n    value: function calculate() {\n      var size = this.assets.filter(function (asset) {\n        return !asset.name.endsWith('.map');\n      }).map(function (asset) {\n        return asset.size;\n      }).reduce(function (total, size) {\n        return total + size;\n      }, 0);\n      return [{\n        size: size,\n        label: 'total'\n      }];\n    }\n  }]);\n\n  return AllCalculator;\n}(Calculator);\n/**\n * Any script, individually.\n */\n\n\nvar AnyScriptCalculator = /*#__PURE__*/function (_Calculator5) {\n  _inherits(AnyScriptCalculator, _Calculator5);\n\n  var _super5 = _createSuper(AnyScriptCalculator);\n\n  function AnyScriptCalculator() {\n    _classCallCheck(this, AnyScriptCalculator);\n\n    return _super5.apply(this, arguments);\n  }\n\n  _createClass(AnyScriptCalculator, [{\n    key: \"calculate\",\n    value: function calculate() {\n      return this.assets.filter(function (asset) {\n        return asset.name.endsWith('.js');\n      }).map(function (asset) {\n        return {\n          size: asset.size,\n          label: asset.name\n        };\n      });\n    }\n  }]);\n\n  return AnyScriptCalculator;\n}(Calculator);\n/**\n * Any script or asset (images, css, etc).\n */\n\n\nvar AnyCalculator = /*#__PURE__*/function (_Calculator6) {\n  _inherits(AnyCalculator, _Calculator6);\n\n  var _super6 = _createSuper(AnyCalculator);\n\n  function AnyCalculator() {\n    _classCallCheck(this, AnyCalculator);\n\n    return _super6.apply(this, arguments);\n  }\n\n  _createClass(AnyCalculator, [{\n    key: \"calculate\",\n    value: function calculate() {\n      return this.assets.filter(function (asset) {\n        return !asset.name.endsWith('.map');\n      }).map(function (asset) {\n        return {\n          size: asset.size,\n          label: asset.name\n        };\n      });\n    }\n  }]);\n\n  return AnyCalculator;\n}(Calculator);\n/**\n * Calculate the bytes given a string value.\n */\n\n\nfunction calculateBytes(input, baseline) {\n  var factor = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n  var matches = input.match(/^\\s*(\\d+(?:\\.\\d+)?)\\s*(%|(?:[mM]|[kK]|[gG])?[bB])?\\s*$/);\n\n  if (!matches) {\n    return NaN;\n  }\n\n  var baselineBytes = baseline && calculateBytes(baseline) || 0;\n  var value = Number(matches[1]);\n\n  switch (matches[2] && matches[2].toLowerCase()) {\n    case '%':\n      value = baselineBytes * value / 100;\n      break;\n\n    case 'kb':\n      value *= 1024;\n      break;\n\n    case 'mb':\n      value *= 1024 * 1024;\n      break;\n\n    case 'gb':\n      value *= 1024 * 1024 * 1024;\n      break;\n  }\n\n  if (baselineBytes === 0) {\n    return value;\n  }\n\n  return baselineBytes + value * factor;\n}\n\nfunction checkBudgets(budgets, webpackStats, processResults) {\n  var computableBudgets, _iterator, _step, budget, sizes, _iterator2, _step2, _step2$value, size, label;\n\n  return _regeneratorRuntime.wrap(function checkBudgets$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          // Ignore AnyComponentStyle budgets as these are handled in `AnyComponentStyleBudgetChecker`.\n          computableBudgets = budgets.filter(function (budget) {\n            return budget.type !== schema_1.Type.AnyComponentStyle;\n          });\n          _iterator = _createForOfIteratorHelper(computableBudgets);\n          _context2.prev = 2;\n\n          _iterator.s();\n\n        case 4:\n          if ((_step = _iterator.n()).done) {\n            _context2.next = 25;\n            break;\n          }\n\n          budget = _step.value;\n          sizes = calculateSizes(budget, webpackStats, processResults);\n          _iterator2 = _createForOfIteratorHelper(sizes);\n          _context2.prev = 8;\n\n          _iterator2.s();\n\n        case 10:\n          if ((_step2 = _iterator2.n()).done) {\n            _context2.next = 15;\n            break;\n          }\n\n          _step2$value = _step2.value, size = _step2$value.size, label = _step2$value.label;\n          return _context2.delegateYield(checkThresholds(calculateThresholds(budget), size, label), \"t0\", 13);\n\n        case 13:\n          _context2.next = 10;\n          break;\n\n        case 15:\n          _context2.next = 20;\n          break;\n\n        case 17:\n          _context2.prev = 17;\n          _context2.t1 = _context2[\"catch\"](8);\n\n          _iterator2.e(_context2.t1);\n\n        case 20:\n          _context2.prev = 20;\n\n          _iterator2.f();\n\n          return _context2.finish(20);\n\n        case 23:\n          _context2.next = 4;\n          break;\n\n        case 25:\n          _context2.next = 30;\n          break;\n\n        case 27:\n          _context2.prev = 27;\n          _context2.t2 = _context2[\"catch\"](2);\n\n          _iterator.e(_context2.t2);\n\n        case 30:\n          _context2.prev = 30;\n\n          _iterator.f();\n\n          return _context2.finish(30);\n\n        case 33:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, _marked2, null, [[2, 27, 30, 33], [8, 17, 20, 23]]);\n}\n\nexports.checkBudgets = checkBudgets;\n\nfunction checkThresholds(thresholds, size, label) {\n  var _iterator3, _step3, threshold, sizeDifference, _sizeDifference;\n\n  return _regeneratorRuntime.wrap(function checkThresholds$(_context3) {\n    while (1) {\n      switch (_context3.prev = _context3.next) {\n        case 0:\n          _iterator3 = _createForOfIteratorHelper(thresholds);\n          _context3.prev = 1;\n\n          _iterator3.s();\n\n        case 3:\n          if ((_step3 = _iterator3.n()).done) {\n            _context3.next = 23;\n            break;\n          }\n\n          threshold = _step3.value;\n          _context3.t0 = threshold.type;\n          _context3.next = _context3.t0 === ThresholdType.Max ? 8 : _context3.t0 === ThresholdType.Min ? 14 : 20;\n          break;\n\n        case 8:\n          if (!(size <= threshold.limit)) {\n            _context3.next = 10;\n            break;\n          }\n\n          return _context3.abrupt(\"continue\", 21);\n\n        case 10:\n          sizeDifference = stats_1.formatSize(size - threshold.limit);\n          _context3.next = 13;\n          return {\n            severity: threshold.severity,\n            message: \"\".concat(label, \" exceeded maximum budget. Budget \").concat(stats_1.formatSize(threshold.limit), \" was not met by \").concat(sizeDifference, \" with a total of \").concat(stats_1.formatSize(size), \".\")\n          };\n\n        case 13:\n          return _context3.abrupt(\"break\", 21);\n\n        case 14:\n          if (!(size >= threshold.limit)) {\n            _context3.next = 16;\n            break;\n          }\n\n          return _context3.abrupt(\"continue\", 21);\n\n        case 16:\n          _sizeDifference = stats_1.formatSize(threshold.limit - size);\n          _context3.next = 19;\n          return {\n            severity: threshold.severity,\n            message: \"\".concat(label, \" failed to meet minimum budget. Budget \").concat(stats_1.formatSize(threshold.limit), \" was not met by \").concat(_sizeDifference, \" with a total of \").concat(stats_1.formatSize(size), \".\")\n          };\n\n        case 19:\n          return _context3.abrupt(\"break\", 21);\n\n        case 20:\n          throw new Error(\"Unexpected threshold type: \".concat(ThresholdType[threshold.type]));\n\n        case 21:\n          _context3.next = 3;\n          break;\n\n        case 23:\n          _context3.next = 28;\n          break;\n\n        case 25:\n          _context3.prev = 25;\n          _context3.t1 = _context3[\"catch\"](1);\n\n          _iterator3.e(_context3.t1);\n\n        case 28:\n          _context3.prev = 28;\n\n          _iterator3.f();\n\n          return _context3.finish(28);\n\n        case 31:\n        case \"end\":\n          return _context3.stop();\n      }\n    }\n  }, _marked3, null, [[1, 25, 28, 31]]);\n}\n\nexports.checkThresholds = checkThresholds;\n/** Returns the {@link ProcessBundleFile} for the given {@link DifferentialBuildType}. */\n\nfunction getDifferentialBuildResult(processResult, buildType) {\n  switch (buildType) {\n    case DifferentialBuildType.ORIGINAL:\n      return processResult.original || null;\n\n    case DifferentialBuildType.DOWNLEVEL:\n      return processResult.downlevel || null;\n  }\n}\n/**\n * Merges the given differential builds into a single, non-differential value.\n *\n * Preconditions: All the sizes should be equivalent, or else they represent\n * differential builds.\n */\n\n\nfunction mergeDifferentialBuildSizes(buildSizes, mergeLabel) {\n  if (buildSizes.length === 0) {\n    return [];\n  } // Only one size.\n\n\n  return [{\n    label: mergeLabel,\n    size: buildSizes[0].size\n  }];\n}\n/** Returns whether or not all items in the list are equivalent to each other. */\n\n\nfunction allEquivalent(items) {\n  return new Set(items).size < 2;\n}","map":{"version":3,"sources":["/Users/abdillahihussein/Documents/GitHub/angularProject/node_modules/@angular-devkit/build-angular/src/utils/bundle-calculator.js"],"names":["calculateThresholds","checkBudgets","checkThresholds","Object","defineProperty","exports","value","ThresholdSeverity","schema_1","require","stats_1","ThresholdType","DifferentialBuildType","budget","maximumWarning","limit","calculateBytes","baseline","type","Max","severity","Warning","maximumError","Error","minimumWarning","Min","minimumError","warning","error","calculateSizes","stats","processResults","Type","AnyComponentStyle","calculatorMap","all","AllCalculator","allScript","AllScriptCalculator","any","AnyCalculator","anyScript","AnyScriptCalculator","bundle","BundleCalculator","initial","InitialCalculator","ctor","chunks","assets","calculator","calculate","Calculator","chunk","buildType","processResult","find","name","id","toString","processResultFile","getDifferentialBuildResult","size","files","filter","file","endsWith","map","asset","reduce","l","r","budgetName","buildSizes","values","names","indexOf","calculateChunkSize","label","allEquivalent","buildSize","mergeDifferentialBuildSizes","total","input","factor","matches","match","NaN","baselineBytes","Number","toLowerCase","budgets","webpackStats","computableBudgets","sizes","thresholds","threshold","sizeDifference","formatSize","message","ORIGINAL","original","DOWNLEVEL","downlevel","mergeLabel","length","items","Set"],"mappings":"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","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.checkThresholds = exports.checkBudgets = exports.calculateThresholds = exports.ThresholdSeverity = void 0;\nconst schema_1 = require(\"../browser/schema\");\nconst stats_1 = require(\"../webpack/utils/stats\");\nvar ThresholdType;\n(function (ThresholdType) {\n    ThresholdType[\"Max\"] = \"maximum\";\n    ThresholdType[\"Min\"] = \"minimum\";\n})(ThresholdType || (ThresholdType = {}));\nvar ThresholdSeverity;\n(function (ThresholdSeverity) {\n    ThresholdSeverity[\"Warning\"] = \"warning\";\n    ThresholdSeverity[\"Error\"] = \"error\";\n})(ThresholdSeverity = exports.ThresholdSeverity || (exports.ThresholdSeverity = {}));\nvar DifferentialBuildType;\n(function (DifferentialBuildType) {\n    // FIXME: this should match the actual file suffix and not hardcoded.\n    DifferentialBuildType[\"ORIGINAL\"] = \"es2015\";\n    DifferentialBuildType[\"DOWNLEVEL\"] = \"es5\";\n})(DifferentialBuildType || (DifferentialBuildType = {}));\nfunction* calculateThresholds(budget) {\n    if (budget.maximumWarning) {\n        yield {\n            limit: calculateBytes(budget.maximumWarning, budget.baseline, 1),\n            type: ThresholdType.Max,\n            severity: ThresholdSeverity.Warning,\n        };\n    }\n    if (budget.maximumError) {\n        yield {\n            limit: calculateBytes(budget.maximumError, budget.baseline, 1),\n            type: ThresholdType.Max,\n            severity: ThresholdSeverity.Error,\n        };\n    }\n    if (budget.minimumWarning) {\n        yield {\n            limit: calculateBytes(budget.minimumWarning, budget.baseline, -1),\n            type: ThresholdType.Min,\n            severity: ThresholdSeverity.Warning,\n        };\n    }\n    if (budget.minimumError) {\n        yield {\n            limit: calculateBytes(budget.minimumError, budget.baseline, -1),\n            type: ThresholdType.Min,\n            severity: ThresholdSeverity.Error,\n        };\n    }\n    if (budget.warning) {\n        yield {\n            limit: calculateBytes(budget.warning, budget.baseline, -1),\n            type: ThresholdType.Min,\n            severity: ThresholdSeverity.Warning,\n        };\n        yield {\n            limit: calculateBytes(budget.warning, budget.baseline, 1),\n            type: ThresholdType.Max,\n            severity: ThresholdSeverity.Warning,\n        };\n    }\n    if (budget.error) {\n        yield {\n            limit: calculateBytes(budget.error, budget.baseline, -1),\n            type: ThresholdType.Min,\n            severity: ThresholdSeverity.Error,\n        };\n        yield {\n            limit: calculateBytes(budget.error, budget.baseline, 1),\n            type: ThresholdType.Max,\n            severity: ThresholdSeverity.Error,\n        };\n    }\n}\nexports.calculateThresholds = calculateThresholds;\n/**\n * Calculates the sizes for bundles in the budget type provided.\n */\nfunction calculateSizes(budget, stats, processResults) {\n    if (budget.type === schema_1.Type.AnyComponentStyle) {\n        // Component style size information is not available post-build, this must\n        // be checked mid-build via the `AnyComponentStyleBudgetChecker` plugin.\n        throw new Error('Can not calculate size of AnyComponentStyle. Use `AnyComponentStyleBudgetChecker` instead.');\n    }\n    const calculatorMap = {\n        all: AllCalculator,\n        allScript: AllScriptCalculator,\n        any: AnyCalculator,\n        anyScript: AnyScriptCalculator,\n        bundle: BundleCalculator,\n        initial: InitialCalculator,\n    };\n    const ctor = calculatorMap[budget.type];\n    const { chunks, assets } = stats;\n    if (!chunks) {\n        throw new Error('Webpack stats output did not include chunk information.');\n    }\n    if (!assets) {\n        throw new Error('Webpack stats output did not include asset information.');\n    }\n    const calculator = new ctor(budget, chunks, assets, processResults);\n    return calculator.calculate();\n}\nclass Calculator {\n    constructor(budget, chunks, assets, processResults) {\n        this.budget = budget;\n        this.chunks = chunks;\n        this.assets = assets;\n        this.processResults = processResults;\n    }\n    /** Calculates the size of the given chunk for the provided build type. */\n    calculateChunkSize(chunk, buildType) {\n        // Look for a process result containing different builds for this chunk.\n        const processResult = this.processResults\n            .find((processResult) => processResult.name === chunk.id.toString());\n        if (processResult) {\n            // Found a differential build, use the correct size information.\n            const processResultFile = getDifferentialBuildResult(processResult, buildType);\n            return processResultFile && processResultFile.size || 0;\n        }\n        else {\n            // No differential builds, get the chunk size by summing its assets.\n            return chunk.files\n                .filter(file => !file.endsWith('.map'))\n                .map(file => {\n                const asset = this.assets.find((asset) => asset.name === file);\n                if (!asset) {\n                    throw new Error(`Could not find asset for file: ${file}`);\n                }\n                return asset.size;\n            })\n                .reduce((l, r) => l + r, 0);\n        }\n    }\n}\n/**\n * A named bundle.\n */\nclass BundleCalculator extends Calculator {\n    calculate() {\n        const budgetName = this.budget.name;\n        if (!budgetName) {\n            return [];\n        }\n        // The chunk may or may not have differential builds. Compute the size for\n        // each then check afterwards if they are all the same.\n        const buildSizes = Object.values(DifferentialBuildType).map((buildType) => {\n            const size = this.chunks\n                .filter(chunk => chunk.names.indexOf(budgetName) !== -1)\n                .map(chunk => this.calculateChunkSize(chunk, buildType))\n                .reduce((l, r) => l + r, 0);\n            return { size, label: `bundle ${this.budget.name}-${buildType}` };\n        });\n        // If this bundle was not actually generated by a differential build, then\n        // merge the results into a single value.\n        if (allEquivalent(buildSizes.map((buildSize) => buildSize.size))) {\n            return mergeDifferentialBuildSizes(buildSizes, budgetName);\n        }\n        else {\n            return buildSizes;\n        }\n    }\n}\n/**\n * The sum of all initial chunks (marked as initial).\n */\nclass InitialCalculator extends Calculator {\n    calculate() {\n        const buildSizes = Object.values(DifferentialBuildType).map((buildType) => {\n            return {\n                label: `bundle initial-${buildType}`,\n                size: this.chunks\n                    .filter(chunk => chunk.initial)\n                    .map(chunk => this.calculateChunkSize(chunk, buildType))\n                    .reduce((l, r) => l + r, 0),\n            };\n        });\n        // If this bundle was not actually generated by a differential build, then\n        // merge the results into a single value.\n        if (allEquivalent(buildSizes.map((buildSize) => buildSize.size))) {\n            return mergeDifferentialBuildSizes(buildSizes, 'initial');\n        }\n        else {\n            return buildSizes;\n        }\n    }\n}\n/**\n * The sum of all the scripts portions.\n */\nclass AllScriptCalculator extends Calculator {\n    calculate() {\n        const size = this.assets\n            .filter(asset => asset.name.endsWith('.js'))\n            .map(asset => asset.size)\n            .reduce((total, size) => total + size, 0);\n        return [{ size, label: 'total scripts' }];\n    }\n}\n/**\n * All scripts and assets added together.\n */\nclass AllCalculator extends Calculator {\n    calculate() {\n        const size = this.assets\n            .filter(asset => !asset.name.endsWith('.map'))\n            .map(asset => asset.size)\n            .reduce((total, size) => total + size, 0);\n        return [{ size, label: 'total' }];\n    }\n}\n/**\n * Any script, individually.\n */\nclass AnyScriptCalculator extends Calculator {\n    calculate() {\n        return this.assets\n            .filter(asset => asset.name.endsWith('.js'))\n            .map(asset => ({\n            size: asset.size,\n            label: asset.name,\n        }));\n    }\n}\n/**\n * Any script or asset (images, css, etc).\n */\nclass AnyCalculator extends Calculator {\n    calculate() {\n        return this.assets\n            .filter(asset => !asset.name.endsWith('.map'))\n            .map(asset => ({\n            size: asset.size,\n            label: asset.name,\n        }));\n    }\n}\n/**\n * Calculate the bytes given a string value.\n */\nfunction calculateBytes(input, baseline, factor = 1) {\n    const matches = input.match(/^\\s*(\\d+(?:\\.\\d+)?)\\s*(%|(?:[mM]|[kK]|[gG])?[bB])?\\s*$/);\n    if (!matches) {\n        return NaN;\n    }\n    const baselineBytes = baseline && calculateBytes(baseline) || 0;\n    let value = Number(matches[1]);\n    switch (matches[2] && matches[2].toLowerCase()) {\n        case '%':\n            value = baselineBytes * value / 100;\n            break;\n        case 'kb':\n            value *= 1024;\n            break;\n        case 'mb':\n            value *= 1024 * 1024;\n            break;\n        case 'gb':\n            value *= 1024 * 1024 * 1024;\n            break;\n    }\n    if (baselineBytes === 0) {\n        return value;\n    }\n    return baselineBytes + value * factor;\n}\nfunction* checkBudgets(budgets, webpackStats, processResults) {\n    // Ignore AnyComponentStyle budgets as these are handled in `AnyComponentStyleBudgetChecker`.\n    const computableBudgets = budgets.filter((budget) => budget.type !== schema_1.Type.AnyComponentStyle);\n    for (const budget of computableBudgets) {\n        const sizes = calculateSizes(budget, webpackStats, processResults);\n        for (const { size, label } of sizes) {\n            yield* checkThresholds(calculateThresholds(budget), size, label);\n        }\n    }\n}\nexports.checkBudgets = checkBudgets;\nfunction* checkThresholds(thresholds, size, label) {\n    for (const threshold of thresholds) {\n        switch (threshold.type) {\n            case ThresholdType.Max: {\n                if (size <= threshold.limit) {\n                    continue;\n                }\n                const sizeDifference = stats_1.formatSize(size - threshold.limit);\n                yield {\n                    severity: threshold.severity,\n                    message: `${label} exceeded maximum budget. Budget ${stats_1.formatSize(threshold.limit)} was not met by ${sizeDifference} with a total of ${stats_1.formatSize(size)}.`,\n                };\n                break;\n            }\n            case ThresholdType.Min: {\n                if (size >= threshold.limit) {\n                    continue;\n                }\n                const sizeDifference = stats_1.formatSize(threshold.limit - size);\n                yield {\n                    severity: threshold.severity,\n                    message: `${label} failed to meet minimum budget. Budget ${stats_1.formatSize(threshold.limit)} was not met by ${sizeDifference} with a total of ${stats_1.formatSize(size)}.`,\n                };\n                break;\n            }\n            default: {\n                throw new Error(`Unexpected threshold type: ${ThresholdType[threshold.type]}`);\n            }\n        }\n    }\n}\nexports.checkThresholds = checkThresholds;\n/** Returns the {@link ProcessBundleFile} for the given {@link DifferentialBuildType}. */\nfunction getDifferentialBuildResult(processResult, buildType) {\n    switch (buildType) {\n        case DifferentialBuildType.ORIGINAL: return processResult.original || null;\n        case DifferentialBuildType.DOWNLEVEL: return processResult.downlevel || null;\n    }\n}\n/**\n * Merges the given differential builds into a single, non-differential value.\n *\n * Preconditions: All the sizes should be equivalent, or else they represent\n * differential builds.\n */\nfunction mergeDifferentialBuildSizes(buildSizes, mergeLabel) {\n    if (buildSizes.length === 0) {\n        return [];\n    }\n    // Only one size.\n    return [{\n            label: mergeLabel,\n            size: buildSizes[0].size,\n        }];\n}\n/** Returns whether or not all items in the list are equivalent to each other. */\nfunction allEquivalent(items) {\n    return new Set(items).size < 2;\n}\n"]},"metadata":{},"sourceType":"script"}