{"ast":null,"code":"'use strict';\n\nvar _classCallCheck = require(\"/Users/abdillahihussein/Documents/GitHub/angularProject/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/Users/abdillahihussein/Documents/GitHub/angularProject/node_modules/@babel/runtime/helpers/createClass\");\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\nexports.default = void 0;\n\nvar _types = require('./types');\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nvar Farm = /*#__PURE__*/function () {\n  function Farm(numOfWorkers, callback, computeWorkerKey) {\n    _classCallCheck(this, Farm);\n\n    _defineProperty(this, '_computeWorkerKey', void 0);\n\n    _defineProperty(this, '_cacheKeys', void 0);\n\n    _defineProperty(this, '_callback', void 0);\n\n    _defineProperty(this, '_last', void 0);\n\n    _defineProperty(this, '_locks', void 0);\n\n    _defineProperty(this, '_numOfWorkers', void 0);\n\n    _defineProperty(this, '_offset', void 0);\n\n    _defineProperty(this, '_queue', void 0);\n\n    this._cacheKeys = Object.create(null);\n    this._callback = callback;\n    this._last = [];\n    this._locks = [];\n    this._numOfWorkers = numOfWorkers;\n    this._offset = 0;\n    this._queue = [];\n\n    if (computeWorkerKey) {\n      this._computeWorkerKey = computeWorkerKey;\n    }\n  }\n\n  _createClass(Farm, [{\n    key: \"doWork\",\n    value: function doWork(method) {\n      var _this = this;\n\n      for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n        args[_key - 1] = arguments[_key];\n      }\n\n      var customMessageListeners = new Set();\n\n      var addCustomMessageListener = function addCustomMessageListener(listener) {\n        customMessageListeners.add(listener);\n        return function () {\n          customMessageListeners.delete(listener);\n        };\n      };\n\n      var onCustomMessage = function onCustomMessage(message) {\n        customMessageListeners.forEach(function (listener) {\n          return listener(message);\n        });\n      };\n\n      var promise = new Promise(function (resolve, reject) {\n        var computeWorkerKey = _this._computeWorkerKey;\n        var request = [_types.CHILD_MESSAGE_CALL, false, method, args];\n        var worker = null;\n        var hash = null;\n\n        if (computeWorkerKey) {\n          hash = computeWorkerKey.call.apply(computeWorkerKey, [_this, method].concat(args));\n          worker = hash == null ? null : _this._cacheKeys[hash];\n        }\n\n        var onStart = function onStart(worker) {\n          if (hash != null) {\n            _this._cacheKeys[hash] = worker;\n          }\n        };\n\n        var onEnd = function onEnd(error, result) {\n          customMessageListeners.clear();\n\n          if (error) {\n            reject(error);\n          } else {\n            resolve(result);\n          }\n        };\n\n        var task = {\n          onCustomMessage: onCustomMessage,\n          onEnd: onEnd,\n          onStart: onStart,\n          request: request\n        };\n\n        if (worker) {\n          _this._enqueue(task, worker.getWorkerId());\n        } else {\n          _this._push(task);\n        }\n      });\n      promise.UNSTABLE_onCustomMessage = addCustomMessageListener;\n      return promise;\n    }\n  }, {\n    key: \"_getNextTask\",\n    value: function _getNextTask(workerId) {\n      var queueHead = this._queue[workerId];\n\n      while (queueHead && queueHead.task.request[1]) {\n        queueHead = queueHead.next || null;\n      }\n\n      this._queue[workerId] = queueHead;\n      return queueHead && queueHead.task;\n    }\n  }, {\n    key: \"_process\",\n    value: function _process(workerId) {\n      var _this2 = this;\n\n      if (this._isLocked(workerId)) {\n        return this;\n      }\n\n      var task = this._getNextTask(workerId);\n\n      if (!task) {\n        return this;\n      }\n\n      var onEnd = function onEnd(error, result) {\n        task.onEnd(error, result);\n\n        _this2._unlock(workerId);\n\n        _this2._process(workerId);\n      };\n\n      task.request[1] = true;\n\n      this._lock(workerId);\n\n      this._callback(workerId, task.request, task.onStart, onEnd, task.onCustomMessage);\n\n      return this;\n    }\n  }, {\n    key: \"_enqueue\",\n    value: function _enqueue(task, workerId) {\n      var item = {\n        next: null,\n        task: task\n      };\n\n      if (task.request[1]) {\n        return this;\n      }\n\n      if (this._queue[workerId]) {\n        this._last[workerId].next = item;\n      } else {\n        this._queue[workerId] = item;\n      }\n\n      this._last[workerId] = item;\n\n      this._process(workerId);\n\n      return this;\n    }\n  }, {\n    key: \"_push\",\n    value: function _push(task) {\n      for (var i = 0; i < this._numOfWorkers; i++) {\n        this._enqueue(task, (this._offset + i) % this._numOfWorkers);\n      }\n\n      this._offset++;\n      return this;\n    }\n  }, {\n    key: \"_lock\",\n    value: function _lock(workerId) {\n      this._locks[workerId] = true;\n    }\n  }, {\n    key: \"_unlock\",\n    value: function _unlock(workerId) {\n      this._locks[workerId] = false;\n    }\n  }, {\n    key: \"_isLocked\",\n    value: function _isLocked(workerId) {\n      return this._locks[workerId];\n    }\n  }]);\n\n  return Farm;\n}();\n\nexports.default = Farm;","map":{"version":3,"sources":["/Users/abdillahihussein/Documents/GitHub/angularProject/node_modules/terser-webpack-plugin/node_modules/jest-worker/build/Farm.js"],"names":["Object","defineProperty","exports","value","default","_types","require","_defineProperty","obj","key","enumerable","configurable","writable","Farm","numOfWorkers","callback","computeWorkerKey","_cacheKeys","create","_callback","_last","_locks","_numOfWorkers","_offset","_queue","_computeWorkerKey","method","args","customMessageListeners","Set","addCustomMessageListener","listener","add","delete","onCustomMessage","message","forEach","promise","Promise","resolve","reject","request","CHILD_MESSAGE_CALL","worker","hash","call","onStart","onEnd","error","result","clear","task","_enqueue","getWorkerId","_push","UNSTABLE_onCustomMessage","workerId","queueHead","next","_isLocked","_getNextTask","_unlock","_process","_lock","item","i"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\nexports.default = void 0;\n\nvar _types = require('./types');\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n  return obj;\n}\n\nclass Farm {\n  constructor(numOfWorkers, callback, computeWorkerKey) {\n    _defineProperty(this, '_computeWorkerKey', void 0);\n\n    _defineProperty(this, '_cacheKeys', void 0);\n\n    _defineProperty(this, '_callback', void 0);\n\n    _defineProperty(this, '_last', void 0);\n\n    _defineProperty(this, '_locks', void 0);\n\n    _defineProperty(this, '_numOfWorkers', void 0);\n\n    _defineProperty(this, '_offset', void 0);\n\n    _defineProperty(this, '_queue', void 0);\n\n    this._cacheKeys = Object.create(null);\n    this._callback = callback;\n    this._last = [];\n    this._locks = [];\n    this._numOfWorkers = numOfWorkers;\n    this._offset = 0;\n    this._queue = [];\n\n    if (computeWorkerKey) {\n      this._computeWorkerKey = computeWorkerKey;\n    }\n  }\n\n  doWork(method, ...args) {\n    const customMessageListeners = new Set();\n\n    const addCustomMessageListener = listener => {\n      customMessageListeners.add(listener);\n      return () => {\n        customMessageListeners.delete(listener);\n      };\n    };\n\n    const onCustomMessage = message => {\n      customMessageListeners.forEach(listener => listener(message));\n    };\n\n    const promise = new Promise((resolve, reject) => {\n      const computeWorkerKey = this._computeWorkerKey;\n      const request = [_types.CHILD_MESSAGE_CALL, false, method, args];\n      let worker = null;\n      let hash = null;\n\n      if (computeWorkerKey) {\n        hash = computeWorkerKey.call(this, method, ...args);\n        worker = hash == null ? null : this._cacheKeys[hash];\n      }\n\n      const onStart = worker => {\n        if (hash != null) {\n          this._cacheKeys[hash] = worker;\n        }\n      };\n\n      const onEnd = (error, result) => {\n        customMessageListeners.clear();\n\n        if (error) {\n          reject(error);\n        } else {\n          resolve(result);\n        }\n      };\n\n      const task = {\n        onCustomMessage,\n        onEnd,\n        onStart,\n        request\n      };\n\n      if (worker) {\n        this._enqueue(task, worker.getWorkerId());\n      } else {\n        this._push(task);\n      }\n    });\n    promise.UNSTABLE_onCustomMessage = addCustomMessageListener;\n    return promise;\n  }\n\n  _getNextTask(workerId) {\n    let queueHead = this._queue[workerId];\n\n    while (queueHead && queueHead.task.request[1]) {\n      queueHead = queueHead.next || null;\n    }\n\n    this._queue[workerId] = queueHead;\n    return queueHead && queueHead.task;\n  }\n\n  _process(workerId) {\n    if (this._isLocked(workerId)) {\n      return this;\n    }\n\n    const task = this._getNextTask(workerId);\n\n    if (!task) {\n      return this;\n    }\n\n    const onEnd = (error, result) => {\n      task.onEnd(error, result);\n\n      this._unlock(workerId);\n\n      this._process(workerId);\n    };\n\n    task.request[1] = true;\n\n    this._lock(workerId);\n\n    this._callback(\n      workerId,\n      task.request,\n      task.onStart,\n      onEnd,\n      task.onCustomMessage\n    );\n\n    return this;\n  }\n\n  _enqueue(task, workerId) {\n    const item = {\n      next: null,\n      task\n    };\n\n    if (task.request[1]) {\n      return this;\n    }\n\n    if (this._queue[workerId]) {\n      this._last[workerId].next = item;\n    } else {\n      this._queue[workerId] = item;\n    }\n\n    this._last[workerId] = item;\n\n    this._process(workerId);\n\n    return this;\n  }\n\n  _push(task) {\n    for (let i = 0; i < this._numOfWorkers; i++) {\n      this._enqueue(task, (this._offset + i) % this._numOfWorkers);\n    }\n\n    this._offset++;\n    return this;\n  }\n\n  _lock(workerId) {\n    this._locks[workerId] = true;\n  }\n\n  _unlock(workerId) {\n    this._locks[workerId] = false;\n  }\n\n  _isLocked(workerId) {\n    return this._locks[workerId];\n  }\n}\n\nexports.default = Farm;\n"]},"metadata":{},"sourceType":"script"}