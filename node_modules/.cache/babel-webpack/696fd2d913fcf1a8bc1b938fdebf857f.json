{"ast":null,"code":"'use strict';\n\nvar fs = require('graceful-fs');\n\nvar path = require('path');\n\nvar mkdirpSync = require('../mkdirs').mkdirsSync;\n\nvar utimesSync = require('../util/utimes.js').utimesMillisSync;\n\nvar stat = require('../util/stat');\n\nfunction copySync(src, dest, opts) {\n  if (typeof opts === 'function') {\n    opts = {\n      filter: opts\n    };\n  }\n\n  opts = opts || {};\n  opts.clobber = 'clobber' in opts ? !!opts.clobber : true; // default to true for now\n\n  opts.overwrite = 'overwrite' in opts ? !!opts.overwrite : opts.clobber; // overwrite falls back to clobber\n  // Warn about using preserveTimestamps on 32-bit node\n\n  if (opts.preserveTimestamps && process.arch === 'ia32') {\n    console.warn(\"fs-extra: Using the preserveTimestamps option in 32-bit node is not recommended;\\n\\n    see https://github.com/jprichardson/node-fs-extra/issues/269\");\n  }\n\n  var _stat$checkPathsSync = stat.checkPathsSync(src, dest, 'copy'),\n      srcStat = _stat$checkPathsSync.srcStat,\n      destStat = _stat$checkPathsSync.destStat;\n\n  stat.checkParentPathsSync(src, srcStat, dest, 'copy');\n  return handleFilterAndCopy(destStat, src, dest, opts);\n}\n\nfunction handleFilterAndCopy(destStat, src, dest, opts) {\n  if (opts.filter && !opts.filter(src, dest)) return;\n  var destParent = path.dirname(dest);\n  if (!fs.existsSync(destParent)) mkdirpSync(destParent);\n  return startCopy(destStat, src, dest, opts);\n}\n\nfunction startCopy(destStat, src, dest, opts) {\n  if (opts.filter && !opts.filter(src, dest)) return;\n  return getStats(destStat, src, dest, opts);\n}\n\nfunction getStats(destStat, src, dest, opts) {\n  var statSync = opts.dereference ? fs.statSync : fs.lstatSync;\n  var srcStat = statSync(src);\n  if (srcStat.isDirectory()) return onDir(srcStat, destStat, src, dest, opts);else if (srcStat.isFile() || srcStat.isCharacterDevice() || srcStat.isBlockDevice()) return onFile(srcStat, destStat, src, dest, opts);else if (srcStat.isSymbolicLink()) return onLink(destStat, src, dest, opts);\n}\n\nfunction onFile(srcStat, destStat, src, dest, opts) {\n  if (!destStat) return copyFile(srcStat, src, dest, opts);\n  return mayCopyFile(srcStat, src, dest, opts);\n}\n\nfunction mayCopyFile(srcStat, src, dest, opts) {\n  if (opts.overwrite) {\n    fs.unlinkSync(dest);\n    return copyFile(srcStat, src, dest, opts);\n  } else if (opts.errorOnExist) {\n    throw new Error(\"'\".concat(dest, \"' already exists\"));\n  }\n}\n\nfunction copyFile(srcStat, src, dest, opts) {\n  if (typeof fs.copyFileSync === 'function') {\n    fs.copyFileSync(src, dest);\n    fs.chmodSync(dest, srcStat.mode);\n\n    if (opts.preserveTimestamps) {\n      return utimesSync(dest, srcStat.atime, srcStat.mtime);\n    }\n\n    return;\n  }\n\n  return copyFileFallback(srcStat, src, dest, opts);\n}\n\nfunction copyFileFallback(srcStat, src, dest, opts) {\n  var BUF_LENGTH = 64 * 1024;\n\n  var _buff = require('../util/buffer')(BUF_LENGTH);\n\n  var fdr = fs.openSync(src, 'r');\n  var fdw = fs.openSync(dest, 'w', srcStat.mode);\n  var pos = 0;\n\n  while (pos < srcStat.size) {\n    var bytesRead = fs.readSync(fdr, _buff, 0, BUF_LENGTH, pos);\n    fs.writeSync(fdw, _buff, 0, bytesRead);\n    pos += bytesRead;\n  }\n\n  if (opts.preserveTimestamps) fs.futimesSync(fdw, srcStat.atime, srcStat.mtime);\n  fs.closeSync(fdr);\n  fs.closeSync(fdw);\n}\n\nfunction onDir(srcStat, destStat, src, dest, opts) {\n  if (!destStat) return mkDirAndCopy(srcStat, src, dest, opts);\n\n  if (destStat && !destStat.isDirectory()) {\n    throw new Error(\"Cannot overwrite non-directory '\".concat(dest, \"' with directory '\").concat(src, \"'.\"));\n  }\n\n  return copyDir(src, dest, opts);\n}\n\nfunction mkDirAndCopy(srcStat, src, dest, opts) {\n  fs.mkdirSync(dest);\n  copyDir(src, dest, opts);\n  return fs.chmodSync(dest, srcStat.mode);\n}\n\nfunction copyDir(src, dest, opts) {\n  fs.readdirSync(src).forEach(function (item) {\n    return copyDirItem(item, src, dest, opts);\n  });\n}\n\nfunction copyDirItem(item, src, dest, opts) {\n  var srcItem = path.join(src, item);\n  var destItem = path.join(dest, item);\n\n  var _stat$checkPathsSync2 = stat.checkPathsSync(srcItem, destItem, 'copy'),\n      destStat = _stat$checkPathsSync2.destStat;\n\n  return startCopy(destStat, srcItem, destItem, opts);\n}\n\nfunction onLink(destStat, src, dest, opts) {\n  var resolvedSrc = fs.readlinkSync(src);\n\n  if (opts.dereference) {\n    resolvedSrc = path.resolve(process.cwd(), resolvedSrc);\n  }\n\n  if (!destStat) {\n    return fs.symlinkSync(resolvedSrc, dest);\n  } else {\n    var resolvedDest;\n\n    try {\n      resolvedDest = fs.readlinkSync(dest);\n    } catch (err) {\n      // dest exists and is a regular file or directory,\n      // Windows may throw UNKNOWN error. If dest already exists,\n      // fs throws error anyway, so no need to guard against it here.\n      if (err.code === 'EINVAL' || err.code === 'UNKNOWN') return fs.symlinkSync(resolvedSrc, dest);\n      throw err;\n    }\n\n    if (opts.dereference) {\n      resolvedDest = path.resolve(process.cwd(), resolvedDest);\n    }\n\n    if (stat.isSrcSubdir(resolvedSrc, resolvedDest)) {\n      throw new Error(\"Cannot copy '\".concat(resolvedSrc, \"' to a subdirectory of itself, '\").concat(resolvedDest, \"'.\"));\n    } // prevent copy if src is a subdir of dest since unlinking\n    // dest in this case would result in removing src contents\n    // and therefore a broken symlink would be created.\n\n\n    if (fs.statSync(dest).isDirectory() && stat.isSrcSubdir(resolvedDest, resolvedSrc)) {\n      throw new Error(\"Cannot overwrite '\".concat(resolvedDest, \"' with '\").concat(resolvedSrc, \"'.\"));\n    }\n\n    return copyLink(resolvedSrc, dest);\n  }\n}\n\nfunction copyLink(resolvedSrc, dest) {\n  fs.unlinkSync(dest);\n  return fs.symlinkSync(resolvedSrc, dest);\n}\n\nmodule.exports = copySync;","map":{"version":3,"sources":["/Users/abdillahihussein/Documents/GitHub/angularProject/node_modules/streamroller/node_modules/fs-extra/lib/copy-sync/copy-sync.js"],"names":["fs","require","path","mkdirpSync","mkdirsSync","utimesSync","utimesMillisSync","stat","copySync","src","dest","opts","filter","clobber","overwrite","preserveTimestamps","process","arch","console","warn","checkPathsSync","srcStat","destStat","checkParentPathsSync","handleFilterAndCopy","destParent","dirname","existsSync","startCopy","getStats","statSync","dereference","lstatSync","isDirectory","onDir","isFile","isCharacterDevice","isBlockDevice","onFile","isSymbolicLink","onLink","copyFile","mayCopyFile","unlinkSync","errorOnExist","Error","copyFileSync","chmodSync","mode","atime","mtime","copyFileFallback","BUF_LENGTH","_buff","fdr","openSync","fdw","pos","size","bytesRead","readSync","writeSync","futimesSync","closeSync","mkDirAndCopy","copyDir","mkdirSync","readdirSync","forEach","item","copyDirItem","srcItem","join","destItem","resolvedSrc","readlinkSync","resolve","cwd","symlinkSync","resolvedDest","err","code","isSrcSubdir","copyLink","module","exports"],"mappings":"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","sourcesContent":["'use strict'\n\nconst fs = require('graceful-fs')\nconst path = require('path')\nconst mkdirpSync = require('../mkdirs').mkdirsSync\nconst utimesSync = require('../util/utimes.js').utimesMillisSync\nconst stat = require('../util/stat')\n\nfunction copySync (src, dest, opts) {\n  if (typeof opts === 'function') {\n    opts = { filter: opts }\n  }\n\n  opts = opts || {}\n  opts.clobber = 'clobber' in opts ? !!opts.clobber : true // default to true for now\n  opts.overwrite = 'overwrite' in opts ? !!opts.overwrite : opts.clobber // overwrite falls back to clobber\n\n  // Warn about using preserveTimestamps on 32-bit node\n  if (opts.preserveTimestamps && process.arch === 'ia32') {\n    console.warn(`fs-extra: Using the preserveTimestamps option in 32-bit node is not recommended;\\n\n    see https://github.com/jprichardson/node-fs-extra/issues/269`)\n  }\n\n  const { srcStat, destStat } = stat.checkPathsSync(src, dest, 'copy')\n  stat.checkParentPathsSync(src, srcStat, dest, 'copy')\n  return handleFilterAndCopy(destStat, src, dest, opts)\n}\n\nfunction handleFilterAndCopy (destStat, src, dest, opts) {\n  if (opts.filter && !opts.filter(src, dest)) return\n  const destParent = path.dirname(dest)\n  if (!fs.existsSync(destParent)) mkdirpSync(destParent)\n  return startCopy(destStat, src, dest, opts)\n}\n\nfunction startCopy (destStat, src, dest, opts) {\n  if (opts.filter && !opts.filter(src, dest)) return\n  return getStats(destStat, src, dest, opts)\n}\n\nfunction getStats (destStat, src, dest, opts) {\n  const statSync = opts.dereference ? fs.statSync : fs.lstatSync\n  const srcStat = statSync(src)\n\n  if (srcStat.isDirectory()) return onDir(srcStat, destStat, src, dest, opts)\n  else if (srcStat.isFile() ||\n           srcStat.isCharacterDevice() ||\n           srcStat.isBlockDevice()) return onFile(srcStat, destStat, src, dest, opts)\n  else if (srcStat.isSymbolicLink()) return onLink(destStat, src, dest, opts)\n}\n\nfunction onFile (srcStat, destStat, src, dest, opts) {\n  if (!destStat) return copyFile(srcStat, src, dest, opts)\n  return mayCopyFile(srcStat, src, dest, opts)\n}\n\nfunction mayCopyFile (srcStat, src, dest, opts) {\n  if (opts.overwrite) {\n    fs.unlinkSync(dest)\n    return copyFile(srcStat, src, dest, opts)\n  } else if (opts.errorOnExist) {\n    throw new Error(`'${dest}' already exists`)\n  }\n}\n\nfunction copyFile (srcStat, src, dest, opts) {\n  if (typeof fs.copyFileSync === 'function') {\n    fs.copyFileSync(src, dest)\n    fs.chmodSync(dest, srcStat.mode)\n    if (opts.preserveTimestamps) {\n      return utimesSync(dest, srcStat.atime, srcStat.mtime)\n    }\n    return\n  }\n  return copyFileFallback(srcStat, src, dest, opts)\n}\n\nfunction copyFileFallback (srcStat, src, dest, opts) {\n  const BUF_LENGTH = 64 * 1024\n  const _buff = require('../util/buffer')(BUF_LENGTH)\n\n  const fdr = fs.openSync(src, 'r')\n  const fdw = fs.openSync(dest, 'w', srcStat.mode)\n  let pos = 0\n\n  while (pos < srcStat.size) {\n    const bytesRead = fs.readSync(fdr, _buff, 0, BUF_LENGTH, pos)\n    fs.writeSync(fdw, _buff, 0, bytesRead)\n    pos += bytesRead\n  }\n\n  if (opts.preserveTimestamps) fs.futimesSync(fdw, srcStat.atime, srcStat.mtime)\n\n  fs.closeSync(fdr)\n  fs.closeSync(fdw)\n}\n\nfunction onDir (srcStat, destStat, src, dest, opts) {\n  if (!destStat) return mkDirAndCopy(srcStat, src, dest, opts)\n  if (destStat && !destStat.isDirectory()) {\n    throw new Error(`Cannot overwrite non-directory '${dest}' with directory '${src}'.`)\n  }\n  return copyDir(src, dest, opts)\n}\n\nfunction mkDirAndCopy (srcStat, src, dest, opts) {\n  fs.mkdirSync(dest)\n  copyDir(src, dest, opts)\n  return fs.chmodSync(dest, srcStat.mode)\n}\n\nfunction copyDir (src, dest, opts) {\n  fs.readdirSync(src).forEach(item => copyDirItem(item, src, dest, opts))\n}\n\nfunction copyDirItem (item, src, dest, opts) {\n  const srcItem = path.join(src, item)\n  const destItem = path.join(dest, item)\n  const { destStat } = stat.checkPathsSync(srcItem, destItem, 'copy')\n  return startCopy(destStat, srcItem, destItem, opts)\n}\n\nfunction onLink (destStat, src, dest, opts) {\n  let resolvedSrc = fs.readlinkSync(src)\n  if (opts.dereference) {\n    resolvedSrc = path.resolve(process.cwd(), resolvedSrc)\n  }\n\n  if (!destStat) {\n    return fs.symlinkSync(resolvedSrc, dest)\n  } else {\n    let resolvedDest\n    try {\n      resolvedDest = fs.readlinkSync(dest)\n    } catch (err) {\n      // dest exists and is a regular file or directory,\n      // Windows may throw UNKNOWN error. If dest already exists,\n      // fs throws error anyway, so no need to guard against it here.\n      if (err.code === 'EINVAL' || err.code === 'UNKNOWN') return fs.symlinkSync(resolvedSrc, dest)\n      throw err\n    }\n    if (opts.dereference) {\n      resolvedDest = path.resolve(process.cwd(), resolvedDest)\n    }\n    if (stat.isSrcSubdir(resolvedSrc, resolvedDest)) {\n      throw new Error(`Cannot copy '${resolvedSrc}' to a subdirectory of itself, '${resolvedDest}'.`)\n    }\n\n    // prevent copy if src is a subdir of dest since unlinking\n    // dest in this case would result in removing src contents\n    // and therefore a broken symlink would be created.\n    if (fs.statSync(dest).isDirectory() && stat.isSrcSubdir(resolvedDest, resolvedSrc)) {\n      throw new Error(`Cannot overwrite '${resolvedDest}' with '${resolvedSrc}'.`)\n    }\n    return copyLink(resolvedSrc, dest)\n  }\n}\n\nfunction copyLink (resolvedSrc, dest) {\n  fs.unlinkSync(dest)\n  return fs.symlinkSync(resolvedSrc, dest)\n}\n\nmodule.exports = copySync\n"]},"metadata":{},"sourceType":"script"}