{"ast":null,"code":"\"use strict\";\n\nvar _toConsumableArray = require(\"/Users/abdillahihussein/Documents/GitHub/angularProject/node_modules/@babel/runtime/helpers/toConsumableArray\");\n\nvar _get = require(\"/Users/abdillahihussein/Documents/GitHub/angularProject/node_modules/@babel/runtime/helpers/get\");\n\nvar _getPrototypeOf = require(\"/Users/abdillahihussein/Documents/GitHub/angularProject/node_modules/@babel/runtime/helpers/getPrototypeOf\");\n\nvar _inherits = require(\"/Users/abdillahihussein/Documents/GitHub/angularProject/node_modules/@babel/runtime/helpers/inherits\");\n\nvar _createSuper = require(\"/Users/abdillahihussein/Documents/GitHub/angularProject/node_modules/@babel/runtime/helpers/createSuper\");\n\nvar _classCallCheck = require(\"/Users/abdillahihussein/Documents/GitHub/angularProject/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/Users/abdillahihussein/Documents/GitHub/angularProject/node_modules/@babel/runtime/helpers/createClass\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.VirtualWatchFileSystemDecorator = exports.VirtualFileSystemDecorator = exports.NodeWatchFileSystem = void 0;\n/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nvar core_1 = require(\"@angular-devkit/core\");\n\nvar webpack_version_1 = require(\"./webpack-version\");\n\nexports.NodeWatchFileSystem = require('webpack/lib/node/NodeWatchFileSystem'); // NOTE: @types/webpack InputFileSystem is missing some methods\n\nvar VirtualFileSystemDecorator = /*#__PURE__*/function () {\n  function VirtualFileSystemDecorator(_inputFileSystem, _webpackCompilerHost) {\n    _classCallCheck(this, VirtualFileSystemDecorator);\n\n    this._inputFileSystem = _inputFileSystem;\n    this._webpackCompilerHost = _webpackCompilerHost;\n  }\n\n  _createClass(VirtualFileSystemDecorator, [{\n    key: \"getWebpackCompilerHost\",\n    value: function getWebpackCompilerHost() {\n      return this._webpackCompilerHost;\n    }\n  }, {\n    key: \"getVirtualFilesPaths\",\n    value: function getVirtualFilesPaths() {\n      return this._webpackCompilerHost.getNgFactoryPaths();\n    }\n  }, {\n    key: \"stat\",\n    value: function stat(path, callback) {\n      var result = this._webpackCompilerHost.stat(path);\n\n      if (result) {\n        // tslint:disable-next-line:no-any\n        callback(null, result);\n      } else {\n        // tslint:disable-next-line:no-any\n        callback(new core_1.FileDoesNotExistException(path), undefined);\n      }\n    }\n  }, {\n    key: \"readdir\",\n    value: function readdir(path, callback) {\n      // tslint:disable-next-line: no-any\n      this._inputFileSystem.readdir(path, callback);\n    }\n  }, {\n    key: \"readFile\",\n    value: function readFile(path, callback) {\n      try {\n        // tslint:disable-next-line:no-any\n        callback(null, this._webpackCompilerHost.readFileBuffer(path));\n      } catch (e) {\n        // tslint:disable-next-line:no-any\n        callback(e, undefined);\n      }\n    }\n  }, {\n    key: \"readJson\",\n    value: function readJson(path, callback) {\n      // tslint:disable-next-line:no-any\n      this._inputFileSystem.readJson(path, callback);\n    }\n  }, {\n    key: \"readlink\",\n    value: function readlink(path, callback) {\n      this._inputFileSystem.readlink(path, callback);\n    }\n  }, {\n    key: \"statSync\",\n    value: function statSync(path) {\n      var stats = this._webpackCompilerHost.stat(path);\n\n      if (stats === null) {\n        throw new core_1.FileDoesNotExistException(path);\n      }\n\n      return stats;\n    }\n  }, {\n    key: \"readdirSync\",\n    value: function readdirSync(path) {\n      // tslint:disable-next-line:no-any\n      return this._inputFileSystem.readdirSync(path);\n    }\n  }, {\n    key: \"readFileSync\",\n    value: function readFileSync(path) {\n      return this._webpackCompilerHost.readFileBuffer(path);\n    }\n  }, {\n    key: \"readJsonSync\",\n    value: function readJsonSync(path) {\n      // tslint:disable-next-line:no-any\n      return this._inputFileSystem.readJsonSync(path);\n    }\n  }, {\n    key: \"readlinkSync\",\n    value: function readlinkSync(path) {\n      return this._inputFileSystem.readlinkSync(path);\n    }\n  }, {\n    key: \"purge\",\n    value: function purge(changes) {\n      var _this = this;\n\n      if (typeof changes === 'string') {\n        this._webpackCompilerHost.invalidate(changes);\n      } else if (Array.isArray(changes)) {\n        changes.forEach(function (fileName) {\n          return _this._webpackCompilerHost.invalidate(fileName);\n        });\n      }\n\n      if (this._inputFileSystem.purge) {\n        // tslint:disable-next-line:no-any\n        this._inputFileSystem.purge(changes);\n      }\n    }\n  }]);\n\n  return VirtualFileSystemDecorator;\n}();\n\nexports.VirtualFileSystemDecorator = VirtualFileSystemDecorator;\n\nvar VirtualWatchFileSystemDecorator = /*#__PURE__*/function (_exports$NodeWatchFil) {\n  _inherits(VirtualWatchFileSystemDecorator, _exports$NodeWatchFil);\n\n  var _super = _createSuper(VirtualWatchFileSystemDecorator);\n\n  function VirtualWatchFileSystemDecorator(_virtualInputFileSystem, _replacements) {\n    var _this2;\n\n    _classCallCheck(this, VirtualWatchFileSystemDecorator);\n\n    _this2 = _super.call(this, _virtualInputFileSystem);\n    _this2._virtualInputFileSystem = _virtualInputFileSystem;\n    _this2._replacements = _replacements; // tslint:disable-next-line: no-any\n\n    _this2.watch = webpack_version_1.isWebpackFiveOrHigher() ? _this2.createWebpack5Watch() : _this2.createWebpack4Watch();\n    return _this2;\n  }\n\n  _createClass(VirtualWatchFileSystemDecorator, [{\n    key: \"mapReplacements\",\n    value: function mapReplacements(original, reverseReplacements) {\n      if (!this._replacements) {\n        return original;\n      }\n\n      var replacements = this._replacements;\n      return _toConsumableArray(original).map(function (file) {\n        if (typeof replacements === 'function') {\n          var replacement = core_1.getSystemPath(replacements(core_1.normalize(file)));\n\n          if (replacement !== file) {\n            reverseReplacements.set(replacement, file);\n          }\n\n          return replacement;\n        } else {\n          var _replacement = replacements.get(core_1.normalize(file));\n\n          if (_replacement) {\n            var fullReplacement = core_1.getSystemPath(_replacement);\n            reverseReplacements.set(fullReplacement, file);\n            return fullReplacement;\n          } else {\n            return file;\n          }\n        }\n      });\n    }\n  }, {\n    key: \"reverseTimestamps\",\n    value: function reverseTimestamps(map, reverseReplacements) {\n      for (var _i = 0, _Array$from = Array.from(map.entries()); _i < _Array$from.length; _i++) {\n        var entry = _Array$from[_i];\n        var original = reverseReplacements.get(entry[0]);\n\n        if (original) {\n          map.set(original, entry[1]);\n          map.delete(entry[0]);\n        }\n      }\n\n      return map;\n    }\n  }, {\n    key: \"createWebpack4Watch\",\n    value: function createWebpack4Watch() {\n      var _this3 = this;\n\n      return function (files, dirs, missing, startTime, options, callback, callbackUndelayed) {\n        var reverseReplacements = new Map();\n\n        var newCallbackUndelayed = function newCallbackUndelayed(filename, timestamp) {\n          var original = reverseReplacements.get(filename);\n\n          if (original) {\n            _this3._virtualInputFileSystem.purge(original);\n\n            callbackUndelayed(original, timestamp);\n          } else {\n            callbackUndelayed(filename, timestamp);\n          }\n        };\n\n        var newCallback = function newCallback(err, filesModified, contextModified, missingModified, fileTimestamps, contextTimestamps) {\n          // Update fileTimestamps with timestamps from virtual files.\n          var virtualFilesStats = _this3._virtualInputFileSystem.getVirtualFilesPaths().map(function (fileName) {\n            return {\n              path: fileName,\n              mtime: +_this3._virtualInputFileSystem.statSync(fileName).mtime\n            };\n          });\n\n          virtualFilesStats.forEach(function (stats) {\n            return fileTimestamps.set(stats.path, +stats.mtime);\n          });\n          callback(err, filesModified.map(function (value) {\n            return reverseReplacements.get(value) || value;\n          }), contextModified.map(function (value) {\n            return reverseReplacements.get(value) || value;\n          }), missingModified.map(function (value) {\n            return reverseReplacements.get(value) || value;\n          }), _this3.reverseTimestamps(fileTimestamps, reverseReplacements), _this3.reverseTimestamps(contextTimestamps, reverseReplacements));\n        };\n\n        var watcher = _get(_getPrototypeOf(VirtualWatchFileSystemDecorator.prototype), \"watch\", _this3).call(_this3, _this3.mapReplacements(files, reverseReplacements), _this3.mapReplacements(dirs, reverseReplacements), _this3.mapReplacements(missing, reverseReplacements), startTime, options, newCallback, newCallbackUndelayed);\n\n        return {\n          close: function close() {\n            return watcher.close();\n          },\n          pause: function pause() {\n            return watcher.pause();\n          },\n          getFileTimestamps: function getFileTimestamps() {\n            return _this3.reverseTimestamps(watcher.getFileTimestamps(), reverseReplacements);\n          },\n          getContextTimestamps: function getContextTimestamps() {\n            return _this3.reverseTimestamps(watcher.getContextTimestamps(), reverseReplacements);\n          }\n        };\n      };\n    }\n  }, {\n    key: \"createWebpack5Watch\",\n    value: function createWebpack5Watch() {\n      var _this4 = this;\n\n      return function (files, dirs, missing, startTime, options, callback, callbackUndelayed) {\n        var reverseReplacements = new Map();\n\n        var newCallbackUndelayed = function newCallbackUndelayed(filename, timestamp) {\n          var original = reverseReplacements.get(filename);\n\n          if (original) {\n            _this4._virtualInputFileSystem.purge(original);\n\n            callbackUndelayed(original, timestamp);\n          } else {\n            callbackUndelayed(filename, timestamp);\n          }\n        };\n\n        var newCallback = function newCallback(err, // tslint:disable-next-line: no-any\n        fileTimeInfoEntries, // tslint:disable-next-line: no-any\n        contextTimeInfoEntries, missing, removals) {\n          // Update fileTimestamps with timestamps from virtual files.\n          var virtualFilesStats = _this4._virtualInputFileSystem.getVirtualFilesPaths().map(function (fileName) {\n            return {\n              path: fileName,\n              mtime: +_this4._virtualInputFileSystem.statSync(fileName).mtime\n            };\n          });\n\n          virtualFilesStats.forEach(function (stats) {\n            return fileTimeInfoEntries.set(stats.path, +stats.mtime);\n          });\n          callback(err, _this4.reverseTimestamps(fileTimeInfoEntries, reverseReplacements), _this4.reverseTimestamps(contextTimeInfoEntries, reverseReplacements), new Set(_toConsumableArray(missing).map(function (value) {\n            return reverseReplacements.get(value) || value;\n          })), new Set(_toConsumableArray(removals).map(function (value) {\n            return reverseReplacements.get(value) || value;\n          })));\n        };\n\n        var watcher = _get(_getPrototypeOf(VirtualWatchFileSystemDecorator.prototype), \"watch\", _this4).call(_this4, _this4.mapReplacements(files, reverseReplacements), _this4.mapReplacements(dirs, reverseReplacements), _this4.mapReplacements(missing, reverseReplacements), startTime, options, newCallback, newCallbackUndelayed);\n\n        return {\n          close: function close() {\n            return watcher.close();\n          },\n          pause: function pause() {\n            return watcher.pause();\n          },\n          getFileTimeInfoEntries: function getFileTimeInfoEntries() {\n            return _this4.reverseTimestamps(watcher.getFileTimeInfoEntries(), reverseReplacements);\n          },\n          getContextTimeInfoEntries: function getContextTimeInfoEntries() {\n            return _this4.reverseTimestamps(watcher.getContextTimeInfoEntries(), reverseReplacements);\n          }\n        };\n      };\n    }\n  }]);\n\n  return VirtualWatchFileSystemDecorator;\n}(exports.NodeWatchFileSystem);\n\nexports.VirtualWatchFileSystemDecorator = VirtualWatchFileSystemDecorator;","map":{"version":3,"sources":["/Users/abdillahihussein/Documents/GitHub/angularProject/node_modules/@ngtools/webpack/src/virtual_file_system_decorator.js"],"names":["Object","defineProperty","exports","value","VirtualWatchFileSystemDecorator","VirtualFileSystemDecorator","NodeWatchFileSystem","core_1","require","webpack_version_1","_inputFileSystem","_webpackCompilerHost","getNgFactoryPaths","path","callback","result","stat","FileDoesNotExistException","undefined","readdir","readFileBuffer","e","readJson","readlink","stats","readdirSync","readJsonSync","readlinkSync","changes","invalidate","Array","isArray","forEach","fileName","purge","_virtualInputFileSystem","_replacements","watch","isWebpackFiveOrHigher","createWebpack5Watch","createWebpack4Watch","original","reverseReplacements","replacements","map","file","replacement","getSystemPath","normalize","set","get","fullReplacement","from","entries","entry","delete","files","dirs","missing","startTime","options","callbackUndelayed","Map","newCallbackUndelayed","filename","timestamp","newCallback","err","filesModified","contextModified","missingModified","fileTimestamps","contextTimestamps","virtualFilesStats","getVirtualFilesPaths","mtime","statSync","reverseTimestamps","watcher","mapReplacements","close","pause","getFileTimestamps","getContextTimestamps","fileTimeInfoEntries","contextTimeInfoEntries","removals","Set","getFileTimeInfoEntries","getContextTimeInfoEntries"],"mappings":"AAAA;;;;;;;;;;;;;;;;AACAA,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAAEC,EAAAA,KAAK,EAAE;AAAT,CAA7C;AACAD,OAAO,CAACE,+BAAR,GAA0CF,OAAO,CAACG,0BAAR,GAAqCH,OAAO,CAACI,mBAAR,GAA8B,KAAK,CAAlH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,IAAMC,MAAM,GAAGC,OAAO,CAAC,sBAAD,CAAtB;;AACA,IAAMC,iBAAiB,GAAGD,OAAO,CAAC,mBAAD,CAAjC;;AACAN,OAAO,CAACI,mBAAR,GAA8BE,OAAO,CAAC,sCAAD,CAArC,C,CACA;;IACMH,0B;AACF,sCAAYK,gBAAZ,EAA8BC,oBAA9B,EAAoD;AAAA;;AAChD,SAAKD,gBAAL,GAAwBA,gBAAxB;AACA,SAAKC,oBAAL,GAA4BA,oBAA5B;AACH;;;;WACD,kCAAyB;AACrB,aAAO,KAAKA,oBAAZ;AACH;;;WACD,gCAAuB;AACnB,aAAO,KAAKA,oBAAL,CAA0BC,iBAA1B,EAAP;AACH;;;WACD,cAAKC,IAAL,EAAWC,QAAX,EAAqB;AACjB,UAAMC,MAAM,GAAG,KAAKJ,oBAAL,CAA0BK,IAA1B,CAA+BH,IAA/B,CAAf;;AACA,UAAIE,MAAJ,EAAY;AACR;AACAD,QAAAA,QAAQ,CAAC,IAAD,EAAOC,MAAP,CAAR;AACH,OAHD,MAIK;AACD;AACAD,QAAAA,QAAQ,CAAC,IAAIP,MAAM,CAACU,yBAAX,CAAqCJ,IAArC,CAAD,EAA6CK,SAA7C,CAAR;AACH;AACJ;;;WACD,iBAAQL,IAAR,EAAcC,QAAd,EAAwB;AACpB;AACA,WAAKJ,gBAAL,CAAsBS,OAAtB,CAA8BN,IAA9B,EAAoCC,QAApC;AACH;;;WACD,kBAASD,IAAT,EAAeC,QAAf,EAAyB;AACrB,UAAI;AACA;AACAA,QAAAA,QAAQ,CAAC,IAAD,EAAO,KAAKH,oBAAL,CAA0BS,cAA1B,CAAyCP,IAAzC,CAAP,CAAR;AACH,OAHD,CAIA,OAAOQ,CAAP,EAAU;AACN;AACAP,QAAAA,QAAQ,CAACO,CAAD,EAAIH,SAAJ,CAAR;AACH;AACJ;;;WACD,kBAASL,IAAT,EAAeC,QAAf,EAAyB;AACrB;AACA,WAAKJ,gBAAL,CAAsBY,QAAtB,CAA+BT,IAA/B,EAAqCC,QAArC;AACH;;;WACD,kBAASD,IAAT,EAAeC,QAAf,EAAyB;AACrB,WAAKJ,gBAAL,CAAsBa,QAAtB,CAA+BV,IAA/B,EAAqCC,QAArC;AACH;;;WACD,kBAASD,IAAT,EAAe;AACX,UAAMW,KAAK,GAAG,KAAKb,oBAAL,CAA0BK,IAA1B,CAA+BH,IAA/B,CAAd;;AACA,UAAIW,KAAK,KAAK,IAAd,EAAoB;AAChB,cAAM,IAAIjB,MAAM,CAACU,yBAAX,CAAqCJ,IAArC,CAAN;AACH;;AACD,aAAOW,KAAP;AACH;;;WACD,qBAAYX,IAAZ,EAAkB;AACd;AACA,aAAO,KAAKH,gBAAL,CAAsBe,WAAtB,CAAkCZ,IAAlC,CAAP;AACH;;;WACD,sBAAaA,IAAb,EAAmB;AACf,aAAO,KAAKF,oBAAL,CAA0BS,cAA1B,CAAyCP,IAAzC,CAAP;AACH;;;WACD,sBAAaA,IAAb,EAAmB;AACf;AACA,aAAO,KAAKH,gBAAL,CAAsBgB,YAAtB,CAAmCb,IAAnC,CAAP;AACH;;;WACD,sBAAaA,IAAb,EAAmB;AACf,aAAO,KAAKH,gBAAL,CAAsBiB,YAAtB,CAAmCd,IAAnC,CAAP;AACH;;;WACD,eAAMe,OAAN,EAAe;AAAA;;AACX,UAAI,OAAOA,OAAP,KAAmB,QAAvB,EAAiC;AAC7B,aAAKjB,oBAAL,CAA0BkB,UAA1B,CAAqCD,OAArC;AACH,OAFD,MAGK,IAAIE,KAAK,CAACC,OAAN,CAAcH,OAAd,CAAJ,EAA4B;AAC7BA,QAAAA,OAAO,CAACI,OAAR,CAAgB,UAACC,QAAD;AAAA,iBAAc,KAAI,CAACtB,oBAAL,CAA0BkB,UAA1B,CAAqCI,QAArC,CAAd;AAAA,SAAhB;AACH;;AACD,UAAI,KAAKvB,gBAAL,CAAsBwB,KAA1B,EAAiC;AAC7B;AACA,aAAKxB,gBAAL,CAAsBwB,KAAtB,CAA4BN,OAA5B;AACH;AACJ;;;;;;AAEL1B,OAAO,CAACG,0BAAR,GAAqCA,0BAArC;;IACMD,+B;;;;;AACF,2CAAY+B,uBAAZ,EAAqCC,aAArC,EAAoD;AAAA;;AAAA;;AAChD,+BAAMD,uBAAN;AACA,WAAKA,uBAAL,GAA+BA,uBAA/B;AACA,WAAKC,aAAL,GAAqBA,aAArB,CAHgD,CAIhD;;AACA,WAAKC,KAAL,GAAa5B,iBAAiB,CAAC6B,qBAAlB,KAA4C,OAAKC,mBAAL,EAA5C,GAAyE,OAAKC,mBAAL,EAAtF;AALgD;AAMnD;;;;WACD,yBAAgBC,QAAhB,EAA0BC,mBAA1B,EAA+C;AAC3C,UAAI,CAAC,KAAKN,aAAV,EAAyB;AACrB,eAAOK,QAAP;AACH;;AACD,UAAME,YAAY,GAAG,KAAKP,aAA1B;AACA,aAAO,mBAAIK,QAAJ,EAAcG,GAAd,CAAkB,UAAAC,IAAI,EAAI;AAC7B,YAAI,OAAOF,YAAP,KAAwB,UAA5B,EAAwC;AACpC,cAAMG,WAAW,GAAGvC,MAAM,CAACwC,aAAP,CAAqBJ,YAAY,CAACpC,MAAM,CAACyC,SAAP,CAAiBH,IAAjB,CAAD,CAAjC,CAApB;;AACA,cAAIC,WAAW,KAAKD,IAApB,EAA0B;AACtBH,YAAAA,mBAAmB,CAACO,GAApB,CAAwBH,WAAxB,EAAqCD,IAArC;AACH;;AACD,iBAAOC,WAAP;AACH,SAND,MAOK;AACD,cAAMA,YAAW,GAAGH,YAAY,CAACO,GAAb,CAAiB3C,MAAM,CAACyC,SAAP,CAAiBH,IAAjB,CAAjB,CAApB;;AACA,cAAIC,YAAJ,EAAiB;AACb,gBAAMK,eAAe,GAAG5C,MAAM,CAACwC,aAAP,CAAqBD,YAArB,CAAxB;AACAJ,YAAAA,mBAAmB,CAACO,GAApB,CAAwBE,eAAxB,EAAyCN,IAAzC;AACA,mBAAOM,eAAP;AACH,WAJD,MAKK;AACD,mBAAON,IAAP;AACH;AACJ;AACJ,OAnBM,CAAP;AAoBH;;;WACD,2BAAkBD,GAAlB,EAAuBF,mBAAvB,EAA4C;AACxC,qCAAoBZ,KAAK,CAACsB,IAAN,CAAWR,GAAG,CAACS,OAAJ,EAAX,CAApB,iCAA+C;AAA1C,YAAMC,KAAK,kBAAX;AACD,YAAMb,QAAQ,GAAGC,mBAAmB,CAACQ,GAApB,CAAwBI,KAAK,CAAC,CAAD,CAA7B,CAAjB;;AACA,YAAIb,QAAJ,EAAc;AACVG,UAAAA,GAAG,CAACK,GAAJ,CAAQR,QAAR,EAAkBa,KAAK,CAAC,CAAD,CAAvB;AACAV,UAAAA,GAAG,CAACW,MAAJ,CAAWD,KAAK,CAAC,CAAD,CAAhB;AACH;AACJ;;AACD,aAAOV,GAAP;AACH;;;WACD,+BAAsB;AAAA;;AAClB,aAAO,UAACY,KAAD,EAAQC,IAAR,EAAcC,OAAd,EAAuBC,SAAvB,EAAkCC,OAAlC,EAA2C9C,QAA3C,EAAqD+C,iBAArD,EAA2E;AAC9E,YAAMnB,mBAAmB,GAAG,IAAIoB,GAAJ,EAA5B;;AACA,YAAMC,oBAAoB,GAAG,SAAvBA,oBAAuB,CAACC,QAAD,EAAWC,SAAX,EAAyB;AAClD,cAAMxB,QAAQ,GAAGC,mBAAmB,CAACQ,GAApB,CAAwBc,QAAxB,CAAjB;;AACA,cAAIvB,QAAJ,EAAc;AACV,YAAA,MAAI,CAACN,uBAAL,CAA6BD,KAA7B,CAAmCO,QAAnC;;AACAoB,YAAAA,iBAAiB,CAACpB,QAAD,EAAWwB,SAAX,CAAjB;AACH,WAHD,MAIK;AACDJ,YAAAA,iBAAiB,CAACG,QAAD,EAAWC,SAAX,CAAjB;AACH;AACJ,SATD;;AAUA,YAAMC,WAAW,GAAG,SAAdA,WAAc,CAACC,GAAD,EAAMC,aAAN,EAAqBC,eAArB,EAAsCC,eAAtC,EAAuDC,cAAvD,EAAuEC,iBAAvE,EAA6F;AAC7G;AACA,cAAMC,iBAAiB,GAAG,MAAI,CAACtC,uBAAL,CAA6BuC,oBAA7B,GACrB9B,GADqB,CACjB,UAACX,QAAD;AAAA,mBAAe;AACpBpB,cAAAA,IAAI,EAAEoB,QADc;AAEpB0C,cAAAA,KAAK,EAAE,CAAC,MAAI,CAACxC,uBAAL,CAA6ByC,QAA7B,CAAsC3C,QAAtC,EAAgD0C;AAFpC,aAAf;AAAA,WADiB,CAA1B;;AAKAF,UAAAA,iBAAiB,CAACzC,OAAlB,CAA0B,UAAAR,KAAK;AAAA,mBAAI+C,cAAc,CAACtB,GAAf,CAAmBzB,KAAK,CAACX,IAAzB,EAA+B,CAACW,KAAK,CAACmD,KAAtC,CAAJ;AAAA,WAA/B;AACA7D,UAAAA,QAAQ,CAACqD,GAAD,EAAMC,aAAa,CAACxB,GAAd,CAAkB,UAAAzC,KAAK;AAAA,mBAAIuC,mBAAmB,CAACQ,GAApB,CAAwB/C,KAAxB,KAAkCA,KAAtC;AAAA,WAAvB,CAAN,EAA2EkE,eAAe,CAACzB,GAAhB,CAAoB,UAAAzC,KAAK;AAAA,mBAAIuC,mBAAmB,CAACQ,GAApB,CAAwB/C,KAAxB,KAAkCA,KAAtC;AAAA,WAAzB,CAA3E,EAAkJmE,eAAe,CAAC1B,GAAhB,CAAoB,UAAAzC,KAAK;AAAA,mBAAIuC,mBAAmB,CAACQ,GAApB,CAAwB/C,KAAxB,KAAkCA,KAAtC;AAAA,WAAzB,CAAlJ,EAAyN,MAAI,CAAC0E,iBAAL,CAAuBN,cAAvB,EAAuC7B,mBAAvC,CAAzN,EAAsR,MAAI,CAACmC,iBAAL,CAAuBL,iBAAvB,EAA0C9B,mBAA1C,CAAtR,CAAR;AACH,SATD;;AAUA,YAAMoC,OAAO,kGAAe,MAAI,CAACC,eAAL,CAAqBvB,KAArB,EAA4Bd,mBAA5B,CAAf,EAAiE,MAAI,CAACqC,eAAL,CAAqBtB,IAArB,EAA2Bf,mBAA3B,CAAjE,EAAkH,MAAI,CAACqC,eAAL,CAAqBrB,OAArB,EAA8BhB,mBAA9B,CAAlH,EAAsKiB,SAAtK,EAAiLC,OAAjL,EAA0LM,WAA1L,EAAuMH,oBAAvM,CAAb;;AACA,eAAO;AACHiB,UAAAA,KAAK,EAAE;AAAA,mBAAMF,OAAO,CAACE,KAAR,EAAN;AAAA,WADJ;AAEHC,UAAAA,KAAK,EAAE;AAAA,mBAAMH,OAAO,CAACG,KAAR,EAAN;AAAA,WAFJ;AAGHC,UAAAA,iBAAiB,EAAE;AAAA,mBAAM,MAAI,CAACL,iBAAL,CAAuBC,OAAO,CAACI,iBAAR,EAAvB,EAAoDxC,mBAApD,CAAN;AAAA,WAHhB;AAIHyC,UAAAA,oBAAoB,EAAE;AAAA,mBAAM,MAAI,CAACN,iBAAL,CAAuBC,OAAO,CAACK,oBAAR,EAAvB,EAAuDzC,mBAAvD,CAAN;AAAA;AAJnB,SAAP;AAMH,OA7BD;AA8BH;;;WACD,+BAAsB;AAAA;;AAClB,aAAO,UAACc,KAAD,EAAQC,IAAR,EAAcC,OAAd,EAAuBC,SAAvB,EAAkCC,OAAlC,EAA2C9C,QAA3C,EAAqD+C,iBAArD,EAA2E;AAC9E,YAAMnB,mBAAmB,GAAG,IAAIoB,GAAJ,EAA5B;;AACA,YAAMC,oBAAoB,GAAG,SAAvBA,oBAAuB,CAACC,QAAD,EAAWC,SAAX,EAAyB;AAClD,cAAMxB,QAAQ,GAAGC,mBAAmB,CAACQ,GAApB,CAAwBc,QAAxB,CAAjB;;AACA,cAAIvB,QAAJ,EAAc;AACV,YAAA,MAAI,CAACN,uBAAL,CAA6BD,KAA7B,CAAmCO,QAAnC;;AACAoB,YAAAA,iBAAiB,CAACpB,QAAD,EAAWwB,SAAX,CAAjB;AACH,WAHD,MAIK;AACDJ,YAAAA,iBAAiB,CAACG,QAAD,EAAWC,SAAX,CAAjB;AACH;AACJ,SATD;;AAUA,YAAMC,WAAW,GAAG,SAAdA,WAAc,CAACC,GAAD,EACpB;AACAiB,QAAAA,mBAFoB,EAGpB;AACAC,QAAAA,sBAJoB,EAII3B,OAJJ,EAIa4B,QAJb,EAI0B;AAC1C;AACA,cAAMb,iBAAiB,GAAG,MAAI,CAACtC,uBAAL,CAA6BuC,oBAA7B,GACrB9B,GADqB,CACjB,UAACX,QAAD;AAAA,mBAAe;AACpBpB,cAAAA,IAAI,EAAEoB,QADc;AAEpB0C,cAAAA,KAAK,EAAE,CAAC,MAAI,CAACxC,uBAAL,CAA6ByC,QAA7B,CAAsC3C,QAAtC,EAAgD0C;AAFpC,aAAf;AAAA,WADiB,CAA1B;;AAKAF,UAAAA,iBAAiB,CAACzC,OAAlB,CAA0B,UAAAR,KAAK;AAAA,mBAAI4D,mBAAmB,CAACnC,GAApB,CAAwBzB,KAAK,CAACX,IAA9B,EAAoC,CAACW,KAAK,CAACmD,KAA3C,CAAJ;AAAA,WAA/B;AACA7D,UAAAA,QAAQ,CAACqD,GAAD,EAAM,MAAI,CAACU,iBAAL,CAAuBO,mBAAvB,EAA4C1C,mBAA5C,CAAN,EAAwE,MAAI,CAACmC,iBAAL,CAAuBQ,sBAAvB,EAA+C3C,mBAA/C,CAAxE,EAA6I,IAAI6C,GAAJ,CAAQ,mBAAI7B,OAAJ,EAAad,GAAb,CAAiB,UAAAzC,KAAK;AAAA,mBAAIuC,mBAAmB,CAACQ,GAApB,CAAwB/C,KAAxB,KAAkCA,KAAtC;AAAA,WAAtB,CAAR,CAA7I,EAA0N,IAAIoF,GAAJ,CAAQ,mBAAID,QAAJ,EAAc1C,GAAd,CAAkB,UAAAzC,KAAK;AAAA,mBAAIuC,mBAAmB,CAACQ,GAApB,CAAwB/C,KAAxB,KAAkCA,KAAtC;AAAA,WAAvB,CAAR,CAA1N,CAAR;AACH,SAbD;;AAcA,YAAM2E,OAAO,kGAAe,MAAI,CAACC,eAAL,CAAqBvB,KAArB,EAA4Bd,mBAA5B,CAAf,EAAiE,MAAI,CAACqC,eAAL,CAAqBtB,IAArB,EAA2Bf,mBAA3B,CAAjE,EAAkH,MAAI,CAACqC,eAAL,CAAqBrB,OAArB,EAA8BhB,mBAA9B,CAAlH,EAAsKiB,SAAtK,EAAiLC,OAAjL,EAA0LM,WAA1L,EAAuMH,oBAAvM,CAAb;;AACA,eAAO;AACHiB,UAAAA,KAAK,EAAE;AAAA,mBAAMF,OAAO,CAACE,KAAR,EAAN;AAAA,WADJ;AAEHC,UAAAA,KAAK,EAAE;AAAA,mBAAMH,OAAO,CAACG,KAAR,EAAN;AAAA,WAFJ;AAGHO,UAAAA,sBAAsB,EAAE;AAAA,mBAAM,MAAI,CAACX,iBAAL,CAAuBC,OAAO,CAACU,sBAAR,EAAvB,EAAyD9C,mBAAzD,CAAN;AAAA,WAHrB;AAIH+C,UAAAA,yBAAyB,EAAE;AAAA,mBAAM,MAAI,CAACZ,iBAAL,CAAuBC,OAAO,CAACW,yBAAR,EAAvB,EAA4D/C,mBAA5D,CAAN;AAAA;AAJxB,SAAP;AAMH,OAjCD;AAkCH;;;;EA/GyCxC,OAAO,CAACI,mB;;AAiHtDJ,OAAO,CAACE,+BAAR,GAA0CA,+BAA1C","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.VirtualWatchFileSystemDecorator = exports.VirtualFileSystemDecorator = exports.NodeWatchFileSystem = void 0;\n/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\nconst core_1 = require(\"@angular-devkit/core\");\nconst webpack_version_1 = require(\"./webpack-version\");\nexports.NodeWatchFileSystem = require('webpack/lib/node/NodeWatchFileSystem');\n// NOTE: @types/webpack InputFileSystem is missing some methods\nclass VirtualFileSystemDecorator {\n    constructor(_inputFileSystem, _webpackCompilerHost) {\n        this._inputFileSystem = _inputFileSystem;\n        this._webpackCompilerHost = _webpackCompilerHost;\n    }\n    getWebpackCompilerHost() {\n        return this._webpackCompilerHost;\n    }\n    getVirtualFilesPaths() {\n        return this._webpackCompilerHost.getNgFactoryPaths();\n    }\n    stat(path, callback) {\n        const result = this._webpackCompilerHost.stat(path);\n        if (result) {\n            // tslint:disable-next-line:no-any\n            callback(null, result);\n        }\n        else {\n            // tslint:disable-next-line:no-any\n            callback(new core_1.FileDoesNotExistException(path), undefined);\n        }\n    }\n    readdir(path, callback) {\n        // tslint:disable-next-line: no-any\n        this._inputFileSystem.readdir(path, callback);\n    }\n    readFile(path, callback) {\n        try {\n            // tslint:disable-next-line:no-any\n            callback(null, this._webpackCompilerHost.readFileBuffer(path));\n        }\n        catch (e) {\n            // tslint:disable-next-line:no-any\n            callback(e, undefined);\n        }\n    }\n    readJson(path, callback) {\n        // tslint:disable-next-line:no-any\n        this._inputFileSystem.readJson(path, callback);\n    }\n    readlink(path, callback) {\n        this._inputFileSystem.readlink(path, callback);\n    }\n    statSync(path) {\n        const stats = this._webpackCompilerHost.stat(path);\n        if (stats === null) {\n            throw new core_1.FileDoesNotExistException(path);\n        }\n        return stats;\n    }\n    readdirSync(path) {\n        // tslint:disable-next-line:no-any\n        return this._inputFileSystem.readdirSync(path);\n    }\n    readFileSync(path) {\n        return this._webpackCompilerHost.readFileBuffer(path);\n    }\n    readJsonSync(path) {\n        // tslint:disable-next-line:no-any\n        return this._inputFileSystem.readJsonSync(path);\n    }\n    readlinkSync(path) {\n        return this._inputFileSystem.readlinkSync(path);\n    }\n    purge(changes) {\n        if (typeof changes === 'string') {\n            this._webpackCompilerHost.invalidate(changes);\n        }\n        else if (Array.isArray(changes)) {\n            changes.forEach((fileName) => this._webpackCompilerHost.invalidate(fileName));\n        }\n        if (this._inputFileSystem.purge) {\n            // tslint:disable-next-line:no-any\n            this._inputFileSystem.purge(changes);\n        }\n    }\n}\nexports.VirtualFileSystemDecorator = VirtualFileSystemDecorator;\nclass VirtualWatchFileSystemDecorator extends exports.NodeWatchFileSystem {\n    constructor(_virtualInputFileSystem, _replacements) {\n        super(_virtualInputFileSystem);\n        this._virtualInputFileSystem = _virtualInputFileSystem;\n        this._replacements = _replacements;\n        // tslint:disable-next-line: no-any\n        this.watch = webpack_version_1.isWebpackFiveOrHigher() ? this.createWebpack5Watch() : this.createWebpack4Watch();\n    }\n    mapReplacements(original, reverseReplacements) {\n        if (!this._replacements) {\n            return original;\n        }\n        const replacements = this._replacements;\n        return [...original].map(file => {\n            if (typeof replacements === 'function') {\n                const replacement = core_1.getSystemPath(replacements(core_1.normalize(file)));\n                if (replacement !== file) {\n                    reverseReplacements.set(replacement, file);\n                }\n                return replacement;\n            }\n            else {\n                const replacement = replacements.get(core_1.normalize(file));\n                if (replacement) {\n                    const fullReplacement = core_1.getSystemPath(replacement);\n                    reverseReplacements.set(fullReplacement, file);\n                    return fullReplacement;\n                }\n                else {\n                    return file;\n                }\n            }\n        });\n    }\n    reverseTimestamps(map, reverseReplacements) {\n        for (const entry of Array.from(map.entries())) {\n            const original = reverseReplacements.get(entry[0]);\n            if (original) {\n                map.set(original, entry[1]);\n                map.delete(entry[0]);\n            }\n        }\n        return map;\n    }\n    createWebpack4Watch() {\n        return (files, dirs, missing, startTime, options, callback, callbackUndelayed) => {\n            const reverseReplacements = new Map();\n            const newCallbackUndelayed = (filename, timestamp) => {\n                const original = reverseReplacements.get(filename);\n                if (original) {\n                    this._virtualInputFileSystem.purge(original);\n                    callbackUndelayed(original, timestamp);\n                }\n                else {\n                    callbackUndelayed(filename, timestamp);\n                }\n            };\n            const newCallback = (err, filesModified, contextModified, missingModified, fileTimestamps, contextTimestamps) => {\n                // Update fileTimestamps with timestamps from virtual files.\n                const virtualFilesStats = this._virtualInputFileSystem.getVirtualFilesPaths()\n                    .map((fileName) => ({\n                    path: fileName,\n                    mtime: +this._virtualInputFileSystem.statSync(fileName).mtime,\n                }));\n                virtualFilesStats.forEach(stats => fileTimestamps.set(stats.path, +stats.mtime));\n                callback(err, filesModified.map(value => reverseReplacements.get(value) || value), contextModified.map(value => reverseReplacements.get(value) || value), missingModified.map(value => reverseReplacements.get(value) || value), this.reverseTimestamps(fileTimestamps, reverseReplacements), this.reverseTimestamps(contextTimestamps, reverseReplacements));\n            };\n            const watcher = super.watch(this.mapReplacements(files, reverseReplacements), this.mapReplacements(dirs, reverseReplacements), this.mapReplacements(missing, reverseReplacements), startTime, options, newCallback, newCallbackUndelayed);\n            return {\n                close: () => watcher.close(),\n                pause: () => watcher.pause(),\n                getFileTimestamps: () => this.reverseTimestamps(watcher.getFileTimestamps(), reverseReplacements),\n                getContextTimestamps: () => this.reverseTimestamps(watcher.getContextTimestamps(), reverseReplacements),\n            };\n        };\n    }\n    createWebpack5Watch() {\n        return (files, dirs, missing, startTime, options, callback, callbackUndelayed) => {\n            const reverseReplacements = new Map();\n            const newCallbackUndelayed = (filename, timestamp) => {\n                const original = reverseReplacements.get(filename);\n                if (original) {\n                    this._virtualInputFileSystem.purge(original);\n                    callbackUndelayed(original, timestamp);\n                }\n                else {\n                    callbackUndelayed(filename, timestamp);\n                }\n            };\n            const newCallback = (err, \n            // tslint:disable-next-line: no-any\n            fileTimeInfoEntries, \n            // tslint:disable-next-line: no-any\n            contextTimeInfoEntries, missing, removals) => {\n                // Update fileTimestamps with timestamps from virtual files.\n                const virtualFilesStats = this._virtualInputFileSystem.getVirtualFilesPaths()\n                    .map((fileName) => ({\n                    path: fileName,\n                    mtime: +this._virtualInputFileSystem.statSync(fileName).mtime,\n                }));\n                virtualFilesStats.forEach(stats => fileTimeInfoEntries.set(stats.path, +stats.mtime));\n                callback(err, this.reverseTimestamps(fileTimeInfoEntries, reverseReplacements), this.reverseTimestamps(contextTimeInfoEntries, reverseReplacements), new Set([...missing].map(value => reverseReplacements.get(value) || value)), new Set([...removals].map(value => reverseReplacements.get(value) || value)));\n            };\n            const watcher = super.watch(this.mapReplacements(files, reverseReplacements), this.mapReplacements(dirs, reverseReplacements), this.mapReplacements(missing, reverseReplacements), startTime, options, newCallback, newCallbackUndelayed);\n            return {\n                close: () => watcher.close(),\n                pause: () => watcher.pause(),\n                getFileTimeInfoEntries: () => this.reverseTimestamps(watcher.getFileTimeInfoEntries(), reverseReplacements),\n                getContextTimeInfoEntries: () => this.reverseTimestamps(watcher.getContextTimeInfoEntries(), reverseReplacements),\n            };\n        };\n    }\n}\nexports.VirtualWatchFileSystemDecorator = VirtualWatchFileSystemDecorator;\n"]},"metadata":{},"sourceType":"script"}