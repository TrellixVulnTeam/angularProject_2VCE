{"ast":null,"code":"var KarmaEventEmitter = require('../events').EventEmitter;\n\nvar EventEmitter = require('events').EventEmitter;\n\nvar log = require('../logger').create('launcher');\n\nvar helper = require('../helper');\n\nvar BEING_CAPTURED = 'BEING_CAPTURED';\nvar CAPTURED = 'CAPTURED';\nvar BEING_KILLED = 'BEING_KILLED';\nvar FINISHED = 'FINISHED';\nvar RESTARTING = 'RESTARTING';\nvar BEING_FORCE_KILLED = 'BEING_FORCE_KILLED';\n/**\n * Base launcher that any custom launcher extends.\n */\n\nfunction BaseLauncher(id, emitter) {\n  var _this = this;\n\n  if (this.start) {\n    return;\n  } // TODO(vojta): figure out how to do inheritance with DI\n\n\n  Object.keys(EventEmitter.prototype).forEach(function (method) {\n    this[method] = EventEmitter.prototype[method];\n  }, this);\n  this.bind = KarmaEventEmitter.prototype.bind.bind(this);\n  this.emitAsync = KarmaEventEmitter.prototype.emitAsync.bind(this);\n  this.id = id;\n  this._state = null;\n  Object.defineProperty(this, 'state', {\n    get: function get() {\n      return _this._state;\n    },\n    set: function set(toState) {\n      log.debug(\"\".concat(_this._state, \" -> \").concat(toState));\n      _this._state = toState;\n    }\n  });\n  this.error = null;\n  var killingPromise;\n  var previousUrl;\n\n  this.start = function (url) {\n    previousUrl = url;\n    this.error = null;\n    this.state = BEING_CAPTURED;\n    this.emit('start', url + '?id=' + this.id + (helper.isDefined(this.displayName) ? '&displayName=' + encodeURIComponent(this.displayName) : ''));\n  };\n\n  this.kill = function () {\n    var _this2 = this;\n\n    // Already killed, or being killed.\n    if (killingPromise) {\n      return killingPromise;\n    }\n\n    killingPromise = this.emitAsync('kill').then(function () {\n      _this2.state = FINISHED;\n    });\n    this.state = BEING_KILLED;\n    return killingPromise;\n  };\n\n  this.forceKill = function () {\n    this.kill();\n    this.state = BEING_FORCE_KILLED;\n    return killingPromise;\n  };\n\n  this.restart = function () {\n    var _this3 = this;\n\n    if (this.state === BEING_FORCE_KILLED) {\n      return;\n    }\n\n    if (!killingPromise) {\n      killingPromise = this.emitAsync('kill');\n    }\n\n    killingPromise.then(function () {\n      if (_this3.state === BEING_FORCE_KILLED) {\n        _this3.state = FINISHED;\n      } else {\n        killingPromise = null;\n        log.debug(\"Restarting \".concat(_this3.name));\n\n        _this3.start(previousUrl);\n      }\n    });\n    this.state = RESTARTING;\n  };\n\n  this.markCaptured = function () {\n    if (this.state === BEING_CAPTURED) {\n      this.state = CAPTURED;\n    }\n  };\n\n  this.isCaptured = function () {\n    return this.state === CAPTURED;\n  };\n\n  this.toString = function () {\n    return this.name;\n  };\n\n  this._done = function (error) {\n    killingPromise = killingPromise || Promise.resolve();\n    this.error = this.error || error;\n    this.emit('done');\n\n    if (this.error && this.state !== BEING_FORCE_KILLED && this.state !== RESTARTING) {\n      emitter.emit('browser_process_failure', this);\n    }\n\n    this.state = FINISHED;\n  };\n\n  this.STATE_BEING_CAPTURED = BEING_CAPTURED;\n  this.STATE_CAPTURED = CAPTURED;\n  this.STATE_BEING_KILLED = BEING_KILLED;\n  this.STATE_FINISHED = FINISHED;\n  this.STATE_RESTARTING = RESTARTING;\n  this.STATE_BEING_FORCE_KILLED = BEING_FORCE_KILLED;\n}\n\nBaseLauncher.decoratorFactory = function (id, emitter) {\n  return function (launcher) {\n    BaseLauncher.call(launcher, id, emitter);\n  };\n};\n\nmodule.exports = BaseLauncher;","map":{"version":3,"sources":["/Users/abdillahihussein/Documents/GitHub/angularProject/node_modules/karma/lib/launchers/base.js"],"names":["KarmaEventEmitter","require","EventEmitter","log","create","helper","BEING_CAPTURED","CAPTURED","BEING_KILLED","FINISHED","RESTARTING","BEING_FORCE_KILLED","BaseLauncher","id","emitter","start","Object","keys","prototype","forEach","method","bind","emitAsync","_state","defineProperty","get","set","toState","debug","error","killingPromise","previousUrl","url","state","emit","isDefined","displayName","encodeURIComponent","kill","then","forceKill","restart","name","markCaptured","isCaptured","toString","_done","Promise","resolve","STATE_BEING_CAPTURED","STATE_CAPTURED","STATE_BEING_KILLED","STATE_FINISHED","STATE_RESTARTING","STATE_BEING_FORCE_KILLED","decoratorFactory","launcher","call","module","exports"],"mappings":"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","sourcesContent":["const KarmaEventEmitter = require('../events').EventEmitter\nconst EventEmitter = require('events').EventEmitter\n\nconst log = require('../logger').create('launcher')\nconst helper = require('../helper')\n\nconst BEING_CAPTURED = 'BEING_CAPTURED'\nconst CAPTURED = 'CAPTURED'\nconst BEING_KILLED = 'BEING_KILLED'\nconst FINISHED = 'FINISHED'\nconst RESTARTING = 'RESTARTING'\nconst BEING_FORCE_KILLED = 'BEING_FORCE_KILLED'\n\n/**\n * Base launcher that any custom launcher extends.\n */\nfunction BaseLauncher (id, emitter) {\n  if (this.start) {\n    return\n  }\n\n  // TODO(vojta): figure out how to do inheritance with DI\n  Object.keys(EventEmitter.prototype).forEach(function (method) {\n    this[method] = EventEmitter.prototype[method]\n  }, this)\n\n  this.bind = KarmaEventEmitter.prototype.bind.bind(this)\n  this.emitAsync = KarmaEventEmitter.prototype.emitAsync.bind(this)\n\n  this.id = id\n  this._state = null\n  Object.defineProperty(this, 'state', {\n    get: () => {\n      return this._state\n    },\n    set: (toState) => {\n      log.debug(`${this._state} -> ${toState}`)\n      this._state = toState\n    }\n  })\n\n  this.error = null\n\n  let killingPromise\n  let previousUrl\n\n  this.start = function (url) {\n    previousUrl = url\n\n    this.error = null\n    this.state = BEING_CAPTURED\n    this.emit('start', url + '?id=' + this.id + (helper.isDefined(this.displayName) ? '&displayName=' + encodeURIComponent(this.displayName) : ''))\n  }\n\n  this.kill = function () {\n    // Already killed, or being killed.\n    if (killingPromise) {\n      return killingPromise\n    }\n\n    killingPromise = this.emitAsync('kill').then(() => {\n      this.state = FINISHED\n    })\n\n    this.state = BEING_KILLED\n\n    return killingPromise\n  }\n\n  this.forceKill = function () {\n    this.kill()\n    this.state = BEING_FORCE_KILLED\n\n    return killingPromise\n  }\n\n  this.restart = function () {\n    if (this.state === BEING_FORCE_KILLED) {\n      return\n    }\n\n    if (!killingPromise) {\n      killingPromise = this.emitAsync('kill')\n    }\n\n    killingPromise.then(() => {\n      if (this.state === BEING_FORCE_KILLED) {\n        this.state = FINISHED\n      } else {\n        killingPromise = null\n        log.debug(`Restarting ${this.name}`)\n        this.start(previousUrl)\n      }\n    })\n\n    this.state = RESTARTING\n  }\n\n  this.markCaptured = function () {\n    if (this.state === BEING_CAPTURED) {\n      this.state = CAPTURED\n    }\n  }\n\n  this.isCaptured = function () {\n    return this.state === CAPTURED\n  }\n\n  this.toString = function () {\n    return this.name\n  }\n\n  this._done = function (error) {\n    killingPromise = killingPromise || Promise.resolve()\n\n    this.error = this.error || error\n    this.emit('done')\n\n    if (this.error && this.state !== BEING_FORCE_KILLED && this.state !== RESTARTING) {\n      emitter.emit('browser_process_failure', this)\n    }\n\n    this.state = FINISHED\n  }\n\n  this.STATE_BEING_CAPTURED = BEING_CAPTURED\n  this.STATE_CAPTURED = CAPTURED\n  this.STATE_BEING_KILLED = BEING_KILLED\n  this.STATE_FINISHED = FINISHED\n  this.STATE_RESTARTING = RESTARTING\n  this.STATE_BEING_FORCE_KILLED = BEING_FORCE_KILLED\n}\n\nBaseLauncher.decoratorFactory = function (id, emitter) {\n  return function (launcher) {\n    BaseLauncher.call(launcher, id, emitter)\n  }\n}\n\nmodule.exports = BaseLauncher\n"]},"metadata":{},"sourceType":"script"}