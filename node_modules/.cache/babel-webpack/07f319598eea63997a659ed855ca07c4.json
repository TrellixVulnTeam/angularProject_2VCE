{"ast":null,"code":"\"use strict\";\n/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nvar _createForOfIteratorHelper = require(\"/Users/abdillahihussein/Documents/GitHub/angularProject/node_modules/@babel/runtime/helpers/createForOfIteratorHelper\");\n\nvar _regeneratorRuntime = require(\"/Users/abdillahihussein/Documents/GitHub/angularProject/node_modules/@babel/runtime/regenerator\");\n\nvar _slicedToArray = require(\"/Users/abdillahihussein/Documents/GitHub/angularProject/node_modules/@babel/runtime/helpers/slicedToArray\");\n\nvar _defineProperty = require(\"/Users/abdillahihussein/Documents/GitHub/angularProject/node_modules/@babel/runtime/helpers/defineProperty\");\n\nvar _objectSpread = require(\"/Users/abdillahihussein/Documents/GitHub/angularProject/node_modules/@babel/runtime/helpers/objectSpread2\");\n\nvar _taggedTemplateLiteral = require(\"/Users/abdillahihussein/Documents/GitHub/angularProject/node_modules/@babel/runtime/helpers/taggedTemplateLiteral\");\n\nvar _toConsumableArray = require(\"/Users/abdillahihussein/Documents/GitHub/angularProject/node_modules/@babel/runtime/helpers/toConsumableArray\");\n\nvar _asyncToGenerator = require(\"/Users/abdillahihussein/Documents/GitHub/angularProject/node_modules/@babel/runtime/helpers/asyncToGenerator\");\n\nvar _templateObject, _templateObject2, _templateObject3, _templateObject4, _templateObject5;\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.serveWebpackBrowser = void 0;\n\nvar architect_1 = require(\"@angular-devkit/architect\");\n\nvar build_webpack_1 = require(\"@angular-devkit/build-webpack\");\n\nvar core_1 = require(\"@angular-devkit/core\");\n\nvar node_1 = require(\"@angular-devkit/core/node\");\n\nvar path = require(\"path\");\n\nvar rxjs_1 = require(\"rxjs\");\n\nvar operators_1 = require(\"rxjs/operators\");\n\nvar ts = require(\"typescript\");\n\nvar url = require(\"url\");\n\nvar webpackDevServer = require(\"webpack-dev-server\");\n\nvar browser_1 = require(\"../browser\");\n\nvar schema_1 = require(\"../browser/schema\");\n\nvar utils_1 = require(\"../utils\");\n\nvar cache_path_1 = require(\"../utils/cache-path\");\n\nvar check_port_1 = require(\"../utils/check-port\");\n\nvar color_1 = require(\"../utils/color\");\n\nvar transforms_1 = require(\"../utils/index-file/transforms\");\n\nvar package_chunk_sort_1 = require(\"../utils/package-chunk-sort\");\n\nvar process_bundle_1 = require(\"../utils/process-bundle\");\n\nvar read_tsconfig_1 = require(\"../utils/read-tsconfig\");\n\nvar version_1 = require(\"../utils/version\");\n\nvar webpack_browser_config_1 = require(\"../utils/webpack-browser-config\");\n\nvar webpack_diagnostics_1 = require(\"../utils/webpack-diagnostics\");\n\nvar configs_1 = require(\"../webpack/configs\");\n\nvar dev_server_1 = require(\"../webpack/configs/dev-server\");\n\nvar index_html_webpack_plugin_1 = require(\"../webpack/plugins/index-html-webpack-plugin\");\n\nvar stats_1 = require(\"../webpack/utils/stats\");\n\nvar devServerBuildOverriddenKeys = ['watch', 'optimization', 'aot', 'sourceMap', 'vendorChunk', 'commonChunk', 'baseHref', 'progress', 'poll', 'verbose', 'deployUrl'];\n/**\n * Reusable implementation of the build angular webpack dev server builder.\n * @param options Dev Server options.\n * @param context The build context.\n * @param transforms A map of transforms that can be used to hook into some logic (such as\n *     transforming webpack configuration before passing it to webpack).\n */\n// tslint:disable-next-line: no-big-function\n\nfunction serveWebpackBrowser(options, context) {\n  var transforms = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n  // Check Angular version.\n  var logger = context.logger,\n      workspaceRoot = context.workspaceRoot;\n  version_1.assertCompatibleAngularVersion(workspaceRoot, logger);\n  var browserTarget = architect_1.targetFromTargetString(options.browserTarget);\n  var host = new node_1.NodeJsSyncHost();\n\n  function setup() {\n    return _setup.apply(this, arguments);\n  }\n\n  function _setup() {\n    _setup = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var _a, rawBrowserOptions, overrides, devServerOptions, browserName, browserOptions, _yield$webpack_browse, config, projectRoot, i18n, _i, _Object$entries, _Object$entries$_i, key, value, webpackClientScriptIndex, webpackConfig, tsConfig;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return context.getTargetOptions(browserTarget);\n\n            case 2:\n              rawBrowserOptions = _context.sent;\n              _context.next = 5;\n              return check_port_1.checkPort((_a = options.port) !== null && _a !== void 0 ? _a : 4200, options.host || 'localhost');\n\n            case 5:\n              options.port = _context.sent;\n              // Override options we need to override, if defined.\n              overrides = Object.keys(options).filter(function (key) {\n                return options[key] !== undefined && devServerBuildOverriddenKeys.includes(key);\n              }).reduce(function (previous, key) {\n                return _objectSpread(_objectSpread({}, previous), {}, _defineProperty({}, key, options[key]));\n              }, {}); // Get dev-server only options.\n\n              devServerOptions = Object.keys(options).filter(function (key) {\n                return !devServerBuildOverriddenKeys.includes(key) && key !== 'browserTarget';\n              }).reduce(function (previous, key) {\n                return _objectSpread(_objectSpread({}, previous), {}, _defineProperty({}, key, options[key]));\n              }, {}); // In dev server we should not have budgets because of extra libs such as socks-js\n\n              overrides.budgets = undefined;\n\n              if (rawBrowserOptions.outputHashing && rawBrowserOptions.outputHashing !== schema_1.OutputHashing.None) {\n                // Disable output hashing for dev build as this can cause memory leaks\n                // See: https://github.com/webpack/webpack-dev-server/issues/377#issuecomment-241258405\n                overrides.outputHashing = schema_1.OutputHashing.None;\n                logger.warn(\"Warning: 'outputHashing' option is disabled when using the dev-server.\");\n              }\n\n              _context.next = 12;\n              return context.getBuilderNameForTarget(browserTarget);\n\n            case 12:\n              browserName = _context.sent;\n              _context.next = 15;\n              return context.validateOptions(_objectSpread(_objectSpread({}, rawBrowserOptions), overrides), browserName);\n\n            case 15:\n              browserOptions = _context.sent;\n              _context.next = 18;\n              return webpack_browser_config_1.generateI18nBrowserWebpackConfigFromContext(browserOptions, context, function (wco) {\n                return [dev_server_1.getDevServerConfig(wco), configs_1.getCommonConfig(wco), configs_1.getBrowserConfig(wco), configs_1.getStylesConfig(wco), configs_1.getStatsConfig(wco), browser_1.getAnalyticsConfig(wco, context), browser_1.getCompilerConfig(wco), browserOptions.webWorkerTsConfig ? configs_1.getWorkerConfig(wco) : {}];\n              }, host, devServerOptions);\n\n            case 18:\n              _yield$webpack_browse = _context.sent;\n              config = _yield$webpack_browse.config;\n              projectRoot = _yield$webpack_browse.projectRoot;\n              i18n = _yield$webpack_browse.i18n;\n\n              if (config.devServer) {\n                _context.next = 24;\n                break;\n              }\n\n              throw new Error('Webpack Dev Server configuration was not set.');\n\n            case 24:\n              if (!(options.liveReload && !options.hmr)) {\n                _context.next = 37;\n                break;\n              }\n\n              // This is needed because we cannot use the inline option directly in the config\n              // because of the SuppressExtractedTextChunksWebpackPlugin\n              // Consider not using SuppressExtractedTextChunksWebpackPlugin when liveReload is enable.\n              webpackDevServer.addDevServerEntrypoints(config, _objectSpread(_objectSpread({}, config.devServer), {}, {\n                inline: true\n              })); // Remove live-reload code from all entrypoints but not main.\n              // Otherwise this will break SuppressExtractedTextChunksWebpackPlugin because\n              // 'addDevServerEntrypoints' adds addional entry-points to all entries.\n\n              if (!(config.entry && typeof config.entry === 'object' && !Array.isArray(config.entry) && config.entry.main)) {\n                _context.next = 37;\n                break;\n              }\n\n              _i = 0, _Object$entries = Object.entries(config.entry);\n\n            case 28:\n              if (!(_i < _Object$entries.length)) {\n                _context.next = 37;\n                break;\n              }\n\n              _Object$entries$_i = _slicedToArray(_Object$entries[_i], 2), key = _Object$entries$_i[0], value = _Object$entries$_i[1];\n\n              if (!(key === 'main' || typeof value === 'string')) {\n                _context.next = 32;\n                break;\n              }\n\n              return _context.abrupt(\"continue\", 34);\n\n            case 32:\n              webpackClientScriptIndex = value.findIndex(function (x) {\n                return x.includes('webpack-dev-server/client/index.js');\n              });\n\n              if (webpackClientScriptIndex >= 0) {\n                // Remove the webpack-dev-server/client script from array.\n                value.splice(webpackClientScriptIndex, 1);\n              }\n\n            case 34:\n              _i++;\n              _context.next = 28;\n              break;\n\n            case 37:\n              if (options.hmr) {\n                logger.warn(core_1.tags.stripIndents(_templateObject3 || (_templateObject3 = _taggedTemplateLiteral([\"NOTICE: Hot Module Replacement (HMR) is enabled for the dev server.\\n      See https://webpack.js.org/guides/hot-module-replacement for information on working with HMR for Webpack.\"]))));\n              }\n\n              if (options.host && !/^127\\.\\d+\\.\\d+\\.\\d+/g.test(options.host) && options.host !== 'localhost') {\n                logger.warn(core_1.tags.stripIndent(_templateObject4 || (_templateObject4 = _taggedTemplateLiteral([\"\\n        Warning: This is a simple server for use in testing or debugging Angular applications\\n        locally. It hasn't been reviewed for security issues.\\n\\n        Binding this server to an open connection can result in compromising your application or\\n        computer. Using a different host than the one passed to the \\\"--host\\\" flag might result in\\n        websocket connection issues. You might need to use \\\"--disableHostCheck\\\" if that's the\\n        case.\\n      \"]))));\n              }\n\n              if (options.disableHostCheck) {\n                logger.warn(core_1.tags.oneLine(_templateObject5 || (_templateObject5 = _taggedTemplateLiteral([\"\\n        Warning: Running a server with --disable-host-check is a security risk.\\n        See https://medium.com/webpack/webpack-dev-server-middleware-security-issues-1489d950874a\\n        for more information.\\n      \"]))));\n              }\n\n              webpackConfig = config;\n              tsConfig = read_tsconfig_1.readTsconfig(browserOptions.tsConfig, workspaceRoot);\n\n              if (!(i18n.shouldInline && tsConfig.options.enableIvy !== false)) {\n                _context.next = 47;\n                break;\n              }\n\n              if (!(i18n.inlineLocales.size > 1)) {\n                _context.next = 45;\n                break;\n              }\n\n              throw new Error('The development server only supports localizing a single locale per build.');\n\n            case 45:\n              _context.next = 47;\n              return setupLocalize(i18n, browserOptions, webpackConfig);\n\n            case 47:\n              if (!transforms.webpackConfiguration) {\n                _context.next = 51;\n                break;\n              }\n\n              _context.next = 50;\n              return transforms.webpackConfiguration(webpackConfig);\n\n            case 50:\n              webpackConfig = _context.sent;\n\n            case 51:\n              return _context.abrupt(\"return\", {\n                browserOptions: browserOptions,\n                webpackConfig: webpackConfig,\n                projectRoot: projectRoot,\n                locale: browserOptions.i18nLocale || (i18n.shouldInline ? _toConsumableArray(i18n.inlineLocales)[0] : undefined)\n              });\n\n            case 52:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n    return _setup.apply(this, arguments);\n  }\n\n  return rxjs_1.from(setup()).pipe(operators_1.switchMap(function (_ref) {\n    var browserOptions = _ref.browserOptions,\n        webpackConfig = _ref.webpackConfig,\n        projectRoot = _ref.projectRoot,\n        locale = _ref.locale;\n    var normalizedOptimization = utils_1.normalizeOptimization(browserOptions.optimization);\n\n    if (browserOptions.index) {\n      var _browserOptions$scrip = browserOptions.scripts,\n          scripts = _browserOptions$scrip === void 0 ? [] : _browserOptions$scrip,\n          _browserOptions$style = browserOptions.styles,\n          styles = _browserOptions$style === void 0 ? [] : _browserOptions$style,\n          baseHref = browserOptions.baseHref,\n          tsConfig = browserOptions.tsConfig;\n\n      var _read_tsconfig_1$read = read_tsconfig_1.readTsconfig(tsConfig, workspaceRoot),\n          compilerOptions = _read_tsconfig_1$read.options;\n\n      var target = compilerOptions.target || ts.ScriptTarget.ES5;\n      var buildBrowserFeatures = new utils_1.BuildBrowserFeatures(projectRoot);\n      var entrypoints = package_chunk_sort_1.generateEntryPoints({\n        scripts: scripts,\n        styles: styles\n      });\n      var moduleEntrypoints = buildBrowserFeatures.isDifferentialLoadingNeeded(target) ? package_chunk_sort_1.generateEntryPoints({\n        scripts: [],\n        styles: styles\n      }) : [];\n      webpackConfig.plugins = _toConsumableArray(webpackConfig.plugins || []);\n      webpackConfig.plugins.push(new index_html_webpack_plugin_1.IndexHtmlWebpackPlugin({\n        input: path.resolve(workspaceRoot, webpack_browser_config_1.getIndexInputFile(browserOptions.index)),\n        output: webpack_browser_config_1.getIndexOutputFile(browserOptions.index),\n        baseHref: baseHref,\n        moduleEntrypoints: moduleEntrypoints,\n        entrypoints: entrypoints,\n        deployUrl: browserOptions.deployUrl,\n        sri: browserOptions.subresourceIntegrity,\n        noModuleEntrypoints: ['polyfills-es5'],\n        postTransforms: transforms_1.getHtmlTransforms(normalizedOptimization, buildBrowserFeatures, transforms.indexHtml),\n        crossOrigin: browserOptions.crossOrigin,\n        lang: locale\n      }));\n    }\n\n    if (normalizedOptimization.scripts || normalizedOptimization.styles) {\n      logger.error(core_1.tags.stripIndents(_templateObject || (_templateObject = _taggedTemplateLiteral([\"\\n          ****************************************************************************************\\n          This is a simple server for use in testing or debugging Angular applications locally.\\n          It hasn't been reviewed for security issues.\\n\\n          DON'T USE IT FOR PRODUCTION!\\n          ****************************************************************************************\\n        \"]))));\n    }\n\n    return build_webpack_1.runWebpackDevServer(webpackConfig, context, {\n      logging: transforms.logging || stats_1.createWebpackLoggingCallback(!!options.verbose, logger),\n      webpackFactory: require('webpack'),\n      webpackDevServerFactory: require('webpack-dev-server')\n    }).pipe(operators_1.concatMap(function (buildEvent, index) {\n      var _a; // Resolve serve address.\n\n\n      var serverAddress = url.format({\n        protocol: options.ssl ? 'https' : 'http',\n        hostname: options.host === '0.0.0.0' ? 'localhost' : options.host,\n        pathname: (_a = webpackConfig.devServer) === null || _a === void 0 ? void 0 : _a.publicPath,\n        port: buildEvent.port\n      });\n\n      if (index === 0) {\n        logger.info('\\n' + core_1.tags.oneLine(_templateObject2 || (_templateObject2 = _taggedTemplateLiteral([\"\\n              **\\n              Angular Live Development Server is listening on \", \":\", \",\\n              open your browser on \", \"\\n              **\\n            \"])), options.host, buildEvent.port, serverAddress) + '\\n');\n\n        if (options.open) {\n          var open = require('open');\n\n          open(serverAddress);\n        }\n      }\n\n      if (buildEvent.success) {\n        logger.info(\"\\n\".concat(color_1.colors.greenBright(color_1.colors.symbols.check), \" Compiled successfully.\"));\n      }\n\n      return rxjs_1.of(_objectSpread(_objectSpread({}, buildEvent), {}, {\n        baseUrl: serverAddress\n      }));\n    }));\n  }));\n}\n\nexports.serveWebpackBrowser = serveWebpackBrowser;\n\nfunction setupLocalize(_x, _x2, _x3) {\n  return _setupLocalize.apply(this, arguments);\n}\n\nfunction _setupLocalize() {\n  _setupLocalize = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(i18n, browserOptions, webpackConfig) {\n    var _a, locale, localeDescription, _yield$process_bundle, plugins, diagnostics, i18nRule, rules;\n\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            locale = _toConsumableArray(i18n.inlineLocales)[0];\n            localeDescription = i18n.locales[locale];\n            _context2.next = 4;\n            return process_bundle_1.createI18nPlugins(locale, localeDescription === null || localeDescription === void 0 ? void 0 : localeDescription.translation, browserOptions.i18nMissingTranslation || 'ignore');\n\n          case 4:\n            _yield$process_bundle = _context2.sent;\n            plugins = _yield$process_bundle.plugins;\n            diagnostics = _yield$process_bundle.diagnostics;\n\n            // Modify main entrypoint to include locale data\n            if ((localeDescription === null || localeDescription === void 0 ? void 0 : localeDescription.dataPath) && typeof webpackConfig.entry === 'object' && !Array.isArray(webpackConfig.entry) && webpackConfig.entry['main']) {\n              if (Array.isArray(webpackConfig.entry['main'])) {\n                webpackConfig.entry['main'].unshift(localeDescription.dataPath);\n              } else {\n                webpackConfig.entry['main'] = [localeDescription.dataPath, webpackConfig.entry['main']];\n              }\n            }\n\n            i18nRule = {\n              test: /\\.(?:m?js|ts)$/,\n              enforce: 'post',\n              use: [{\n                loader: require.resolve('babel-loader'),\n                options: {\n                  babelrc: false,\n                  configFile: false,\n                  compact: false,\n                  cacheCompression: false,\n                  cacheDirectory: cache_path_1.findCachePath('babel-loader'),\n                  cacheIdentifier: JSON.stringify({\n                    buildAngular: require('../../package.json').version,\n                    locale: locale,\n                    translationIntegrity: localeDescription === null || localeDescription === void 0 ? void 0 : localeDescription.files.map(function (file) {\n                      return file.integrity;\n                    })\n                  }),\n                  plugins: plugins\n                }\n              }]\n            }; // Get the rules and ensure the Webpack configuration is setup properly\n\n            rules = ((_a = webpackConfig.module) === null || _a === void 0 ? void 0 : _a.rules) || [];\n\n            if (!webpackConfig.module) {\n              webpackConfig.module = {\n                rules: rules\n              };\n            } else if (!webpackConfig.module.rules) {\n              webpackConfig.module.rules = rules;\n            }\n\n            rules.push(i18nRule); // Add a plugin to inject the i18n diagnostics\n            // tslint:disable-next-line: no-non-null-assertion\n\n            webpackConfig.plugins.push({\n              apply: function apply(compiler) {\n                compiler.hooks.thisCompilation.tap('build-angular', function (compilation) {\n                  compilation.hooks.finishModules.tap('build-angular', function () {\n                    if (!diagnostics) {\n                      return;\n                    }\n\n                    var _iterator = _createForOfIteratorHelper(diagnostics.messages),\n                        _step;\n\n                    try {\n                      for (_iterator.s(); !(_step = _iterator.n()).done;) {\n                        var diagnostic = _step.value;\n\n                        if (diagnostic.type === 'error') {\n                          webpack_diagnostics_1.addError(compilation, diagnostic.message);\n                        } else {\n                          webpack_diagnostics_1.addWarning(compilation, diagnostic.message);\n                        }\n                      }\n                    } catch (err) {\n                      _iterator.e(err);\n                    } finally {\n                      _iterator.f();\n                    }\n\n                    diagnostics.messages.length = 0;\n                  });\n                });\n              }\n            });\n\n          case 13:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n  return _setupLocalize.apply(this, arguments);\n}\n\nexports.default = architect_1.createBuilder(serveWebpackBrowser);","map":{"version":3,"sources":["/Users/abdillahihussein/Documents/GitHub/angularProject/node_modules/@angular-devkit/build-angular/src/dev-server/index.js"],"names":["Object","defineProperty","exports","value","serveWebpackBrowser","architect_1","require","build_webpack_1","core_1","node_1","path","rxjs_1","operators_1","ts","url","webpackDevServer","browser_1","schema_1","utils_1","cache_path_1","check_port_1","color_1","transforms_1","package_chunk_sort_1","process_bundle_1","read_tsconfig_1","version_1","webpack_browser_config_1","webpack_diagnostics_1","configs_1","dev_server_1","index_html_webpack_plugin_1","stats_1","devServerBuildOverriddenKeys","options","context","transforms","logger","workspaceRoot","assertCompatibleAngularVersion","browserTarget","targetFromTargetString","host","NodeJsSyncHost","setup","getTargetOptions","rawBrowserOptions","checkPort","_a","port","overrides","keys","filter","key","undefined","includes","reduce","previous","devServerOptions","budgets","outputHashing","OutputHashing","None","warn","getBuilderNameForTarget","browserName","validateOptions","browserOptions","generateI18nBrowserWebpackConfigFromContext","wco","getDevServerConfig","getCommonConfig","getBrowserConfig","getStylesConfig","getStatsConfig","getAnalyticsConfig","getCompilerConfig","webWorkerTsConfig","getWorkerConfig","config","projectRoot","i18n","devServer","Error","liveReload","hmr","addDevServerEntrypoints","inline","entry","Array","isArray","main","entries","webpackClientScriptIndex","findIndex","x","splice","tags","stripIndents","test","stripIndent","disableHostCheck","oneLine","webpackConfig","tsConfig","readTsconfig","shouldInline","enableIvy","inlineLocales","size","setupLocalize","webpackConfiguration","locale","i18nLocale","from","pipe","switchMap","normalizedOptimization","normalizeOptimization","optimization","index","scripts","styles","baseHref","compilerOptions","target","ScriptTarget","ES5","buildBrowserFeatures","BuildBrowserFeatures","entrypoints","generateEntryPoints","moduleEntrypoints","isDifferentialLoadingNeeded","plugins","push","IndexHtmlWebpackPlugin","input","resolve","getIndexInputFile","output","getIndexOutputFile","deployUrl","sri","subresourceIntegrity","noModuleEntrypoints","postTransforms","getHtmlTransforms","indexHtml","crossOrigin","lang","error","runWebpackDevServer","logging","createWebpackLoggingCallback","verbose","webpackFactory","webpackDevServerFactory","concatMap","buildEvent","serverAddress","format","protocol","ssl","hostname","pathname","publicPath","info","open","success","colors","greenBright","symbols","check","of","baseUrl","localeDescription","locales","createI18nPlugins","translation","i18nMissingTranslation","diagnostics","dataPath","unshift","i18nRule","enforce","use","loader","babelrc","configFile","compact","cacheCompression","cacheDirectory","findCachePath","cacheIdentifier","JSON","stringify","buildAngular","version","translationIntegrity","files","map","file","integrity","rules","module","apply","compiler","hooks","thisCompilation","tap","compilation","finishModules","messages","diagnostic","type","addError","message","addWarning","length","default","createBuilder"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;AACAA,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAAEC,EAAAA,KAAK,EAAE;AAAT,CAA7C;AACAD,OAAO,CAACE,mBAAR,GAA8B,KAAK,CAAnC;;AACA,IAAMC,WAAW,GAAGC,OAAO,CAAC,2BAAD,CAA3B;;AACA,IAAMC,eAAe,GAAGD,OAAO,CAAC,+BAAD,CAA/B;;AACA,IAAME,MAAM,GAAGF,OAAO,CAAC,sBAAD,CAAtB;;AACA,IAAMG,MAAM,GAAGH,OAAO,CAAC,2BAAD,CAAtB;;AACA,IAAMI,IAAI,GAAGJ,OAAO,CAAC,MAAD,CAApB;;AACA,IAAMK,MAAM,GAAGL,OAAO,CAAC,MAAD,CAAtB;;AACA,IAAMM,WAAW,GAAGN,OAAO,CAAC,gBAAD,CAA3B;;AACA,IAAMO,EAAE,GAAGP,OAAO,CAAC,YAAD,CAAlB;;AACA,IAAMQ,GAAG,GAAGR,OAAO,CAAC,KAAD,CAAnB;;AACA,IAAMS,gBAAgB,GAAGT,OAAO,CAAC,oBAAD,CAAhC;;AACA,IAAMU,SAAS,GAAGV,OAAO,CAAC,YAAD,CAAzB;;AACA,IAAMW,QAAQ,GAAGX,OAAO,CAAC,mBAAD,CAAxB;;AACA,IAAMY,OAAO,GAAGZ,OAAO,CAAC,UAAD,CAAvB;;AACA,IAAMa,YAAY,GAAGb,OAAO,CAAC,qBAAD,CAA5B;;AACA,IAAMc,YAAY,GAAGd,OAAO,CAAC,qBAAD,CAA5B;;AACA,IAAMe,OAAO,GAAGf,OAAO,CAAC,gBAAD,CAAvB;;AACA,IAAMgB,YAAY,GAAGhB,OAAO,CAAC,gCAAD,CAA5B;;AACA,IAAMiB,oBAAoB,GAAGjB,OAAO,CAAC,6BAAD,CAApC;;AACA,IAAMkB,gBAAgB,GAAGlB,OAAO,CAAC,yBAAD,CAAhC;;AACA,IAAMmB,eAAe,GAAGnB,OAAO,CAAC,wBAAD,CAA/B;;AACA,IAAMoB,SAAS,GAAGpB,OAAO,CAAC,kBAAD,CAAzB;;AACA,IAAMqB,wBAAwB,GAAGrB,OAAO,CAAC,iCAAD,CAAxC;;AACA,IAAMsB,qBAAqB,GAAGtB,OAAO,CAAC,8BAAD,CAArC;;AACA,IAAMuB,SAAS,GAAGvB,OAAO,CAAC,oBAAD,CAAzB;;AACA,IAAMwB,YAAY,GAAGxB,OAAO,CAAC,+BAAD,CAA5B;;AACA,IAAMyB,2BAA2B,GAAGzB,OAAO,CAAC,8CAAD,CAA3C;;AACA,IAAM0B,OAAO,GAAG1B,OAAO,CAAC,wBAAD,CAAvB;;AACA,IAAM2B,4BAA4B,GAAG,CACjC,OADiC,EAEjC,cAFiC,EAGjC,KAHiC,EAIjC,WAJiC,EAKjC,aALiC,EAMjC,aANiC,EAOjC,UAPiC,EAQjC,UARiC,EASjC,MATiC,EAUjC,SAViC,EAWjC,WAXiC,CAArC;AAaA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,SAAS7B,mBAAT,CAA6B8B,OAA7B,EAAsCC,OAAtC,EAAgE;AAAA,MAAjBC,UAAiB,uEAAJ,EAAI;AAC5D;AACA,MAAQC,MAAR,GAAkCF,OAAlC,CAAQE,MAAR;AAAA,MAAgBC,aAAhB,GAAkCH,OAAlC,CAAgBG,aAAhB;AACAZ,EAAAA,SAAS,CAACa,8BAAV,CAAyCD,aAAzC,EAAwDD,MAAxD;AACA,MAAMG,aAAa,GAAGnC,WAAW,CAACoC,sBAAZ,CAAmCP,OAAO,CAACM,aAA3C,CAAtB;AACA,MAAME,IAAI,GAAG,IAAIjC,MAAM,CAACkC,cAAX,EAAb;;AAL4D,WAM7CC,KAN6C;AAAA;AAAA;;AAAA;AAAA,sEAM5D;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAGqCT,OAAO,CAACU,gBAAR,CAAyBL,aAAzB,CAHrC;;AAAA;AAGUM,cAAAA,iBAHV;AAAA;AAAA,qBAIyB1B,YAAY,CAAC2B,SAAb,CAAuB,CAACC,EAAE,GAAGd,OAAO,CAACe,IAAd,MAAwB,IAAxB,IAAgCD,EAAE,KAAK,KAAK,CAA5C,GAAgDA,EAAhD,GAAqD,IAA5E,EAAkFd,OAAO,CAACQ,IAAR,IAAgB,WAAlG,CAJzB;;AAAA;AAIIR,cAAAA,OAAO,CAACe,IAJZ;AAKI;AACMC,cAAAA,SANV,GAMsBlD,MAAM,CAACmD,IAAP,CAAYjB,OAAZ,EACbkB,MADa,CACN,UAAAC,GAAG;AAAA,uBAAInB,OAAO,CAACmB,GAAD,CAAP,KAAiBC,SAAjB,IAA8BrB,4BAA4B,CAACsB,QAA7B,CAAsCF,GAAtC,CAAlC;AAAA,eADG,EAEbG,MAFa,CAEN,UAACC,QAAD,EAAWJ,GAAX;AAAA,uDACLI,QADK,2BAEPJ,GAFO,EAEDnB,OAAO,CAACmB,GAAD,CAFN;AAAA,eAFM,EAKd,EALc,CANtB,EAYI;;AACMK,cAAAA,gBAbV,GAa6B1D,MAAM,CAACmD,IAAP,CAAYjB,OAAZ,EACpBkB,MADoB,CACb,UAAAC,GAAG;AAAA,uBAAI,CAACpB,4BAA4B,CAACsB,QAA7B,CAAsCF,GAAtC,CAAD,IAA+CA,GAAG,KAAK,eAA3D;AAAA,eADU,EAEpBG,MAFoB,CAEb,UAACC,QAAD,EAAWJ,GAAX;AAAA,uDACLI,QADK,2BAEPJ,GAFO,EAEDnB,OAAO,CAACmB,GAAD,CAFN;AAAA,eAFa,EAKrB,EALqB,CAb7B,EAmBI;;AACAH,cAAAA,SAAS,CAACS,OAAV,GAAoBL,SAApB;;AACA,kBAAIR,iBAAiB,CAACc,aAAlB,IAAmCd,iBAAiB,CAACc,aAAlB,KAAoC3C,QAAQ,CAAC4C,aAAT,CAAuBC,IAAlG,EAAwG;AACpG;AACA;AACAZ,gBAAAA,SAAS,CAACU,aAAV,GAA0B3C,QAAQ,CAAC4C,aAAT,CAAuBC,IAAjD;AACAzB,gBAAAA,MAAM,CAAC0B,IAAP;AACH;;AA1BL;AAAA,qBA2B8B5B,OAAO,CAAC6B,uBAAR,CAAgCxB,aAAhC,CA3B9B;;AAAA;AA2BUyB,cAAAA,WA3BV;AAAA;AAAA,qBA4BiC9B,OAAO,CAAC+B,eAAR,iCAA6BpB,iBAA7B,GAAmDI,SAAnD,GAAgEe,WAAhE,CA5BjC;;AAAA;AA4BUE,cAAAA,cA5BV;AAAA;AAAA,qBA6BgDxC,wBAAwB,CAACyC,2CAAzB,CAAqED,cAArE,EAAqFhC,OAArF,EAA8F,UAAAkC,GAAG;AAAA,uBAAI,CAC7IvC,YAAY,CAACwC,kBAAb,CAAgCD,GAAhC,CAD6I,EAE7IxC,SAAS,CAAC0C,eAAV,CAA0BF,GAA1B,CAF6I,EAG7IxC,SAAS,CAAC2C,gBAAV,CAA2BH,GAA3B,CAH6I,EAI7IxC,SAAS,CAAC4C,eAAV,CAA0BJ,GAA1B,CAJ6I,EAK7IxC,SAAS,CAAC6C,cAAV,CAAyBL,GAAzB,CAL6I,EAM7IrD,SAAS,CAAC2D,kBAAV,CAA6BN,GAA7B,EAAkClC,OAAlC,CAN6I,EAO7InB,SAAS,CAAC4D,iBAAV,CAA4BP,GAA5B,CAP6I,EAQ7IF,cAAc,CAACU,iBAAf,GAAmChD,SAAS,CAACiD,eAAV,CAA0BT,GAA1B,CAAnC,GAAoE,EARyE,CAAJ;AAAA,eAAjG,EASzC3B,IATyC,EASnCgB,gBATmC,CA7BhD;;AAAA;AAAA;AA6BYqB,cAAAA,MA7BZ,yBA6BYA,MA7BZ;AA6BoBC,cAAAA,WA7BpB,yBA6BoBA,WA7BpB;AA6BiCC,cAAAA,IA7BjC,yBA6BiCA,IA7BjC;;AAAA,kBAuCSF,MAAM,CAACG,SAvChB;AAAA;AAAA;AAAA;;AAAA,oBAwCc,IAAIC,KAAJ,CAAU,+CAAV,CAxCd;;AAAA;AAAA,oBA0CQjD,OAAO,CAACkD,UAAR,IAAsB,CAAClD,OAAO,CAACmD,GA1CvC;AAAA;AAAA;AAAA;;AA2CQ;AACA;AACA;AACAtE,cAAAA,gBAAgB,CAACuE,uBAAjB,CAAyCP,MAAzC,kCACOA,MAAM,CAACG,SADd;AAEIK,gBAAAA,MAAM,EAAE;AAFZ,kBA9CR,CAkDQ;AACA;AACA;;AApDR,oBAqDYR,MAAM,CAACS,KAAP,IAAgB,OAAOT,MAAM,CAACS,KAAd,KAAwB,QAAxC,IAAoD,CAACC,KAAK,CAACC,OAAN,CAAcX,MAAM,CAACS,KAArB,CAArD,IAAoFT,MAAM,CAACS,KAAP,CAAaG,IArD7G;AAAA;AAAA;AAAA;;AAAA,wCAsDuC3F,MAAM,CAAC4F,OAAP,CAAeb,MAAM,CAACS,KAAtB,CAtDvC;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA,2EAsDwBnC,GAtDxB,0BAsD6BlD,KAtD7B;;AAAA,oBAuDoBkD,GAAG,KAAK,MAAR,IAAkB,OAAOlD,KAAP,KAAiB,QAvDvD;AAAA;AAAA;AAAA;;AAAA;;AAAA;AA0DsB0F,cAAAA,wBA1DtB,GA0DiD1F,KAAK,CAAC2F,SAAN,CAAgB,UAAAC,CAAC;AAAA,uBAAIA,CAAC,CAACxC,QAAF,CAAW,oCAAX,CAAJ;AAAA,eAAjB,CA1DjD;;AA2DgB,kBAAIsC,wBAAwB,IAAI,CAAhC,EAAmC;AAC/B;AACA1F,gBAAAA,KAAK,CAAC6F,MAAN,CAAaH,wBAAb,EAAuC,CAAvC;AACH;;AA9DjB;AAAA;AAAA;AAAA;;AAAA;AAkEI,kBAAI3D,OAAO,CAACmD,GAAZ,EAAiB;AACbhD,gBAAAA,MAAM,CAAC0B,IAAP,CAAYvD,MAAM,CAACyF,IAAP,CAAYC,YAAxB;AAEH;;AACD,kBAAIhE,OAAO,CAACQ,IAAR,IACG,CAAC,uBAAuByD,IAAvB,CAA4BjE,OAAO,CAACQ,IAApC,CADJ,IAEGR,OAAO,CAACQ,IAAR,KAAiB,WAFxB,EAEqC;AACjCL,gBAAAA,MAAM,CAAC0B,IAAP,CAAYvD,MAAM,CAACyF,IAAP,CAAYG,WAAxB;AASH;;AACD,kBAAIlE,OAAO,CAACmE,gBAAZ,EAA8B;AAC1BhE,gBAAAA,MAAM,CAAC0B,IAAP,CAAYvD,MAAM,CAACyF,IAAP,CAAYK,OAAxB;AAKH;;AACGC,cAAAA,aA1FR,GA0FwBxB,MA1FxB;AA2FUyB,cAAAA,QA3FV,GA2FqB/E,eAAe,CAACgF,YAAhB,CAA6BtC,cAAc,CAACqC,QAA5C,EAAsDlE,aAAtD,CA3FrB;;AAAA,oBA4FQ2C,IAAI,CAACyB,YAAL,IAAqBF,QAAQ,CAACtE,OAAT,CAAiByE,SAAjB,KAA+B,KA5F5D;AAAA;AAAA;AAAA;;AAAA,oBA6FY1B,IAAI,CAAC2B,aAAL,CAAmBC,IAAnB,GAA0B,CA7FtC;AAAA;AAAA;AAAA;;AAAA,oBA8FkB,IAAI1B,KAAJ,CAAU,4EAAV,CA9FlB;;AAAA;AAAA;AAAA,qBAgGc2B,aAAa,CAAC7B,IAAD,EAAOd,cAAP,EAAuBoC,aAAvB,CAhG3B;;AAAA;AAAA,mBAkGQnE,UAAU,CAAC2E,oBAlGnB;AAAA;AAAA;AAAA;;AAAA;AAAA,qBAmG8B3E,UAAU,CAAC2E,oBAAX,CAAgCR,aAAhC,CAnG9B;;AAAA;AAmGQA,cAAAA,aAnGR;;AAAA;AAAA,+CAqGW;AACHpC,gBAAAA,cAAc,EAAdA,cADG;AAEHoC,gBAAAA,aAAa,EAAbA,aAFG;AAGHvB,gBAAAA,WAAW,EAAXA,WAHG;AAIHgC,gBAAAA,MAAM,EAAE7C,cAAc,CAAC8C,UAAf,KAA8BhC,IAAI,CAACyB,YAAL,GAAoB,mBAAIzB,IAAI,CAAC2B,aAAT,EAAwB,CAAxB,CAApB,GAAiDtD,SAA/E;AAJL,eArGX;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAN4D;AAAA;AAAA;;AAkH5D,SAAO3C,MAAM,CAACuG,IAAP,CAAYtE,KAAK,EAAjB,EAAqBuE,IAArB,CAA0BvG,WAAW,CAACwG,SAAZ,CAAsB,gBAA4D;AAAA,QAAzDjD,cAAyD,QAAzDA,cAAyD;AAAA,QAAzCoC,aAAyC,QAAzCA,aAAyC;AAAA,QAA1BvB,WAA0B,QAA1BA,WAA0B;AAAA,QAAbgC,MAAa,QAAbA,MAAa;AAC/G,QAAMK,sBAAsB,GAAGnG,OAAO,CAACoG,qBAAR,CAA8BnD,cAAc,CAACoD,YAA7C,CAA/B;;AACA,QAAIpD,cAAc,CAACqD,KAAnB,EAA0B;AACtB,kCAA0DrD,cAA1D,CAAQsD,OAAR;AAAA,UAAQA,OAAR,sCAAkB,EAAlB;AAAA,kCAA0DtD,cAA1D,CAAsBuD,MAAtB;AAAA,UAAsBA,MAAtB,sCAA+B,EAA/B;AAAA,UAAmCC,QAAnC,GAA0DxD,cAA1D,CAAmCwD,QAAnC;AAAA,UAA6CnB,QAA7C,GAA0DrC,cAA1D,CAA6CqC,QAA7C;;AACA,kCAAqC/E,eAAe,CAACgF,YAAhB,CAA6BD,QAA7B,EAAuClE,aAAvC,CAArC;AAAA,UAAiBsF,eAAjB,yBAAQ1F,OAAR;;AACA,UAAM2F,MAAM,GAAGD,eAAe,CAACC,MAAhB,IAA0BhH,EAAE,CAACiH,YAAH,CAAgBC,GAAzD;AACA,UAAMC,oBAAoB,GAAG,IAAI9G,OAAO,CAAC+G,oBAAZ,CAAiCjD,WAAjC,CAA7B;AACA,UAAMkD,WAAW,GAAG3G,oBAAoB,CAAC4G,mBAArB,CAAyC;AAAEV,QAAAA,OAAO,EAAPA,OAAF;AAAWC,QAAAA,MAAM,EAANA;AAAX,OAAzC,CAApB;AACA,UAAMU,iBAAiB,GAAGJ,oBAAoB,CAACK,2BAArB,CAAiDR,MAAjD,IACpBtG,oBAAoB,CAAC4G,mBAArB,CAAyC;AAAEV,QAAAA,OAAO,EAAE,EAAX;AAAeC,QAAAA,MAAM,EAANA;AAAf,OAAzC,CADoB,GAEpB,EAFN;AAGAnB,MAAAA,aAAa,CAAC+B,OAAd,sBAA6B/B,aAAa,CAAC+B,OAAd,IAAyB,EAAtD;AACA/B,MAAAA,aAAa,CAAC+B,OAAd,CAAsBC,IAAtB,CAA2B,IAAIxG,2BAA2B,CAACyG,sBAAhC,CAAuD;AAC9EC,QAAAA,KAAK,EAAE/H,IAAI,CAACgI,OAAL,CAAapG,aAAb,EAA4BX,wBAAwB,CAACgH,iBAAzB,CAA2CxE,cAAc,CAACqD,KAA1D,CAA5B,CADuE;AAE9EoB,QAAAA,MAAM,EAAEjH,wBAAwB,CAACkH,kBAAzB,CAA4C1E,cAAc,CAACqD,KAA3D,CAFsE;AAG9EG,QAAAA,QAAQ,EAARA,QAH8E;AAI9ES,QAAAA,iBAAiB,EAAjBA,iBAJ8E;AAK9EF,QAAAA,WAAW,EAAXA,WAL8E;AAM9EY,QAAAA,SAAS,EAAE3E,cAAc,CAAC2E,SANoD;AAO9EC,QAAAA,GAAG,EAAE5E,cAAc,CAAC6E,oBAP0D;AAQ9EC,QAAAA,mBAAmB,EAAE,CAAC,eAAD,CARyD;AAS9EC,QAAAA,cAAc,EAAE5H,YAAY,CAAC6H,iBAAb,CAA+B9B,sBAA/B,EAAuDW,oBAAvD,EAA6E5F,UAAU,CAACgH,SAAxF,CAT8D;AAU9EC,QAAAA,WAAW,EAAElF,cAAc,CAACkF,WAVkD;AAW9EC,QAAAA,IAAI,EAAEtC;AAXwE,OAAvD,CAA3B;AAaH;;AACD,QAAIK,sBAAsB,CAACI,OAAvB,IAAkCJ,sBAAsB,CAACK,MAA7D,EAAqE;AACjErF,MAAAA,MAAM,CAACkH,KAAP,CAAa/I,MAAM,CAACyF,IAAP,CAAYC,YAAzB;AAQH;;AACD,WAAO3F,eAAe,CAACiJ,mBAAhB,CAAoCjD,aAApC,EAAmDpE,OAAnD,EAA4D;AAC/DsH,MAAAA,OAAO,EAAErH,UAAU,CAACqH,OAAX,IAAsBzH,OAAO,CAAC0H,4BAAR,CAAqC,CAAC,CAACxH,OAAO,CAACyH,OAA/C,EAAwDtH,MAAxD,CADgC;AAE/DuH,MAAAA,cAAc,EAAEtJ,OAAO,CAAC,SAAD,CAFwC;AAG/DuJ,MAAAA,uBAAuB,EAAEvJ,OAAO,CAAC,oBAAD;AAH+B,KAA5D,EAIJ6G,IAJI,CAICvG,WAAW,CAACkJ,SAAZ,CAAsB,UAACC,UAAD,EAAavC,KAAb,EAAuB;AACjD,UAAIxE,EAAJ,CADiD,CAEjD;;;AACA,UAAMgH,aAAa,GAAGlJ,GAAG,CAACmJ,MAAJ,CAAW;AAC7BC,QAAAA,QAAQ,EAAEhI,OAAO,CAACiI,GAAR,GAAc,OAAd,GAAwB,MADL;AAE7BC,QAAAA,QAAQ,EAAElI,OAAO,CAACQ,IAAR,KAAiB,SAAjB,GAA6B,WAA7B,GAA2CR,OAAO,CAACQ,IAFhC;AAG7B2H,QAAAA,QAAQ,EAAE,CAACrH,EAAE,GAAGuD,aAAa,CAACrB,SAApB,MAAmC,IAAnC,IAA2ClC,EAAE,KAAK,KAAK,CAAvD,GAA2D,KAAK,CAAhE,GAAoEA,EAAE,CAACsH,UAHpD;AAI7BrH,QAAAA,IAAI,EAAE8G,UAAU,CAAC9G;AAJY,OAAX,CAAtB;;AAMA,UAAIuE,KAAK,KAAK,CAAd,EAAiB;AACbnF,QAAAA,MAAM,CAACkI,IAAP,CAAY,OAAO/J,MAAM,CAACyF,IAAP,CAAYK,OAAnB,6OAEoCpE,OAAO,CAACQ,IAF5C,EAEoDqH,UAAU,CAAC9G,IAF/D,EAGS+G,aAHT,IAKZ,IALA;;AAMA,YAAI9H,OAAO,CAACsI,IAAZ,EAAkB;AACd,cAAMA,IAAI,GAAGlK,OAAO,CAAC,MAAD,CAApB;;AACAkK,UAAAA,IAAI,CAACR,aAAD,CAAJ;AACH;AACJ;;AACD,UAAID,UAAU,CAACU,OAAf,EAAwB;AACpBpI,QAAAA,MAAM,CAACkI,IAAP,aAAiBlJ,OAAO,CAACqJ,MAAR,CAAeC,WAAf,CAA2BtJ,OAAO,CAACqJ,MAAR,CAAeE,OAAf,CAAuBC,KAAlD,CAAjB;AACH;;AACD,aAAOlK,MAAM,CAACmK,EAAP,iCAAef,UAAf;AAA2BgB,QAAAA,OAAO,EAAEf;AAApC,SAAP;AACH,KAzBO,CAJD,CAAP;AA8BH,GAlEgC,CAA1B,CAAP;AAmEH;;AACD9J,OAAO,CAACE,mBAAR,GAA8BA,mBAA9B;;SACe0G,a;;;;;4EAAf,kBAA6B7B,IAA7B,EAAmCd,cAAnC,EAAmDoC,aAAnD;AAAA;;AAAA;AAAA;AAAA;AAAA;AAEUS,YAAAA,MAFV,GAEmB,mBAAI/B,IAAI,CAAC2B,aAAT,EAAwB,CAAxB,CAFnB;AAGUoE,YAAAA,iBAHV,GAG8B/F,IAAI,CAACgG,OAAL,CAAajE,MAAb,CAH9B;AAAA;AAAA,mBAI2CxF,gBAAgB,CAAC0J,iBAAjB,CAAmClE,MAAnC,EAA2CgE,iBAAiB,KAAK,IAAtB,IAA8BA,iBAAiB,KAAK,KAAK,CAAzD,GAA6D,KAAK,CAAlE,GAAsEA,iBAAiB,CAACG,WAAnI,EAAgJhH,cAAc,CAACiH,sBAAf,IAAyC,QAAzL,CAJ3C;;AAAA;AAAA;AAIY9C,YAAAA,OAJZ,yBAIYA,OAJZ;AAIqB+C,YAAAA,WAJrB,yBAIqBA,WAJrB;;AAKI;AACA,gBAAI,CAACL,iBAAiB,KAAK,IAAtB,IAA8BA,iBAAiB,KAAK,KAAK,CAAzD,GAA6D,KAAK,CAAlE,GAAsEA,iBAAiB,CAACM,QAAzF,KACA,OAAO/E,aAAa,CAACf,KAArB,KAA+B,QAD/B,IAEA,CAACC,KAAK,CAACC,OAAN,CAAca,aAAa,CAACf,KAA5B,CAFD,IAGAe,aAAa,CAACf,KAAd,CAAoB,MAApB,CAHJ,EAGiC;AAC7B,kBAAIC,KAAK,CAACC,OAAN,CAAca,aAAa,CAACf,KAAd,CAAoB,MAApB,CAAd,CAAJ,EAAgD;AAC5Ce,gBAAAA,aAAa,CAACf,KAAd,CAAoB,MAApB,EAA4B+F,OAA5B,CAAoCP,iBAAiB,CAACM,QAAtD;AACH,eAFD,MAGK;AACD/E,gBAAAA,aAAa,CAACf,KAAd,CAAoB,MAApB,IAA8B,CAACwF,iBAAiB,CAACM,QAAnB,EAA6B/E,aAAa,CAACf,KAAd,CAAoB,MAApB,CAA7B,CAA9B;AACH;AACJ;;AACKgG,YAAAA,QAjBV,GAiBqB;AACbrF,cAAAA,IAAI,EAAE,gBADO;AAEbsF,cAAAA,OAAO,EAAE,MAFI;AAGbC,cAAAA,GAAG,EAAE,CACD;AACIC,gBAAAA,MAAM,EAAErL,OAAO,CAACoI,OAAR,CAAgB,cAAhB,CADZ;AAEIxG,gBAAAA,OAAO,EAAE;AACL0J,kBAAAA,OAAO,EAAE,KADJ;AAELC,kBAAAA,UAAU,EAAE,KAFP;AAGLC,kBAAAA,OAAO,EAAE,KAHJ;AAILC,kBAAAA,gBAAgB,EAAE,KAJb;AAKLC,kBAAAA,cAAc,EAAE7K,YAAY,CAAC8K,aAAb,CAA2B,cAA3B,CALX;AAMLC,kBAAAA,eAAe,EAAEC,IAAI,CAACC,SAAL,CAAe;AAC5BC,oBAAAA,YAAY,EAAE/L,OAAO,CAAC,oBAAD,CAAP,CAA8BgM,OADhB;AAE5BtF,oBAAAA,MAAM,EAANA,MAF4B;AAG5BuF,oBAAAA,oBAAoB,EAAEvB,iBAAiB,KAAK,IAAtB,IAA8BA,iBAAiB,KAAK,KAAK,CAAzD,GAA6D,KAAK,CAAlE,GAAsEA,iBAAiB,CAACwB,KAAlB,CAAwBC,GAAxB,CAA4B,UAACC,IAAD;AAAA,6BAAUA,IAAI,CAACC,SAAf;AAAA,qBAA5B;AAHhE,mBAAf,CANZ;AAWLrE,kBAAAA,OAAO,EAAPA;AAXK;AAFb,eADC;AAHQ,aAjBrB,EAuCI;;AACMsE,YAAAA,KAxCV,GAwCkB,CAAC,CAAC5J,EAAE,GAAGuD,aAAa,CAACsG,MAApB,MAAgC,IAAhC,IAAwC7J,EAAE,KAAK,KAAK,CAApD,GAAwD,KAAK,CAA7D,GAAiEA,EAAE,CAAC4J,KAArE,KAA+E,EAxCjG;;AAyCI,gBAAI,CAACrG,aAAa,CAACsG,MAAnB,EAA2B;AACvBtG,cAAAA,aAAa,CAACsG,MAAd,GAAuB;AAAED,gBAAAA,KAAK,EAALA;AAAF,eAAvB;AACH,aAFD,MAGK,IAAI,CAACrG,aAAa,CAACsG,MAAd,CAAqBD,KAA1B,EAAiC;AAClCrG,cAAAA,aAAa,CAACsG,MAAd,CAAqBD,KAArB,GAA6BA,KAA7B;AACH;;AACDA,YAAAA,KAAK,CAACrE,IAAN,CAAWiD,QAAX,EA/CJ,CAgDI;AACA;;AACAjF,YAAAA,aAAa,CAAC+B,OAAd,CAAsBC,IAAtB,CAA2B;AACvBuE,cAAAA,KAAK,EAAE,eAACC,QAAD,EAAc;AACjBA,gBAAAA,QAAQ,CAACC,KAAT,CAAeC,eAAf,CAA+BC,GAA/B,CAAmC,eAAnC,EAAoD,UAAAC,WAAW,EAAI;AAC/DA,kBAAAA,WAAW,CAACH,KAAZ,CAAkBI,aAAlB,CAAgCF,GAAhC,CAAoC,eAApC,EAAqD,YAAM;AACvD,wBAAI,CAAC7B,WAAL,EAAkB;AACd;AACH;;AAHsD,+DAI9BA,WAAW,CAACgC,QAJkB;AAAA;;AAAA;AAIvD,0EAA+C;AAAA,4BAApCC,UAAoC;;AAC3C,4BAAIA,UAAU,CAACC,IAAX,KAAoB,OAAxB,EAAiC;AAC7B3L,0BAAAA,qBAAqB,CAAC4L,QAAtB,CAA+BL,WAA/B,EAA4CG,UAAU,CAACG,OAAvD;AACH,yBAFD,MAGK;AACD7L,0BAAAA,qBAAqB,CAAC8L,UAAtB,CAAiCP,WAAjC,EAA8CG,UAAU,CAACG,OAAzD;AACH;AACJ;AAXsD;AAAA;AAAA;AAAA;AAAA;;AAYvDpC,oBAAAA,WAAW,CAACgC,QAAZ,CAAqBM,MAArB,GAA8B,CAA9B;AACH,mBAbD;AAcH,iBAfD;AAgBH;AAlBsB,aAA3B;;AAlDJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;AAuEAzN,OAAO,CAAC0N,OAAR,GAAkBvN,WAAW,CAACwN,aAAZ,CAA0BzN,mBAA1B,CAAlB","sourcesContent":["\"use strict\";\n/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.serveWebpackBrowser = void 0;\nconst architect_1 = require(\"@angular-devkit/architect\");\nconst build_webpack_1 = require(\"@angular-devkit/build-webpack\");\nconst core_1 = require(\"@angular-devkit/core\");\nconst node_1 = require(\"@angular-devkit/core/node\");\nconst path = require(\"path\");\nconst rxjs_1 = require(\"rxjs\");\nconst operators_1 = require(\"rxjs/operators\");\nconst ts = require(\"typescript\");\nconst url = require(\"url\");\nconst webpackDevServer = require(\"webpack-dev-server\");\nconst browser_1 = require(\"../browser\");\nconst schema_1 = require(\"../browser/schema\");\nconst utils_1 = require(\"../utils\");\nconst cache_path_1 = require(\"../utils/cache-path\");\nconst check_port_1 = require(\"../utils/check-port\");\nconst color_1 = require(\"../utils/color\");\nconst transforms_1 = require(\"../utils/index-file/transforms\");\nconst package_chunk_sort_1 = require(\"../utils/package-chunk-sort\");\nconst process_bundle_1 = require(\"../utils/process-bundle\");\nconst read_tsconfig_1 = require(\"../utils/read-tsconfig\");\nconst version_1 = require(\"../utils/version\");\nconst webpack_browser_config_1 = require(\"../utils/webpack-browser-config\");\nconst webpack_diagnostics_1 = require(\"../utils/webpack-diagnostics\");\nconst configs_1 = require(\"../webpack/configs\");\nconst dev_server_1 = require(\"../webpack/configs/dev-server\");\nconst index_html_webpack_plugin_1 = require(\"../webpack/plugins/index-html-webpack-plugin\");\nconst stats_1 = require(\"../webpack/utils/stats\");\nconst devServerBuildOverriddenKeys = [\n    'watch',\n    'optimization',\n    'aot',\n    'sourceMap',\n    'vendorChunk',\n    'commonChunk',\n    'baseHref',\n    'progress',\n    'poll',\n    'verbose',\n    'deployUrl',\n];\n/**\n * Reusable implementation of the build angular webpack dev server builder.\n * @param options Dev Server options.\n * @param context The build context.\n * @param transforms A map of transforms that can be used to hook into some logic (such as\n *     transforming webpack configuration before passing it to webpack).\n */\n// tslint:disable-next-line: no-big-function\nfunction serveWebpackBrowser(options, context, transforms = {}) {\n    // Check Angular version.\n    const { logger, workspaceRoot } = context;\n    version_1.assertCompatibleAngularVersion(workspaceRoot, logger);\n    const browserTarget = architect_1.targetFromTargetString(options.browserTarget);\n    const host = new node_1.NodeJsSyncHost();\n    async function setup() {\n        var _a;\n        // Get the browser configuration from the target name.\n        const rawBrowserOptions = (await context.getTargetOptions(browserTarget));\n        options.port = await check_port_1.checkPort((_a = options.port) !== null && _a !== void 0 ? _a : 4200, options.host || 'localhost');\n        // Override options we need to override, if defined.\n        const overrides = Object.keys(options)\n            .filter(key => options[key] !== undefined && devServerBuildOverriddenKeys.includes(key))\n            .reduce((previous, key) => ({\n            ...previous,\n            [key]: options[key],\n        }), {});\n        // Get dev-server only options.\n        const devServerOptions = Object.keys(options)\n            .filter(key => !devServerBuildOverriddenKeys.includes(key) && key !== 'browserTarget')\n            .reduce((previous, key) => ({\n            ...previous,\n            [key]: options[key],\n        }), {});\n        // In dev server we should not have budgets because of extra libs such as socks-js\n        overrides.budgets = undefined;\n        if (rawBrowserOptions.outputHashing && rawBrowserOptions.outputHashing !== schema_1.OutputHashing.None) {\n            // Disable output hashing for dev build as this can cause memory leaks\n            // See: https://github.com/webpack/webpack-dev-server/issues/377#issuecomment-241258405\n            overrides.outputHashing = schema_1.OutputHashing.None;\n            logger.warn(`Warning: 'outputHashing' option is disabled when using the dev-server.`);\n        }\n        const browserName = await context.getBuilderNameForTarget(browserTarget);\n        const browserOptions = await context.validateOptions({ ...rawBrowserOptions, ...overrides }, browserName);\n        const { config, projectRoot, i18n } = await webpack_browser_config_1.generateI18nBrowserWebpackConfigFromContext(browserOptions, context, wco => [\n            dev_server_1.getDevServerConfig(wco),\n            configs_1.getCommonConfig(wco),\n            configs_1.getBrowserConfig(wco),\n            configs_1.getStylesConfig(wco),\n            configs_1.getStatsConfig(wco),\n            browser_1.getAnalyticsConfig(wco, context),\n            browser_1.getCompilerConfig(wco),\n            browserOptions.webWorkerTsConfig ? configs_1.getWorkerConfig(wco) : {},\n        ], host, devServerOptions);\n        if (!config.devServer) {\n            throw new Error('Webpack Dev Server configuration was not set.');\n        }\n        if (options.liveReload && !options.hmr) {\n            // This is needed because we cannot use the inline option directly in the config\n            // because of the SuppressExtractedTextChunksWebpackPlugin\n            // Consider not using SuppressExtractedTextChunksWebpackPlugin when liveReload is enable.\n            webpackDevServer.addDevServerEntrypoints(config, {\n                ...config.devServer,\n                inline: true,\n            });\n            // Remove live-reload code from all entrypoints but not main.\n            // Otherwise this will break SuppressExtractedTextChunksWebpackPlugin because\n            // 'addDevServerEntrypoints' adds addional entry-points to all entries.\n            if (config.entry && typeof config.entry === 'object' && !Array.isArray(config.entry) && config.entry.main) {\n                for (const [key, value] of Object.entries(config.entry)) {\n                    if (key === 'main' || typeof value === 'string') {\n                        continue;\n                    }\n                    const webpackClientScriptIndex = value.findIndex(x => x.includes('webpack-dev-server/client/index.js'));\n                    if (webpackClientScriptIndex >= 0) {\n                        // Remove the webpack-dev-server/client script from array.\n                        value.splice(webpackClientScriptIndex, 1);\n                    }\n                }\n            }\n        }\n        if (options.hmr) {\n            logger.warn(core_1.tags.stripIndents `NOTICE: Hot Module Replacement (HMR) is enabled for the dev server.\n      See https://webpack.js.org/guides/hot-module-replacement for information on working with HMR for Webpack.`);\n        }\n        if (options.host\n            && !/^127\\.\\d+\\.\\d+\\.\\d+/g.test(options.host)\n            && options.host !== 'localhost') {\n            logger.warn(core_1.tags.stripIndent `\n        Warning: This is a simple server for use in testing or debugging Angular applications\n        locally. It hasn't been reviewed for security issues.\n\n        Binding this server to an open connection can result in compromising your application or\n        computer. Using a different host than the one passed to the \"--host\" flag might result in\n        websocket connection issues. You might need to use \"--disableHostCheck\" if that's the\n        case.\n      `);\n        }\n        if (options.disableHostCheck) {\n            logger.warn(core_1.tags.oneLine `\n        Warning: Running a server with --disable-host-check is a security risk.\n        See https://medium.com/webpack/webpack-dev-server-middleware-security-issues-1489d950874a\n        for more information.\n      `);\n        }\n        let webpackConfig = config;\n        const tsConfig = read_tsconfig_1.readTsconfig(browserOptions.tsConfig, workspaceRoot);\n        if (i18n.shouldInline && tsConfig.options.enableIvy !== false) {\n            if (i18n.inlineLocales.size > 1) {\n                throw new Error('The development server only supports localizing a single locale per build.');\n            }\n            await setupLocalize(i18n, browserOptions, webpackConfig);\n        }\n        if (transforms.webpackConfiguration) {\n            webpackConfig = await transforms.webpackConfiguration(webpackConfig);\n        }\n        return {\n            browserOptions,\n            webpackConfig,\n            projectRoot,\n            locale: browserOptions.i18nLocale || (i18n.shouldInline ? [...i18n.inlineLocales][0] : undefined),\n        };\n    }\n    return rxjs_1.from(setup()).pipe(operators_1.switchMap(({ browserOptions, webpackConfig, projectRoot, locale }) => {\n        const normalizedOptimization = utils_1.normalizeOptimization(browserOptions.optimization);\n        if (browserOptions.index) {\n            const { scripts = [], styles = [], baseHref, tsConfig } = browserOptions;\n            const { options: compilerOptions } = read_tsconfig_1.readTsconfig(tsConfig, workspaceRoot);\n            const target = compilerOptions.target || ts.ScriptTarget.ES5;\n            const buildBrowserFeatures = new utils_1.BuildBrowserFeatures(projectRoot);\n            const entrypoints = package_chunk_sort_1.generateEntryPoints({ scripts, styles });\n            const moduleEntrypoints = buildBrowserFeatures.isDifferentialLoadingNeeded(target)\n                ? package_chunk_sort_1.generateEntryPoints({ scripts: [], styles })\n                : [];\n            webpackConfig.plugins = [...(webpackConfig.plugins || [])];\n            webpackConfig.plugins.push(new index_html_webpack_plugin_1.IndexHtmlWebpackPlugin({\n                input: path.resolve(workspaceRoot, webpack_browser_config_1.getIndexInputFile(browserOptions.index)),\n                output: webpack_browser_config_1.getIndexOutputFile(browserOptions.index),\n                baseHref,\n                moduleEntrypoints,\n                entrypoints,\n                deployUrl: browserOptions.deployUrl,\n                sri: browserOptions.subresourceIntegrity,\n                noModuleEntrypoints: ['polyfills-es5'],\n                postTransforms: transforms_1.getHtmlTransforms(normalizedOptimization, buildBrowserFeatures, transforms.indexHtml),\n                crossOrigin: browserOptions.crossOrigin,\n                lang: locale,\n            }));\n        }\n        if (normalizedOptimization.scripts || normalizedOptimization.styles) {\n            logger.error(core_1.tags.stripIndents `\n          ****************************************************************************************\n          This is a simple server for use in testing or debugging Angular applications locally.\n          It hasn't been reviewed for security issues.\n\n          DON'T USE IT FOR PRODUCTION!\n          ****************************************************************************************\n        `);\n        }\n        return build_webpack_1.runWebpackDevServer(webpackConfig, context, {\n            logging: transforms.logging || stats_1.createWebpackLoggingCallback(!!options.verbose, logger),\n            webpackFactory: require('webpack'),\n            webpackDevServerFactory: require('webpack-dev-server'),\n        }).pipe(operators_1.concatMap((buildEvent, index) => {\n            var _a;\n            // Resolve serve address.\n            const serverAddress = url.format({\n                protocol: options.ssl ? 'https' : 'http',\n                hostname: options.host === '0.0.0.0' ? 'localhost' : options.host,\n                pathname: (_a = webpackConfig.devServer) === null || _a === void 0 ? void 0 : _a.publicPath,\n                port: buildEvent.port,\n            });\n            if (index === 0) {\n                logger.info('\\n' + core_1.tags.oneLine `\n              **\n              Angular Live Development Server is listening on ${options.host}:${buildEvent.port},\n              open your browser on ${serverAddress}\n              **\n            ` + '\\n');\n                if (options.open) {\n                    const open = require('open');\n                    open(serverAddress);\n                }\n            }\n            if (buildEvent.success) {\n                logger.info(`\\n${color_1.colors.greenBright(color_1.colors.symbols.check)} Compiled successfully.`);\n            }\n            return rxjs_1.of({ ...buildEvent, baseUrl: serverAddress });\n        }));\n    }));\n}\nexports.serveWebpackBrowser = serveWebpackBrowser;\nasync function setupLocalize(i18n, browserOptions, webpackConfig) {\n    var _a;\n    const locale = [...i18n.inlineLocales][0];\n    const localeDescription = i18n.locales[locale];\n    const { plugins, diagnostics } = await process_bundle_1.createI18nPlugins(locale, localeDescription === null || localeDescription === void 0 ? void 0 : localeDescription.translation, browserOptions.i18nMissingTranslation || 'ignore');\n    // Modify main entrypoint to include locale data\n    if ((localeDescription === null || localeDescription === void 0 ? void 0 : localeDescription.dataPath) &&\n        typeof webpackConfig.entry === 'object' &&\n        !Array.isArray(webpackConfig.entry) &&\n        webpackConfig.entry['main']) {\n        if (Array.isArray(webpackConfig.entry['main'])) {\n            webpackConfig.entry['main'].unshift(localeDescription.dataPath);\n        }\n        else {\n            webpackConfig.entry['main'] = [localeDescription.dataPath, webpackConfig.entry['main']];\n        }\n    }\n    const i18nRule = {\n        test: /\\.(?:m?js|ts)$/,\n        enforce: 'post',\n        use: [\n            {\n                loader: require.resolve('babel-loader'),\n                options: {\n                    babelrc: false,\n                    configFile: false,\n                    compact: false,\n                    cacheCompression: false,\n                    cacheDirectory: cache_path_1.findCachePath('babel-loader'),\n                    cacheIdentifier: JSON.stringify({\n                        buildAngular: require('../../package.json').version,\n                        locale,\n                        translationIntegrity: localeDescription === null || localeDescription === void 0 ? void 0 : localeDescription.files.map((file) => file.integrity),\n                    }),\n                    plugins,\n                },\n            },\n        ],\n    };\n    // Get the rules and ensure the Webpack configuration is setup properly\n    const rules = ((_a = webpackConfig.module) === null || _a === void 0 ? void 0 : _a.rules) || [];\n    if (!webpackConfig.module) {\n        webpackConfig.module = { rules };\n    }\n    else if (!webpackConfig.module.rules) {\n        webpackConfig.module.rules = rules;\n    }\n    rules.push(i18nRule);\n    // Add a plugin to inject the i18n diagnostics\n    // tslint:disable-next-line: no-non-null-assertion\n    webpackConfig.plugins.push({\n        apply: (compiler) => {\n            compiler.hooks.thisCompilation.tap('build-angular', compilation => {\n                compilation.hooks.finishModules.tap('build-angular', () => {\n                    if (!diagnostics) {\n                        return;\n                    }\n                    for (const diagnostic of diagnostics.messages) {\n                        if (diagnostic.type === 'error') {\n                            webpack_diagnostics_1.addError(compilation, diagnostic.message);\n                        }\n                        else {\n                            webpack_diagnostics_1.addWarning(compilation, diagnostic.message);\n                        }\n                    }\n                    diagnostics.messages.length = 0;\n                });\n            });\n        },\n    });\n}\nexports.default = architect_1.createBuilder(serveWebpackBrowser);\n"]},"metadata":{},"sourceType":"script"}