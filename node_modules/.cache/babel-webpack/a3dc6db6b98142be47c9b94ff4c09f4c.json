{"ast":null,"code":"'use strict';\n\nvar _inherits = require(\"/Users/abdillahihussein/Documents/GitHub/angularProject/node_modules/@babel/runtime/helpers/inherits\");\n\nvar _createSuper = require(\"/Users/abdillahihussein/Documents/GitHub/angularProject/node_modules/@babel/runtime/helpers/createSuper\");\n\nvar _classCallCheck = require(\"/Users/abdillahihussein/Documents/GitHub/angularProject/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/Users/abdillahihussein/Documents/GitHub/angularProject/node_modules/@babel/runtime/helpers/createClass\");\n\nvar path = require('path');\n\nvar assert = require('assert');\n\nvar logger = require('./logger');\n\nvar log = logger.create('config');\n\nvar helper = require('./helper');\n\nvar constant = require('./constants');\n\nvar _ = require('lodash');\n\nvar COFFEE_SCRIPT_AVAILABLE = false;\nvar LIVE_SCRIPT_AVAILABLE = false;\nvar TYPE_SCRIPT_AVAILABLE = false;\n\ntry {\n  require('coffeescript').register();\n\n  COFFEE_SCRIPT_AVAILABLE = true;\n} catch (e) {} // LiveScript is required here to enable config files written in LiveScript.\n// It's not directly used in this file.\n\n\ntry {\n  require('LiveScript');\n\n  LIVE_SCRIPT_AVAILABLE = true;\n} catch (e) {}\n\ntry {\n  require('ts-node').register();\n\n  TYPE_SCRIPT_AVAILABLE = true;\n} catch (e) {}\n\nvar Pattern = /*#__PURE__*/function () {\n  function Pattern(pattern, served, included, watched, nocache, type, isBinary) {\n    _classCallCheck(this, Pattern);\n\n    this.pattern = pattern;\n    this.served = helper.isDefined(served) ? served : true;\n    this.included = helper.isDefined(included) ? included : true;\n    this.watched = helper.isDefined(watched) ? watched : true;\n    this.nocache = helper.isDefined(nocache) ? nocache : false;\n    this.weight = helper.mmPatternWeight(pattern);\n    this.type = type;\n    this.isBinary = isBinary;\n  }\n\n  _createClass(Pattern, [{\n    key: \"compare\",\n    value: function compare(other) {\n      return helper.mmComparePatternWeights(this.weight, other.weight);\n    }\n  }]);\n\n  return Pattern;\n}();\n\nvar UrlPattern = /*#__PURE__*/function (_Pattern) {\n  _inherits(UrlPattern, _Pattern);\n\n  var _super = _createSuper(UrlPattern);\n\n  function UrlPattern(url, type) {\n    _classCallCheck(this, UrlPattern);\n\n    return _super.call(this, url, false, true, false, false, type);\n  }\n\n  return UrlPattern;\n}(Pattern);\n\nfunction createPatternObject(pattern) {\n  if (pattern && helper.isString(pattern)) {\n    return helper.isUrlAbsolute(pattern) ? new UrlPattern(pattern) : new Pattern(pattern);\n  } else if (helper.isObject(pattern) && pattern.pattern && helper.isString(pattern.pattern)) {\n    return helper.isUrlAbsolute(pattern.pattern) ? new UrlPattern(pattern.pattern, pattern.type) : new Pattern(pattern.pattern, pattern.served, pattern.included, pattern.watched, pattern.nocache, pattern.type);\n  } else {\n    log.warn(\"Invalid pattern \".concat(pattern, \"!\\n\\tExpected string or object with \\\"pattern\\\" property.\"));\n    return new Pattern(null, false, false, false, false);\n  }\n}\n\nfunction normalizeUrl(url) {\n  if (!url.startsWith('/')) {\n    url = \"/\".concat(url);\n  }\n\n  if (!url.endsWith('/')) {\n    url = url + '/';\n  }\n\n  return url;\n}\n\nfunction normalizeUrlRoot(urlRoot) {\n  var normalizedUrlRoot = normalizeUrl(urlRoot);\n\n  if (normalizedUrlRoot !== urlRoot) {\n    log.warn(\"urlRoot normalized to \\\"\".concat(normalizedUrlRoot, \"\\\"\"));\n  }\n\n  return normalizedUrlRoot;\n}\n\nfunction normalizeProxyPath(proxyPath) {\n  var normalizedProxyPath = normalizeUrl(proxyPath);\n\n  if (normalizedProxyPath !== proxyPath) {\n    log.warn(\"proxyPath normalized to \\\"\".concat(normalizedProxyPath, \"\\\"\"));\n  }\n\n  return normalizedProxyPath;\n}\n\nfunction normalizeConfig(config, configFilePath) {\n  function basePathResolve(relativePath) {\n    if (helper.isUrlAbsolute(relativePath)) {\n      return relativePath;\n    } else if (helper.isDefined(config.basePath) && helper.isDefined(relativePath)) {\n      return path.resolve(config.basePath, relativePath);\n    } else {\n      return '';\n    }\n  }\n\n  function createPatternMapper(resolve) {\n    return function (objectPattern) {\n      return Object.assign(objectPattern, {\n        pattern: resolve(objectPattern.pattern)\n      });\n    };\n  }\n\n  if (helper.isString(configFilePath)) {\n    config.basePath = path.resolve(path.dirname(configFilePath), config.basePath); // resolve basePath\n\n    config.exclude.push(configFilePath); // always ignore the config file itself\n  } else {\n    config.basePath = path.resolve(config.basePath || '.');\n  }\n\n  config.files = config.files.map(createPatternObject).map(createPatternMapper(basePathResolve));\n  config.exclude = config.exclude.map(basePathResolve);\n  config.customContextFile = config.customContextFile && basePathResolve(config.customContextFile);\n  config.customDebugFile = config.customDebugFile && basePathResolve(config.customDebugFile);\n  config.customClientContextFile = config.customClientContextFile && basePathResolve(config.customClientContextFile); // normalize paths on windows\n\n  config.basePath = helper.normalizeWinPath(config.basePath);\n  config.files = config.files.map(createPatternMapper(helper.normalizeWinPath));\n  config.exclude = config.exclude.map(helper.normalizeWinPath);\n  config.customContextFile = helper.normalizeWinPath(config.customContextFile);\n  config.customDebugFile = helper.normalizeWinPath(config.customDebugFile);\n  config.customClientContextFile = helper.normalizeWinPath(config.customClientContextFile); // normalize urlRoot\n\n  config.urlRoot = normalizeUrlRoot(config.urlRoot); // normalize and default upstream proxy settings if given\n\n  if (config.upstreamProxy) {\n    var proxy = config.upstreamProxy;\n    proxy.path = helper.isDefined(proxy.path) ? normalizeProxyPath(proxy.path) : '/';\n    proxy.hostname = helper.isDefined(proxy.hostname) ? proxy.hostname : 'localhost';\n    proxy.port = helper.isDefined(proxy.port) ? proxy.port : 9875; // force protocol to end with ':'\n\n    proxy.protocol = (proxy.protocol || 'http').split(':')[0] + ':';\n\n    if (proxy.protocol.match(/https?:/) === null) {\n      log.warn(\"\\\"\".concat(proxy.protocol, \"\\\" is not a supported upstream proxy protocol, defaulting to \\\"http:\\\"\"));\n      proxy.protocol = 'http:';\n    }\n  } // force protocol to end with ':'\n\n\n  config.protocol = (config.protocol || 'http').split(':')[0] + ':';\n\n  if (config.protocol.match(/https?:/) === null) {\n    log.warn(\"\\\"\".concat(config.protocol, \"\\\" is not a supported protocol, defaulting to \\\"http:\\\"\"));\n    config.protocol = 'http:';\n  }\n\n  if (config.proxies && Object.prototype.hasOwnProperty.call(config.proxies, config.urlRoot)) {\n    log.warn(\"\\\"\".concat(config.urlRoot, \"\\\" is proxied, you should probably change urlRoot to avoid conflicts\"));\n  }\n\n  if (config.singleRun && config.autoWatch) {\n    log.debug('autoWatch set to false, because of singleRun');\n    config.autoWatch = false;\n  }\n\n  if (config.runInParent) {\n    log.debug('useIframe set to false, because using runInParent');\n    config.useIframe = false;\n  }\n\n  if (!config.singleRun && !config.useIframe && config.runInParent) {\n    log.debug('singleRun set to true, because using runInParent');\n    config.singleRun = true;\n  }\n\n  if (helper.isString(config.reporters)) {\n    config.reporters = config.reporters.split(',');\n  }\n\n  if (config.client && config.client.args) {\n    assert(Array.isArray(config.client.args), 'Invalid configuration: client.args must be an array of strings');\n  }\n\n  if (config.browsers) {\n    assert(Array.isArray(config.browsers), 'Invalid configuration: browsers option must be an array');\n  }\n\n  if (config.formatError) {\n    assert(helper.isFunction(config.formatError), 'Invalid configuration: formatError option must be a function.');\n  }\n\n  if (config.processKillTimeout) {\n    assert(helper.isNumber(config.processKillTimeout), 'Invalid configuration: processKillTimeout option must be a number.');\n  }\n\n  if (config.browserSocketTimeout) {\n    assert(helper.isNumber(config.browserSocketTimeout), 'Invalid configuration: browserSocketTimeout option must be a number.');\n  }\n\n  if (config.pingTimeout) {\n    assert(helper.isNumber(config.pingTimeout), 'Invalid configuration: pingTimeout option must be a number.');\n  }\n\n  var defaultClient = config.defaultClient || {};\n  Object.keys(defaultClient).forEach(function (key) {\n    var option = config.client[key];\n    config.client[key] = helper.isDefined(option) ? option : defaultClient[key];\n  }); // normalize preprocessors\n\n  var preprocessors = config.preprocessors || {};\n  var normalizedPreprocessors = config.preprocessors = Object.create(null);\n  Object.keys(preprocessors).forEach(function (pattern) {\n    var normalizedPattern = helper.normalizeWinPath(basePathResolve(pattern));\n    normalizedPreprocessors[normalizedPattern] = helper.isString(preprocessors[pattern]) ? [preprocessors[pattern]] : preprocessors[pattern];\n  }); // define custom launchers/preprocessors/reporters - create an inlined plugin\n\n  var module = Object.create(null);\n  var hasSomeInlinedPlugin = false;\n  var types = ['launcher', 'preprocessor', 'reporter'];\n  types.forEach(function (type) {\n    var definitions = config[\"custom\".concat(helper.ucFirst(type), \"s\")] || {};\n    Object.keys(definitions).forEach(function (name) {\n      var definition = definitions[name];\n\n      if (!helper.isObject(definition)) {\n        return log.warn(\"Can not define \".concat(type, \" \").concat(name, \". Definition has to be an object.\"));\n      }\n\n      if (!helper.isString(definition.base)) {\n        return log.warn(\"Can not define \".concat(type, \" \").concat(name, \". Missing base \").concat(type, \".\"));\n      }\n\n      var token = type + ':' + definition.base;\n      var locals = {\n        args: ['value', definition]\n      };\n      module[type + ':' + name] = ['factory', function (injector) {\n        var plugin = injector.createChild([locals], [token]).get(token);\n\n        if (type === 'launcher' && helper.isDefined(definition.displayName)) {\n          plugin.displayName = definition.displayName;\n        }\n\n        return plugin;\n      }];\n      hasSomeInlinedPlugin = true;\n    });\n  });\n\n  if (hasSomeInlinedPlugin) {\n    config.plugins.push(module);\n  }\n\n  return config;\n}\n\nvar Config = /*#__PURE__*/function () {\n  function Config() {\n    _classCallCheck(this, Config);\n\n    this.LOG_DISABLE = constant.LOG_DISABLE;\n    this.LOG_ERROR = constant.LOG_ERROR;\n    this.LOG_WARN = constant.LOG_WARN;\n    this.LOG_INFO = constant.LOG_INFO;\n    this.LOG_DEBUG = constant.LOG_DEBUG; // DEFAULT CONFIG\n\n    this.frameworks = [];\n    this.protocol = 'http:';\n    this.port = constant.DEFAULT_PORT;\n    this.listenAddress = constant.DEFAULT_LISTEN_ADDR;\n    this.hostname = constant.DEFAULT_HOSTNAME;\n    this.httpsServerConfig = {};\n    this.basePath = '';\n    this.files = [];\n    this.browserConsoleLogOptions = {\n      level: 'debug',\n      format: '%b %T: %m',\n      terminal: true\n    };\n    this.customContextFile = null;\n    this.customDebugFile = null;\n    this.customClientContextFile = null;\n    this.exclude = [];\n    this.logLevel = constant.LOG_INFO;\n    this.colors = true;\n    this.autoWatch = true;\n    this.autoWatchBatchDelay = 250;\n    this.restartOnFileChange = false;\n    this.usePolling = process.platform === 'linux';\n    this.reporters = ['progress'];\n    this.singleRun = false;\n    this.browsers = [];\n    this.captureTimeout = 60000;\n    this.pingTimeout = 5000;\n    this.proxies = {};\n    this.proxyValidateSSL = true;\n    this.preprocessors = {};\n    this.preprocessor_priority = {};\n    this.urlRoot = '/';\n    this.upstreamProxy = undefined;\n    this.reportSlowerThan = 0;\n    this.loggers = [constant.CONSOLE_APPENDER];\n    this.transports = ['polling', 'websocket'];\n    this.forceJSONP = false;\n    this.plugins = ['karma-*'];\n    this.defaultClient = this.client = {\n      args: [],\n      useIframe: true,\n      runInParent: false,\n      captureConsole: true,\n      clearContext: true\n    };\n    this.browserDisconnectTimeout = 2000;\n    this.browserDisconnectTolerance = 0;\n    this.browserNoActivityTimeout = 30000;\n    this.processKillTimeout = 2000;\n    this.concurrency = Infinity;\n    this.failOnEmptyTestSuite = true;\n    this.retryLimit = 2;\n    this.detached = false;\n    this.crossOriginAttribute = true;\n    this.browserSocketTimeout = 20000;\n  }\n\n  _createClass(Config, [{\n    key: \"set\",\n    value: function set(newConfig) {\n      _.mergeWith(this, newConfig, function (obj, src) {\n        // Overwrite arrays to keep consistent with #283\n        if (Array.isArray(src)) {\n          return src;\n        }\n      });\n    }\n  }]);\n\n  return Config;\n}();\n\nvar CONFIG_SYNTAX_HELP = '  module.exports = function(config) {\\n' + '    config.set({\\n' + '      // your config\\n' + '    });\\n' + '  };\\n';\n\nfunction parseConfig(configFilePath, cliOptions) {\n  var configModule;\n\n  if (configFilePath) {\n    try {\n      configModule = require(configFilePath);\n\n      if (typeof configModule === 'object' && typeof configModule.default !== 'undefined') {\n        configModule = configModule.default;\n      }\n    } catch (e) {\n      log.error('Error in config file!\\n  ' + e.stack || e);\n      var extension = path.extname(configFilePath);\n\n      if (extension === '.coffee' && !COFFEE_SCRIPT_AVAILABLE) {\n        log.error('You need to install CoffeeScript.\\n  npm install coffeescript --save-dev');\n      } else if (extension === '.ls' && !LIVE_SCRIPT_AVAILABLE) {\n        log.error('You need to install LiveScript.\\n  npm install LiveScript --save-dev');\n      } else if (extension === '.ts' && !TYPE_SCRIPT_AVAILABLE) {\n        log.error('You need to install TypeScript.\\n  npm install typescript ts-node --save-dev');\n      }\n\n      return process.exit(1);\n    }\n\n    if (!helper.isFunction(configModule)) {\n      log.error('Config file must export a function!\\n' + CONFIG_SYNTAX_HELP);\n      return process.exit(1);\n    }\n  } else {\n    configModule = function configModule() {}; // if no config file path is passed, we define a dummy config module.\n\n  }\n\n  var config = new Config(); // save and reset hostname and listenAddress so we can detect if the user\n  // changed them\n\n  var defaultHostname = config.hostname;\n  config.hostname = null;\n  var defaultListenAddress = config.listenAddress;\n  config.listenAddress = null; // add the user's configuration in\n\n  config.set(cliOptions);\n\n  try {\n    configModule(config);\n  } catch (e) {\n    log.error('Error in config file!\\n', e);\n    return process.exit(1);\n  } // merge the config from config file and cliOptions (precedence)\n\n\n  config.set(cliOptions); // if the user changed listenAddress, but didn't set a hostname, warn them\n\n  if (config.hostname === null && config.listenAddress !== null) {\n    log.warn(\"ListenAddress was set to \".concat(config.listenAddress, \" but hostname was left as the default: \") + \"\".concat(defaultHostname, \". If your browsers fail to connect, consider changing the hostname option.\"));\n  } // restore values that weren't overwritten by the user\n\n\n  if (config.hostname === null) {\n    config.hostname = defaultHostname;\n  }\n\n  if (config.listenAddress === null) {\n    config.listenAddress = defaultListenAddress;\n  } // configure the logger as soon as we can\n\n\n  logger.setup(config.logLevel, config.colors, config.loggers);\n  log.debug(configFilePath ? \"Loading config \".concat(configFilePath) : 'No config file specified.');\n  return normalizeConfig(config, configFilePath);\n} // PUBLIC API\n\n\nexports.parseConfig = parseConfig;\nexports.Pattern = Pattern;\nexports.createPatternObject = createPatternObject;\nexports.Config = Config;","map":{"version":3,"sources":["/Users/abdillahihussein/Documents/GitHub/angularProject/node_modules/karma/lib/config.js"],"names":["path","require","assert","logger","log","create","helper","constant","_","COFFEE_SCRIPT_AVAILABLE","LIVE_SCRIPT_AVAILABLE","TYPE_SCRIPT_AVAILABLE","register","e","Pattern","pattern","served","included","watched","nocache","type","isBinary","isDefined","weight","mmPatternWeight","other","mmComparePatternWeights","UrlPattern","url","createPatternObject","isString","isUrlAbsolute","isObject","warn","normalizeUrl","startsWith","endsWith","normalizeUrlRoot","urlRoot","normalizedUrlRoot","normalizeProxyPath","proxyPath","normalizedProxyPath","normalizeConfig","config","configFilePath","basePathResolve","relativePath","basePath","resolve","createPatternMapper","objectPattern","Object","assign","dirname","exclude","push","files","map","customContextFile","customDebugFile","customClientContextFile","normalizeWinPath","upstreamProxy","proxy","hostname","port","protocol","split","match","proxies","prototype","hasOwnProperty","call","singleRun","autoWatch","debug","runInParent","useIframe","reporters","client","args","Array","isArray","browsers","formatError","isFunction","processKillTimeout","isNumber","browserSocketTimeout","pingTimeout","defaultClient","keys","forEach","key","option","preprocessors","normalizedPreprocessors","normalizedPattern","module","hasSomeInlinedPlugin","types","definitions","ucFirst","name","definition","base","token","locals","injector","plugin","createChild","get","displayName","plugins","Config","LOG_DISABLE","LOG_ERROR","LOG_WARN","LOG_INFO","LOG_DEBUG","frameworks","DEFAULT_PORT","listenAddress","DEFAULT_LISTEN_ADDR","DEFAULT_HOSTNAME","httpsServerConfig","browserConsoleLogOptions","level","format","terminal","logLevel","colors","autoWatchBatchDelay","restartOnFileChange","usePolling","process","platform","captureTimeout","proxyValidateSSL","preprocessor_priority","undefined","reportSlowerThan","loggers","CONSOLE_APPENDER","transports","forceJSONP","captureConsole","clearContext","browserDisconnectTimeout","browserDisconnectTolerance","browserNoActivityTimeout","concurrency","Infinity","failOnEmptyTestSuite","retryLimit","detached","crossOriginAttribute","newConfig","mergeWith","obj","src","CONFIG_SYNTAX_HELP","parseConfig","cliOptions","configModule","default","error","stack","extension","extname","exit","defaultHostname","defaultListenAddress","set","setup","exports"],"mappings":"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","sourcesContent":["'use strict'\n\nconst path = require('path')\nconst assert = require('assert')\n\nconst logger = require('./logger')\nconst log = logger.create('config')\nconst helper = require('./helper')\nconst constant = require('./constants')\n\nconst _ = require('lodash')\n\nlet COFFEE_SCRIPT_AVAILABLE = false\nlet LIVE_SCRIPT_AVAILABLE = false\nlet TYPE_SCRIPT_AVAILABLE = false\n\ntry {\n  require('coffeescript').register()\n  COFFEE_SCRIPT_AVAILABLE = true\n} catch (e) {}\n\n// LiveScript is required here to enable config files written in LiveScript.\n// It's not directly used in this file.\ntry {\n  require('LiveScript')\n  LIVE_SCRIPT_AVAILABLE = true\n} catch (e) {}\n\ntry {\n  require('ts-node').register()\n  TYPE_SCRIPT_AVAILABLE = true\n} catch (e) {}\n\nclass Pattern {\n  constructor (pattern, served, included, watched, nocache, type, isBinary) {\n    this.pattern = pattern\n    this.served = helper.isDefined(served) ? served : true\n    this.included = helper.isDefined(included) ? included : true\n    this.watched = helper.isDefined(watched) ? watched : true\n    this.nocache = helper.isDefined(nocache) ? nocache : false\n    this.weight = helper.mmPatternWeight(pattern)\n    this.type = type\n    this.isBinary = isBinary\n  }\n\n  compare (other) {\n    return helper.mmComparePatternWeights(this.weight, other.weight)\n  }\n}\n\nclass UrlPattern extends Pattern {\n  constructor (url, type) {\n    super(url, false, true, false, false, type)\n  }\n}\n\nfunction createPatternObject (pattern) {\n  if (pattern && helper.isString(pattern)) {\n    return helper.isUrlAbsolute(pattern)\n      ? new UrlPattern(pattern)\n      : new Pattern(pattern)\n  } else if (helper.isObject(pattern) && pattern.pattern && helper.isString(pattern.pattern)) {\n    return helper.isUrlAbsolute(pattern.pattern)\n      ? new UrlPattern(pattern.pattern, pattern.type)\n      : new Pattern(pattern.pattern, pattern.served, pattern.included, pattern.watched, pattern.nocache, pattern.type)\n  } else {\n    log.warn(`Invalid pattern ${pattern}!\\n\\tExpected string or object with \"pattern\" property.`)\n    return new Pattern(null, false, false, false, false)\n  }\n}\n\nfunction normalizeUrl (url) {\n  if (!url.startsWith('/')) {\n    url = `/${url}`\n  }\n\n  if (!url.endsWith('/')) {\n    url = url + '/'\n  }\n\n  return url\n}\n\nfunction normalizeUrlRoot (urlRoot) {\n  const normalizedUrlRoot = normalizeUrl(urlRoot)\n\n  if (normalizedUrlRoot !== urlRoot) {\n    log.warn(`urlRoot normalized to \"${normalizedUrlRoot}\"`)\n  }\n\n  return normalizedUrlRoot\n}\n\nfunction normalizeProxyPath (proxyPath) {\n  const normalizedProxyPath = normalizeUrl(proxyPath)\n\n  if (normalizedProxyPath !== proxyPath) {\n    log.warn(`proxyPath normalized to \"${normalizedProxyPath}\"`)\n  }\n\n  return normalizedProxyPath\n}\n\nfunction normalizeConfig (config, configFilePath) {\n  function basePathResolve (relativePath) {\n    if (helper.isUrlAbsolute(relativePath)) {\n      return relativePath\n    } else if (helper.isDefined(config.basePath) && helper.isDefined(relativePath)) {\n      return path.resolve(config.basePath, relativePath)\n    } else {\n      return ''\n    }\n  }\n\n  function createPatternMapper (resolve) {\n    return (objectPattern) => Object.assign(objectPattern, { pattern: resolve(objectPattern.pattern) })\n  }\n\n  if (helper.isString(configFilePath)) {\n    config.basePath = path.resolve(path.dirname(configFilePath), config.basePath) // resolve basePath\n    config.exclude.push(configFilePath) // always ignore the config file itself\n  } else {\n    config.basePath = path.resolve(config.basePath || '.')\n  }\n\n  config.files = config.files.map(createPatternObject).map(createPatternMapper(basePathResolve))\n  config.exclude = config.exclude.map(basePathResolve)\n  config.customContextFile = config.customContextFile && basePathResolve(config.customContextFile)\n  config.customDebugFile = config.customDebugFile && basePathResolve(config.customDebugFile)\n  config.customClientContextFile = config.customClientContextFile && basePathResolve(config.customClientContextFile)\n\n  // normalize paths on windows\n  config.basePath = helper.normalizeWinPath(config.basePath)\n  config.files = config.files.map(createPatternMapper(helper.normalizeWinPath))\n  config.exclude = config.exclude.map(helper.normalizeWinPath)\n  config.customContextFile = helper.normalizeWinPath(config.customContextFile)\n  config.customDebugFile = helper.normalizeWinPath(config.customDebugFile)\n  config.customClientContextFile = helper.normalizeWinPath(config.customClientContextFile)\n\n  // normalize urlRoot\n  config.urlRoot = normalizeUrlRoot(config.urlRoot)\n\n  // normalize and default upstream proxy settings if given\n  if (config.upstreamProxy) {\n    const proxy = config.upstreamProxy\n    proxy.path = helper.isDefined(proxy.path) ? normalizeProxyPath(proxy.path) : '/'\n    proxy.hostname = helper.isDefined(proxy.hostname) ? proxy.hostname : 'localhost'\n    proxy.port = helper.isDefined(proxy.port) ? proxy.port : 9875\n\n    // force protocol to end with ':'\n    proxy.protocol = (proxy.protocol || 'http').split(':')[0] + ':'\n    if (proxy.protocol.match(/https?:/) === null) {\n      log.warn(`\"${proxy.protocol}\" is not a supported upstream proxy protocol, defaulting to \"http:\"`)\n      proxy.protocol = 'http:'\n    }\n  }\n\n  // force protocol to end with ':'\n  config.protocol = (config.protocol || 'http').split(':')[0] + ':'\n  if (config.protocol.match(/https?:/) === null) {\n    log.warn(`\"${config.protocol}\" is not a supported protocol, defaulting to \"http:\"`)\n    config.protocol = 'http:'\n  }\n\n  if (config.proxies && Object.prototype.hasOwnProperty.call(config.proxies, config.urlRoot)) {\n    log.warn(`\"${config.urlRoot}\" is proxied, you should probably change urlRoot to avoid conflicts`)\n  }\n\n  if (config.singleRun && config.autoWatch) {\n    log.debug('autoWatch set to false, because of singleRun')\n    config.autoWatch = false\n  }\n\n  if (config.runInParent) {\n    log.debug('useIframe set to false, because using runInParent')\n    config.useIframe = false\n  }\n\n  if (!config.singleRun && !config.useIframe && config.runInParent) {\n    log.debug('singleRun set to true, because using runInParent')\n    config.singleRun = true\n  }\n\n  if (helper.isString(config.reporters)) {\n    config.reporters = config.reporters.split(',')\n  }\n\n  if (config.client && config.client.args) {\n    assert(Array.isArray(config.client.args), 'Invalid configuration: client.args must be an array of strings')\n  }\n\n  if (config.browsers) {\n    assert(Array.isArray(config.browsers), 'Invalid configuration: browsers option must be an array')\n  }\n\n  if (config.formatError) {\n    assert(helper.isFunction(config.formatError), 'Invalid configuration: formatError option must be a function.')\n  }\n\n  if (config.processKillTimeout) {\n    assert(helper.isNumber(config.processKillTimeout), 'Invalid configuration: processKillTimeout option must be a number.')\n  }\n\n  if (config.browserSocketTimeout) {\n    assert(helper.isNumber(config.browserSocketTimeout), 'Invalid configuration: browserSocketTimeout option must be a number.')\n  }\n\n  if (config.pingTimeout) {\n    assert(helper.isNumber(config.pingTimeout), 'Invalid configuration: pingTimeout option must be a number.')\n  }\n\n  const defaultClient = config.defaultClient || {}\n  Object.keys(defaultClient).forEach(function (key) {\n    const option = config.client[key]\n    config.client[key] = helper.isDefined(option) ? option : defaultClient[key]\n  })\n\n  // normalize preprocessors\n  const preprocessors = config.preprocessors || {}\n  const normalizedPreprocessors = config.preprocessors = Object.create(null)\n\n  Object.keys(preprocessors).forEach(function (pattern) {\n    const normalizedPattern = helper.normalizeWinPath(basePathResolve(pattern))\n\n    normalizedPreprocessors[normalizedPattern] = helper.isString(preprocessors[pattern])\n      ? [preprocessors[pattern]] : preprocessors[pattern]\n  })\n\n  // define custom launchers/preprocessors/reporters - create an inlined plugin\n  const module = Object.create(null)\n  let hasSomeInlinedPlugin = false\n  const types = ['launcher', 'preprocessor', 'reporter']\n\n  types.forEach(function (type) {\n    const definitions = config[`custom${helper.ucFirst(type)}s`] || {}\n\n    Object.keys(definitions).forEach(function (name) {\n      const definition = definitions[name]\n\n      if (!helper.isObject(definition)) {\n        return log.warn(`Can not define ${type} ${name}. Definition has to be an object.`)\n      }\n\n      if (!helper.isString(definition.base)) {\n        return log.warn(`Can not define ${type} ${name}. Missing base ${type}.`)\n      }\n\n      const token = type + ':' + definition.base\n      const locals = {\n        args: ['value', definition]\n      }\n\n      module[type + ':' + name] = ['factory', function (injector) {\n        const plugin = injector.createChild([locals], [token]).get(token)\n        if (type === 'launcher' && helper.isDefined(definition.displayName)) {\n          plugin.displayName = definition.displayName\n        }\n        return plugin\n      }]\n      hasSomeInlinedPlugin = true\n    })\n  })\n\n  if (hasSomeInlinedPlugin) {\n    config.plugins.push(module)\n  }\n\n  return config\n}\n\nclass Config {\n  constructor () {\n    this.LOG_DISABLE = constant.LOG_DISABLE\n    this.LOG_ERROR = constant.LOG_ERROR\n    this.LOG_WARN = constant.LOG_WARN\n    this.LOG_INFO = constant.LOG_INFO\n    this.LOG_DEBUG = constant.LOG_DEBUG\n\n    // DEFAULT CONFIG\n    this.frameworks = []\n    this.protocol = 'http:'\n    this.port = constant.DEFAULT_PORT\n    this.listenAddress = constant.DEFAULT_LISTEN_ADDR\n    this.hostname = constant.DEFAULT_HOSTNAME\n    this.httpsServerConfig = {}\n    this.basePath = ''\n    this.files = []\n    this.browserConsoleLogOptions = {\n      level: 'debug',\n      format: '%b %T: %m',\n      terminal: true\n    }\n    this.customContextFile = null\n    this.customDebugFile = null\n    this.customClientContextFile = null\n    this.exclude = []\n    this.logLevel = constant.LOG_INFO\n    this.colors = true\n    this.autoWatch = true\n    this.autoWatchBatchDelay = 250\n    this.restartOnFileChange = false\n    this.usePolling = process.platform === 'linux'\n    this.reporters = ['progress']\n    this.singleRun = false\n    this.browsers = []\n    this.captureTimeout = 60000\n    this.pingTimeout = 5000\n    this.proxies = {}\n    this.proxyValidateSSL = true\n    this.preprocessors = {}\n    this.preprocessor_priority = {}\n    this.urlRoot = '/'\n    this.upstreamProxy = undefined\n    this.reportSlowerThan = 0\n    this.loggers = [constant.CONSOLE_APPENDER]\n    this.transports = ['polling', 'websocket']\n    this.forceJSONP = false\n    this.plugins = ['karma-*']\n    this.defaultClient = this.client = {\n      args: [],\n      useIframe: true,\n      runInParent: false,\n      captureConsole: true,\n      clearContext: true\n    }\n    this.browserDisconnectTimeout = 2000\n    this.browserDisconnectTolerance = 0\n    this.browserNoActivityTimeout = 30000\n    this.processKillTimeout = 2000\n    this.concurrency = Infinity\n    this.failOnEmptyTestSuite = true\n    this.retryLimit = 2\n    this.detached = false\n    this.crossOriginAttribute = true\n    this.browserSocketTimeout = 20000\n  }\n\n  set (newConfig) {\n    _.mergeWith(this, newConfig, (obj, src) => {\n      // Overwrite arrays to keep consistent with #283\n      if (Array.isArray(src)) {\n        return src\n      }\n    })\n  }\n}\n\nconst CONFIG_SYNTAX_HELP = '  module.exports = function(config) {\\n' +\n  '    config.set({\\n' +\n  '      // your config\\n' +\n  '    });\\n' +\n  '  };\\n'\n\nfunction parseConfig (configFilePath, cliOptions) {\n  let configModule\n  if (configFilePath) {\n    try {\n      configModule = require(configFilePath)\n      if (typeof configModule === 'object' && typeof configModule.default !== 'undefined') {\n        configModule = configModule.default\n      }\n    } catch (e) {\n      log.error('Error in config file!\\n  ' + e.stack || e)\n\n      const extension = path.extname(configFilePath)\n      if (extension === '.coffee' && !COFFEE_SCRIPT_AVAILABLE) {\n        log.error('You need to install CoffeeScript.\\n  npm install coffeescript --save-dev')\n      } else if (extension === '.ls' && !LIVE_SCRIPT_AVAILABLE) {\n        log.error('You need to install LiveScript.\\n  npm install LiveScript --save-dev')\n      } else if (extension === '.ts' && !TYPE_SCRIPT_AVAILABLE) {\n        log.error('You need to install TypeScript.\\n  npm install typescript ts-node --save-dev')\n      }\n      return process.exit(1)\n    }\n    if (!helper.isFunction(configModule)) {\n      log.error('Config file must export a function!\\n' + CONFIG_SYNTAX_HELP)\n      return process.exit(1)\n    }\n  } else {\n    configModule = () => {} // if no config file path is passed, we define a dummy config module.\n  }\n\n  const config = new Config()\n\n  // save and reset hostname and listenAddress so we can detect if the user\n  // changed them\n  const defaultHostname = config.hostname\n  config.hostname = null\n  const defaultListenAddress = config.listenAddress\n  config.listenAddress = null\n\n  // add the user's configuration in\n  config.set(cliOptions)\n\n  try {\n    configModule(config)\n  } catch (e) {\n    log.error('Error in config file!\\n', e)\n    return process.exit(1)\n  }\n\n  // merge the config from config file and cliOptions (precedence)\n  config.set(cliOptions)\n\n  // if the user changed listenAddress, but didn't set a hostname, warn them\n  if (config.hostname === null && config.listenAddress !== null) {\n    log.warn(`ListenAddress was set to ${config.listenAddress} but hostname was left as the default: ` +\n      `${defaultHostname}. If your browsers fail to connect, consider changing the hostname option.`)\n  }\n  // restore values that weren't overwritten by the user\n  if (config.hostname === null) {\n    config.hostname = defaultHostname\n  }\n  if (config.listenAddress === null) {\n    config.listenAddress = defaultListenAddress\n  }\n\n  // configure the logger as soon as we can\n  logger.setup(config.logLevel, config.colors, config.loggers)\n\n  log.debug(configFilePath ? `Loading config ${configFilePath}` : 'No config file specified.')\n\n  return normalizeConfig(config, configFilePath)\n}\n\n// PUBLIC API\nexports.parseConfig = parseConfig\nexports.Pattern = Pattern\nexports.createPatternObject = createPatternObject\nexports.Config = Config\n"]},"metadata":{},"sourceType":"script"}