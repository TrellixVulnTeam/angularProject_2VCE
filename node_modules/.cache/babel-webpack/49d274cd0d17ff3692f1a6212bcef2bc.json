{"ast":null,"code":"\"use strict\";\n/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nvar _regeneratorRuntime = require(\"/Users/abdillahihussein/Documents/GitHub/angularProject/node_modules/@babel/runtime/regenerator\");\n\nvar _createForOfIteratorHelper = require(\"/Users/abdillahihussein/Documents/GitHub/angularProject/node_modules/@babel/runtime/helpers/createForOfIteratorHelper\");\n\nvar _toConsumableArray = require(\"/Users/abdillahihussein/Documents/GitHub/angularProject/node_modules/@babel/runtime/helpers/toConsumableArray\");\n\nvar _asyncToGenerator = require(\"/Users/abdillahihussein/Documents/GitHub/angularProject/node_modules/@babel/runtime/helpers/asyncToGenerator\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.augmentIndexHtml = void 0;\n\nvar crypto_1 = require(\"crypto\");\n\nvar html_rewriting_stream_1 = require(\"./html-rewriting-stream\");\n/*\n * Helper function used by the IndexHtmlWebpackPlugin.\n * Can also be directly used by builder, e. g. in order to generate an index.html\n * after processing several configurations in order to build different sets of\n * bundles for differential serving.\n */\n\n\nfunction augmentIndexHtml(_x) {\n  return _augmentIndexHtml.apply(this, arguments);\n}\n\nfunction _augmentIndexHtml() {\n  _augmentIndexHtml = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(params) {\n    var loadOutputFile, files, _params$noModuleFiles, noModuleFiles, _params$moduleFiles, moduleFiles, entrypoints, sri, _params$deployUrl, deployUrl, lang, baseHref, inputContent, _params$crossOrigin, crossOrigin, stylesheets, scripts, mergedFiles, _iterator, _step, entrypoint, _iterator6, _step6, _step6$value, extension, file, name, scriptTags, _iterator2, _step2, _loop, linkTags, _iterator3, _step3, stylesheet, attrs, _content2, _yield$html_rewriting, rewriter, transformedContent, baseTagExists, content;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            loadOutputFile = params.loadOutputFile, files = params.files, _params$noModuleFiles = params.noModuleFiles, noModuleFiles = _params$noModuleFiles === void 0 ? [] : _params$noModuleFiles, _params$moduleFiles = params.moduleFiles, moduleFiles = _params$moduleFiles === void 0 ? [] : _params$moduleFiles, entrypoints = params.entrypoints, sri = params.sri, _params$deployUrl = params.deployUrl, deployUrl = _params$deployUrl === void 0 ? '' : _params$deployUrl, lang = params.lang, baseHref = params.baseHref, inputContent = params.inputContent;\n            _params$crossOrigin = params.crossOrigin, crossOrigin = _params$crossOrigin === void 0 ? 'none' : _params$crossOrigin;\n\n            if (sri && crossOrigin === 'none') {\n              crossOrigin = 'anonymous';\n            }\n\n            stylesheets = new Set();\n            scripts = new Set(); // Sort files in the order we want to insert them by entrypoint and dedupes duplicates\n\n            mergedFiles = [].concat(_toConsumableArray(moduleFiles), _toConsumableArray(noModuleFiles), _toConsumableArray(files));\n            _iterator = _createForOfIteratorHelper(entrypoints);\n            _context2.prev = 7;\n\n            _iterator.s();\n\n          case 9:\n            if ((_step = _iterator.n()).done) {\n              _context2.next = 37;\n              break;\n            }\n\n            entrypoint = _step.value;\n            _iterator6 = _createForOfIteratorHelper(mergedFiles);\n            _context2.prev = 12;\n\n            _iterator6.s();\n\n          case 14:\n            if ((_step6 = _iterator6.n()).done) {\n              _context2.next = 27;\n              break;\n            }\n\n            _step6$value = _step6.value, extension = _step6$value.extension, file = _step6$value.file, name = _step6$value.name;\n\n            if (!(name !== entrypoint)) {\n              _context2.next = 18;\n              break;\n            }\n\n            return _context2.abrupt(\"continue\", 25);\n\n          case 18:\n            _context2.t0 = extension;\n            _context2.next = _context2.t0 === '.js' ? 21 : _context2.t0 === '.css' ? 23 : 25;\n            break;\n\n          case 21:\n            scripts.add(file);\n            return _context2.abrupt(\"break\", 25);\n\n          case 23:\n            stylesheets.add(file);\n            return _context2.abrupt(\"break\", 25);\n\n          case 25:\n            _context2.next = 14;\n            break;\n\n          case 27:\n            _context2.next = 32;\n            break;\n\n          case 29:\n            _context2.prev = 29;\n            _context2.t1 = _context2[\"catch\"](12);\n\n            _iterator6.e(_context2.t1);\n\n          case 32:\n            _context2.prev = 32;\n\n            _iterator6.f();\n\n            return _context2.finish(32);\n\n          case 35:\n            _context2.next = 9;\n            break;\n\n          case 37:\n            _context2.next = 42;\n            break;\n\n          case 39:\n            _context2.prev = 39;\n            _context2.t2 = _context2[\"catch\"](7);\n\n            _iterator.e(_context2.t2);\n\n          case 42:\n            _context2.prev = 42;\n\n            _iterator.f();\n\n            return _context2.finish(42);\n\n          case 45:\n            scriptTags = [];\n            _iterator2 = _createForOfIteratorHelper(scripts);\n            _context2.prev = 47;\n            _loop = /*#__PURE__*/_regeneratorRuntime.mark(function _loop() {\n              var script, attrs, scriptPredictor, isNoModuleType, isModuleType, _content;\n\n              return _regeneratorRuntime.wrap(function _loop$(_context) {\n                while (1) {\n                  switch (_context.prev = _context.next) {\n                    case 0:\n                      script = _step2.value;\n                      attrs = [\"src=\\\"\".concat(deployUrl).concat(script, \"\\\"\")];\n\n                      if (crossOrigin !== 'none') {\n                        attrs.push(\"crossorigin=\\\"\".concat(crossOrigin, \"\\\"\"));\n                      } // We want to include nomodule or module when a file is not common amongs all\n                      // such as runtime.js\n\n\n                      scriptPredictor = function scriptPredictor(_ref) {\n                        var file = _ref.file;\n                        return file === script;\n                      };\n\n                      if (!files.some(scriptPredictor)) {\n                        // in some cases for differential loading file with the same name is available in both\n                        // nomodule and module such as scripts.js\n                        // we shall not add these attributes if that's the case\n                        isNoModuleType = noModuleFiles.some(scriptPredictor);\n                        isModuleType = moduleFiles.some(scriptPredictor);\n\n                        if (isNoModuleType && !isModuleType) {\n                          attrs.push('nomodule', 'defer');\n                        } else if (isModuleType && !isNoModuleType) {\n                          attrs.push('type=\"module\"');\n                        } else {\n                          attrs.push('defer');\n                        }\n                      } else {\n                        attrs.push('defer');\n                      }\n\n                      if (!sri) {\n                        _context.next = 10;\n                        break;\n                      }\n\n                      _context.next = 8;\n                      return loadOutputFile(script);\n\n                    case 8:\n                      _content = _context.sent;\n                      attrs.push(generateSriAttributes(_content));\n\n                    case 10:\n                      scriptTags.push(\"<script \".concat(attrs.join(' '), \"></script>\"));\n\n                    case 11:\n                    case \"end\":\n                      return _context.stop();\n                  }\n                }\n              }, _loop);\n            });\n\n            _iterator2.s();\n\n          case 50:\n            if ((_step2 = _iterator2.n()).done) {\n              _context2.next = 54;\n              break;\n            }\n\n            return _context2.delegateYield(_loop(), \"t3\", 52);\n\n          case 52:\n            _context2.next = 50;\n            break;\n\n          case 54:\n            _context2.next = 59;\n            break;\n\n          case 56:\n            _context2.prev = 56;\n            _context2.t4 = _context2[\"catch\"](47);\n\n            _iterator2.e(_context2.t4);\n\n          case 59:\n            _context2.prev = 59;\n\n            _iterator2.f();\n\n            return _context2.finish(59);\n\n          case 62:\n            linkTags = [];\n            _iterator3 = _createForOfIteratorHelper(stylesheets);\n            _context2.prev = 64;\n\n            _iterator3.s();\n\n          case 66:\n            if ((_step3 = _iterator3.n()).done) {\n              _context2.next = 78;\n              break;\n            }\n\n            stylesheet = _step3.value;\n            attrs = [\"rel=\\\"stylesheet\\\"\", \"href=\\\"\".concat(deployUrl).concat(stylesheet, \"\\\"\")];\n\n            if (crossOrigin !== 'none') {\n              attrs.push(\"crossorigin=\\\"\".concat(crossOrigin, \"\\\"\"));\n            }\n\n            if (!sri) {\n              _context2.next = 75;\n              break;\n            }\n\n            _context2.next = 73;\n            return loadOutputFile(stylesheet);\n\n          case 73:\n            _content2 = _context2.sent;\n            attrs.push(generateSriAttributes(_content2));\n\n          case 75:\n            linkTags.push(\"<link \".concat(attrs.join(' '), \">\"));\n\n          case 76:\n            _context2.next = 66;\n            break;\n\n          case 78:\n            _context2.next = 83;\n            break;\n\n          case 80:\n            _context2.prev = 80;\n            _context2.t5 = _context2[\"catch\"](64);\n\n            _iterator3.e(_context2.t5);\n\n          case 83:\n            _context2.prev = 83;\n\n            _iterator3.f();\n\n            return _context2.finish(83);\n\n          case 86:\n            _context2.next = 88;\n            return html_rewriting_stream_1.htmlRewritingStream(inputContent);\n\n          case 88:\n            _yield$html_rewriting = _context2.sent;\n            rewriter = _yield$html_rewriting.rewriter;\n            transformedContent = _yield$html_rewriting.transformedContent;\n            baseTagExists = inputContent.includes('<base');\n            rewriter.on('startTag', function (tag) {\n              switch (tag.tagName) {\n                case 'html':\n                  // Adjust document locale if specified\n                  if (isString(lang)) {\n                    updateAttribute(tag, 'lang', lang);\n                  }\n\n                  break;\n\n                case 'head':\n                  // Base href should be added before any link, meta tags\n                  if (!baseTagExists && isString(baseHref)) {\n                    rewriter.emitStartTag(tag);\n                    rewriter.emitRaw(\"<base href=\\\"\".concat(baseHref, \"\\\">\"));\n                    return;\n                  }\n\n                  break;\n\n                case 'base':\n                  // Adjust base href if specified\n                  if (isString(baseHref)) {\n                    updateAttribute(tag, 'href', baseHref);\n                  }\n\n                  break;\n              }\n\n              rewriter.emitStartTag(tag);\n            }).on('endTag', function (tag) {\n              switch (tag.tagName) {\n                case 'head':\n                  var _iterator4 = _createForOfIteratorHelper(linkTags),\n                      _step4;\n\n                  try {\n                    for (_iterator4.s(); !(_step4 = _iterator4.n()).done;) {\n                      var linkTag = _step4.value;\n                      rewriter.emitRaw(linkTag);\n                    }\n                  } catch (err) {\n                    _iterator4.e(err);\n                  } finally {\n                    _iterator4.f();\n                  }\n\n                  linkTags = [];\n                  break;\n\n                case 'body':\n                  // Add script tags\n                  var _iterator5 = _createForOfIteratorHelper(scriptTags),\n                      _step5;\n\n                  try {\n                    for (_iterator5.s(); !(_step5 = _iterator5.n()).done;) {\n                      var scriptTag = _step5.value;\n                      rewriter.emitRaw(scriptTag);\n                    }\n                  } catch (err) {\n                    _iterator5.e(err);\n                  } finally {\n                    _iterator5.f();\n                  }\n\n                  scriptTags = [];\n                  break;\n              }\n\n              rewriter.emitEndTag(tag);\n            });\n            _context2.next = 95;\n            return transformedContent;\n\n          case 95:\n            content = _context2.sent;\n\n            if (!(linkTags.length || scriptTags.length)) {\n              _context2.next = 98;\n              break;\n            }\n\n            return _context2.abrupt(\"return\", linkTags.join('') + scriptTags.join('') + content);\n\n          case 98:\n            return _context2.abrupt(\"return\", content);\n\n          case 99:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee, null, [[7, 39, 42, 45], [12, 29, 32, 35], [47, 56, 59, 62], [64, 80, 83, 86]]);\n  }));\n  return _augmentIndexHtml.apply(this, arguments);\n}\n\nexports.augmentIndexHtml = augmentIndexHtml;\n\nfunction generateSriAttributes(content) {\n  var algo = 'sha384';\n  var hash = crypto_1.createHash(algo).update(content, 'utf8').digest('base64');\n  return \"integrity=\\\"\".concat(algo, \"-\").concat(hash, \"\\\"\");\n}\n\nfunction updateAttribute(tag, name, value) {\n  var index = tag.attrs.findIndex(function (a) {\n    return a.name === name;\n  });\n  var newValue = {\n    name: name,\n    value: value\n  };\n\n  if (index === -1) {\n    tag.attrs.push(newValue);\n  } else {\n    tag.attrs[index] = newValue;\n  }\n}\n\nfunction isString(value) {\n  return typeof value === 'string';\n}","map":{"version":3,"sources":["/Users/abdillahihussein/Documents/GitHub/angularProject/node_modules/@angular-devkit/build-angular/src/utils/index-file/augment-index-html.js"],"names":["Object","defineProperty","exports","value","augmentIndexHtml","crypto_1","require","html_rewriting_stream_1","params","loadOutputFile","files","noModuleFiles","moduleFiles","entrypoints","sri","deployUrl","lang","baseHref","inputContent","crossOrigin","stylesheets","Set","scripts","mergedFiles","entrypoint","extension","file","name","add","scriptTags","script","attrs","push","scriptPredictor","some","isNoModuleType","isModuleType","content","generateSriAttributes","join","linkTags","stylesheet","htmlRewritingStream","rewriter","transformedContent","baseTagExists","includes","on","tag","tagName","isString","updateAttribute","emitStartTag","emitRaw","linkTag","scriptTag","emitEndTag","length","algo","hash","createHash","update","digest","index","findIndex","a","newValue"],"mappings":"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","sourcesContent":["\"use strict\";\n/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.augmentIndexHtml = void 0;\nconst crypto_1 = require(\"crypto\");\nconst html_rewriting_stream_1 = require(\"./html-rewriting-stream\");\n/*\n * Helper function used by the IndexHtmlWebpackPlugin.\n * Can also be directly used by builder, e. g. in order to generate an index.html\n * after processing several configurations in order to build different sets of\n * bundles for differential serving.\n */\nasync function augmentIndexHtml(params) {\n    const { loadOutputFile, files, noModuleFiles = [], moduleFiles = [], entrypoints, sri, deployUrl = '', lang, baseHref, inputContent, } = params;\n    let { crossOrigin = 'none' } = params;\n    if (sri && crossOrigin === 'none') {\n        crossOrigin = 'anonymous';\n    }\n    const stylesheets = new Set();\n    const scripts = new Set();\n    // Sort files in the order we want to insert them by entrypoint and dedupes duplicates\n    const mergedFiles = [...moduleFiles, ...noModuleFiles, ...files];\n    for (const entrypoint of entrypoints) {\n        for (const { extension, file, name } of mergedFiles) {\n            if (name !== entrypoint) {\n                continue;\n            }\n            switch (extension) {\n                case '.js':\n                    scripts.add(file);\n                    break;\n                case '.css':\n                    stylesheets.add(file);\n                    break;\n            }\n        }\n    }\n    let scriptTags = [];\n    for (const script of scripts) {\n        const attrs = [`src=\"${deployUrl}${script}\"`];\n        if (crossOrigin !== 'none') {\n            attrs.push(`crossorigin=\"${crossOrigin}\"`);\n        }\n        // We want to include nomodule or module when a file is not common amongs all\n        // such as runtime.js\n        const scriptPredictor = ({ file }) => file === script;\n        if (!files.some(scriptPredictor)) {\n            // in some cases for differential loading file with the same name is available in both\n            // nomodule and module such as scripts.js\n            // we shall not add these attributes if that's the case\n            const isNoModuleType = noModuleFiles.some(scriptPredictor);\n            const isModuleType = moduleFiles.some(scriptPredictor);\n            if (isNoModuleType && !isModuleType) {\n                attrs.push('nomodule', 'defer');\n            }\n            else if (isModuleType && !isNoModuleType) {\n                attrs.push('type=\"module\"');\n            }\n            else {\n                attrs.push('defer');\n            }\n        }\n        else {\n            attrs.push('defer');\n        }\n        if (sri) {\n            const content = await loadOutputFile(script);\n            attrs.push(generateSriAttributes(content));\n        }\n        scriptTags.push(`<script ${attrs.join(' ')}></script>`);\n    }\n    let linkTags = [];\n    for (const stylesheet of stylesheets) {\n        const attrs = [\n            `rel=\"stylesheet\"`,\n            `href=\"${deployUrl}${stylesheet}\"`,\n        ];\n        if (crossOrigin !== 'none') {\n            attrs.push(`crossorigin=\"${crossOrigin}\"`);\n        }\n        if (sri) {\n            const content = await loadOutputFile(stylesheet);\n            attrs.push(generateSriAttributes(content));\n        }\n        linkTags.push(`<link ${attrs.join(' ')}>`);\n    }\n    const { rewriter, transformedContent } = await html_rewriting_stream_1.htmlRewritingStream(inputContent);\n    const baseTagExists = inputContent.includes('<base');\n    rewriter\n        .on('startTag', tag => {\n        switch (tag.tagName) {\n            case 'html':\n                // Adjust document locale if specified\n                if (isString(lang)) {\n                    updateAttribute(tag, 'lang', lang);\n                }\n                break;\n            case 'head':\n                // Base href should be added before any link, meta tags\n                if (!baseTagExists && isString(baseHref)) {\n                    rewriter.emitStartTag(tag);\n                    rewriter.emitRaw(`<base href=\"${baseHref}\">`);\n                    return;\n                }\n                break;\n            case 'base':\n                // Adjust base href if specified\n                if (isString(baseHref)) {\n                    updateAttribute(tag, 'href', baseHref);\n                }\n                break;\n        }\n        rewriter.emitStartTag(tag);\n    })\n        .on('endTag', tag => {\n        switch (tag.tagName) {\n            case 'head':\n                for (const linkTag of linkTags) {\n                    rewriter.emitRaw(linkTag);\n                }\n                linkTags = [];\n                break;\n            case 'body':\n                // Add script tags\n                for (const scriptTag of scriptTags) {\n                    rewriter.emitRaw(scriptTag);\n                }\n                scriptTags = [];\n                break;\n        }\n        rewriter.emitEndTag(tag);\n    });\n    const content = await transformedContent;\n    if (linkTags.length || scriptTags.length) {\n        // In case no body/head tags are not present (dotnet partial templates)\n        return linkTags.join('') + scriptTags.join('') + content;\n    }\n    return content;\n}\nexports.augmentIndexHtml = augmentIndexHtml;\nfunction generateSriAttributes(content) {\n    const algo = 'sha384';\n    const hash = crypto_1.createHash(algo)\n        .update(content, 'utf8')\n        .digest('base64');\n    return `integrity=\"${algo}-${hash}\"`;\n}\nfunction updateAttribute(tag, name, value) {\n    const index = tag.attrs.findIndex(a => a.name === name);\n    const newValue = { name, value };\n    if (index === -1) {\n        tag.attrs.push(newValue);\n    }\n    else {\n        tag.attrs[index] = newValue;\n    }\n}\nfunction isString(value) {\n    return typeof value === 'string';\n}\n"]},"metadata":{},"sourceType":"script"}