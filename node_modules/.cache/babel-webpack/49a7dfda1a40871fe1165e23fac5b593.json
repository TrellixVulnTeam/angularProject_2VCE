{"ast":null,"code":"\"use strict\";\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) {\n      ar.push(r.value);\n    }\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar __spread = this && this.__spread || function () {\n  for (var ar = [], i = 0; i < arguments.length; i++) {\n    ar = ar.concat(__read(arguments[i]));\n  }\n\n  return ar;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nexports.__esModule = true;\nexports.unique = exports.mergeWithRules = exports.mergeWithCustomize = exports[\"default\"] = exports.merge = exports.CustomizeRule = exports.customizeObject = exports.customizeArray = void 0;\n\nvar wildcard_1 = __importDefault(require(\"wildcard\"));\n\nvar merge_with_1 = __importDefault(require(\"./merge-with\"));\n\nvar join_arrays_1 = __importDefault(require(\"./join-arrays\"));\n\nvar unique_1 = __importDefault(require(\"./unique\"));\n\nexports.unique = unique_1[\"default\"];\n\nvar types_1 = require(\"./types\");\n\nexports.CustomizeRule = types_1.CustomizeRule;\n\nvar utils_1 = require(\"./utils\");\n\nfunction merge(firstConfiguration) {\n  var configurations = [];\n\n  for (var _i = 1; _i < arguments.length; _i++) {\n    configurations[_i - 1] = arguments[_i];\n  }\n\n  return mergeWithCustomize({}).apply(void 0, __spread([firstConfiguration], configurations));\n}\n\nexports.merge = merge;\nexports[\"default\"] = merge;\n\nfunction mergeWithCustomize(options) {\n  return function mergeWithOptions(firstConfiguration) {\n    var configurations = [];\n\n    for (var _i = 1; _i < arguments.length; _i++) {\n      configurations[_i - 1] = arguments[_i];\n    } // No configuration at all\n\n\n    if (!firstConfiguration) {\n      return {};\n    } // @ts-ignore\n\n\n    if (firstConfiguration.then) {\n      throw new TypeError(\"Promises are not supported\");\n    }\n\n    if (configurations.length === 0) {\n      if (Array.isArray(firstConfiguration)) {\n        // Empty array\n        if (firstConfiguration.length === 0) {\n          return {};\n        } // @ts-ignore\n\n\n        if (firstConfiguration[0].then) {\n          throw new TypeError(\"Promises are not supported\");\n        }\n\n        return merge_with_1[\"default\"](firstConfiguration, join_arrays_1[\"default\"](options));\n      }\n\n      return firstConfiguration;\n    }\n\n    return merge_with_1[\"default\"]([firstConfiguration].concat(configurations), join_arrays_1[\"default\"](options));\n  };\n}\n\nexports.mergeWithCustomize = mergeWithCustomize;\n\nfunction customizeArray(rules) {\n  return function (a, b, key) {\n    var matchedRule = Object.keys(rules).find(function (rule) {\n      return wildcard_1[\"default\"](rule, key);\n    }) || \"\";\n\n    if (matchedRule) {\n      switch (rules[matchedRule]) {\n        case types_1.CustomizeRule.Prepend:\n          return __spread(b, a);\n\n        case types_1.CustomizeRule.Replace:\n          return b;\n\n        case types_1.CustomizeRule.Append:\n        default:\n          return __spread(a, b);\n      }\n    }\n  };\n}\n\nexports.customizeArray = customizeArray;\n\nfunction mergeWithRules(rules) {\n  return mergeWithCustomize({\n    customizeArray: function customizeArray(a, b, key) {\n      var currentRule = rules;\n      key.split(\".\").forEach(function (k) {\n        currentRule = currentRule[k];\n      });\n\n      if (utils_1.isPlainObject(currentRule)) {\n        return mergeWithRule({\n          currentRule: currentRule,\n          a: a,\n          b: b\n        });\n      }\n\n      return [];\n    }\n  });\n}\n\nexports.mergeWithRules = mergeWithRules;\nvar isArray = Array.isArray;\n\nfunction mergeWithRule(_a) {\n  var currentRule = _a.currentRule,\n      a = _a.a,\n      b = _a.b;\n\n  if (!isArray(a)) {\n    return a;\n  }\n\n  var bAllMatches = [];\n  var ret = a.map(function (ao) {\n    if (!utils_1.isPlainObject(currentRule)) {\n      return ao;\n    }\n\n    var ret = {};\n    var rulesToMatch = [];\n    var operations = {};\n    Object.entries(currentRule).forEach(function (_a) {\n      var _b = __read(_a, 2),\n          k = _b[0],\n          v = _b[1];\n\n      if (v === types_1.CustomizeRule.Match) {\n        rulesToMatch.push(k);\n      } else {\n        operations[k] = v;\n      }\n    });\n    var bMatches = b.filter(function (o) {\n      var matches = rulesToMatch.every(function (rule) {\n        var _a, _b;\n\n        return ((_a = ao[rule]) === null || _a === void 0 ? void 0 : _a.toString()) === ((_b = o[rule]) === null || _b === void 0 ? void 0 : _b.toString());\n      });\n\n      if (matches) {\n        bAllMatches.push(o);\n      }\n\n      return matches;\n    });\n    Object.entries(ao).forEach(function (_a) {\n      var _b = __read(_a, 2),\n          k = _b[0],\n          v = _b[1];\n\n      var rule = currentRule;\n\n      switch (currentRule[k]) {\n        case types_1.CustomizeRule.Match:\n          ret[k] = v;\n          Object.entries(rule).forEach(function (_a) {\n            var _b = __read(_a, 2),\n                k = _b[0],\n                v = _b[1];\n\n            if (v === types_1.CustomizeRule.Replace && bMatches.length > 0) {\n              var val = last(bMatches)[k];\n\n              if (typeof val !== \"undefined\") {\n                ret[k] = val;\n              }\n            }\n          });\n          break;\n\n        case types_1.CustomizeRule.Append:\n          ret[k] = bMatches.length > 0 ? v.concat(last(bMatches)[k]) : v;\n          break;\n\n        case types_1.CustomizeRule.Prepend:\n          ret[k] = bMatches.length > 0 ? last(bMatches)[k].concat(v) : v;\n          break;\n\n        case types_1.CustomizeRule.Replace:\n          ret[k] = bMatches.length > 0 ? last(bMatches)[k] : v;\n          break;\n\n        default:\n          var currentRule_1 = operations[k]; // Use .flat(); starting from Node 12\n\n          var b_1 = bMatches.map(function (o) {\n            return o[k];\n          }).reduce(function (acc, val) {\n            return isArray(acc) && isArray(val) ? __spread(acc, val) : acc;\n          }, []);\n          ret[k] = mergeWithRule({\n            currentRule: currentRule_1,\n            a: v,\n            b: b_1\n          });\n          break;\n      }\n    });\n    return ret;\n  });\n  return ret.concat(b.filter(function (o) {\n    return !bAllMatches.includes(o);\n  }));\n}\n\nfunction last(arr) {\n  return arr[arr.length - 1];\n}\n\nfunction customizeObject(rules) {\n  return function (a, b, key) {\n    switch (rules[key]) {\n      case types_1.CustomizeRule.Prepend:\n        return merge_with_1[\"default\"]([b, a], join_arrays_1[\"default\"]());\n\n      case types_1.CustomizeRule.Replace:\n        return b;\n\n      case types_1.CustomizeRule.Append:\n        return merge_with_1[\"default\"]([a, b], join_arrays_1[\"default\"]());\n    }\n  };\n}\n\nexports.customizeObject = customizeObject;","map":{"version":3,"sources":["../src/index.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spread = (this && this.__spread) || function () {\n    for (var ar = [], i = 0; i < arguments.length; i++) ar = ar.concat(__read(arguments[i]));\n    return ar;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nexports.__esModule = true;\nexports.unique = exports.mergeWithRules = exports.mergeWithCustomize = exports[\"default\"] = exports.merge = exports.CustomizeRule = exports.customizeObject = exports.customizeArray = void 0;\nvar wildcard_1 = __importDefault(require(\"wildcard\"));\nvar merge_with_1 = __importDefault(require(\"./merge-with\"));\nvar join_arrays_1 = __importDefault(require(\"./join-arrays\"));\nvar unique_1 = __importDefault(require(\"./unique\"));\nexports.unique = unique_1[\"default\"];\nvar types_1 = require(\"./types\");\nexports.CustomizeRule = types_1.CustomizeRule;\nvar utils_1 = require(\"./utils\");\nfunction merge(firstConfiguration) {\n    var configurations = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n        configurations[_i - 1] = arguments[_i];\n    }\n    return mergeWithCustomize({}).apply(void 0, __spread([firstConfiguration], configurations));\n}\nexports.merge = merge;\nexports[\"default\"] = merge;\nfunction mergeWithCustomize(options) {\n    return function mergeWithOptions(firstConfiguration) {\n        var configurations = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            configurations[_i - 1] = arguments[_i];\n        }\n        // No configuration at all\n        if (!firstConfiguration) {\n            return {};\n        }\n        // @ts-ignore\n        if (firstConfiguration.then) {\n            throw new TypeError(\"Promises are not supported\");\n        }\n        if (configurations.length === 0) {\n            if (Array.isArray(firstConfiguration)) {\n                // Empty array\n                if (firstConfiguration.length === 0) {\n                    return {};\n                }\n                // @ts-ignore\n                if (firstConfiguration[0].then) {\n                    throw new TypeError(\"Promises are not supported\");\n                }\n                return merge_with_1[\"default\"](firstConfiguration, join_arrays_1[\"default\"](options));\n            }\n            return firstConfiguration;\n        }\n        return merge_with_1[\"default\"]([firstConfiguration].concat(configurations), join_arrays_1[\"default\"](options));\n    };\n}\nexports.mergeWithCustomize = mergeWithCustomize;\nfunction customizeArray(rules) {\n    return function (a, b, key) {\n        var matchedRule = Object.keys(rules).find(function (rule) { return wildcard_1[\"default\"](rule, key); }) || \"\";\n        if (matchedRule) {\n            switch (rules[matchedRule]) {\n                case types_1.CustomizeRule.Prepend:\n                    return __spread(b, a);\n                case types_1.CustomizeRule.Replace:\n                    return b;\n                case types_1.CustomizeRule.Append:\n                default:\n                    return __spread(a, b);\n            }\n        }\n    };\n}\nexports.customizeArray = customizeArray;\nfunction mergeWithRules(rules) {\n    return mergeWithCustomize({\n        customizeArray: function (a, b, key) {\n            var currentRule = rules;\n            key.split(\".\").forEach(function (k) {\n                currentRule = currentRule[k];\n            });\n            if (utils_1.isPlainObject(currentRule)) {\n                return mergeWithRule({ currentRule: currentRule, a: a, b: b });\n            }\n            return [];\n        }\n    });\n}\nexports.mergeWithRules = mergeWithRules;\nvar isArray = Array.isArray;\nfunction mergeWithRule(_a) {\n    var currentRule = _a.currentRule, a = _a.a, b = _a.b;\n    if (!isArray(a)) {\n        return a;\n    }\n    var bAllMatches = [];\n    var ret = a.map(function (ao) {\n        if (!utils_1.isPlainObject(currentRule)) {\n            return ao;\n        }\n        var ret = {};\n        var rulesToMatch = [];\n        var operations = {};\n        Object.entries(currentRule).forEach(function (_a) {\n            var _b = __read(_a, 2), k = _b[0], v = _b[1];\n            if (v === types_1.CustomizeRule.Match) {\n                rulesToMatch.push(k);\n            }\n            else {\n                operations[k] = v;\n            }\n        });\n        var bMatches = b.filter(function (o) {\n            var matches = rulesToMatch.every(function (rule) { var _a, _b; return ((_a = ao[rule]) === null || _a === void 0 ? void 0 : _a.toString()) === ((_b = o[rule]) === null || _b === void 0 ? void 0 : _b.toString()); });\n            if (matches) {\n                bAllMatches.push(o);\n            }\n            return matches;\n        });\n        Object.entries(ao).forEach(function (_a) {\n            var _b = __read(_a, 2), k = _b[0], v = _b[1];\n            var rule = currentRule;\n            switch (currentRule[k]) {\n                case types_1.CustomizeRule.Match:\n                    ret[k] = v;\n                    Object.entries(rule).forEach(function (_a) {\n                        var _b = __read(_a, 2), k = _b[0], v = _b[1];\n                        if (v === types_1.CustomizeRule.Replace && bMatches.length > 0) {\n                            var val = last(bMatches)[k];\n                            if (typeof val !== \"undefined\") {\n                                ret[k] = val;\n                            }\n                        }\n                    });\n                    break;\n                case types_1.CustomizeRule.Append:\n                    ret[k] =\n                        bMatches.length > 0\n                            ? v.concat(last(bMatches)[k])\n                            : v;\n                    break;\n                case types_1.CustomizeRule.Prepend:\n                    ret[k] = bMatches.length > 0 ? last(bMatches)[k].concat(v) : v;\n                    break;\n                case types_1.CustomizeRule.Replace:\n                    ret[k] = bMatches.length > 0 ? last(bMatches)[k] : v;\n                    break;\n                default:\n                    var currentRule_1 = operations[k];\n                    // Use .flat(); starting from Node 12\n                    var b_1 = bMatches\n                        .map(function (o) { return o[k]; })\n                        .reduce(function (acc, val) {\n                        return isArray(acc) && isArray(val) ? __spread(acc, val) : acc;\n                    }, []);\n                    ret[k] = mergeWithRule({ currentRule: currentRule_1, a: v, b: b_1 });\n                    break;\n            }\n        });\n        return ret;\n    });\n    return ret.concat(b.filter(function (o) { return !bAllMatches.includes(o); }));\n}\nfunction last(arr) {\n    return arr[arr.length - 1];\n}\nfunction customizeObject(rules) {\n    return function (a, b, key) {\n        switch (rules[key]) {\n            case types_1.CustomizeRule.Prepend:\n                return merge_with_1[\"default\"]([b, a], join_arrays_1[\"default\"]());\n            case types_1.CustomizeRule.Replace:\n                return b;\n            case types_1.CustomizeRule.Append:\n                return merge_with_1[\"default\"]([a, b], join_arrays_1[\"default\"]());\n        }\n    };\n}\nexports.customizeObject = customizeObject;\n//# sourceMappingURL=index.js.map"]},"metadata":{},"sourceType":"script"}