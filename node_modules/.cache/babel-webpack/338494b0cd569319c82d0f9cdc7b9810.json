{"ast":null,"code":"/**\n * Copyright (c) 2015-present, Waysact Pty Ltd\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\nvar crypto = require('crypto');\n\nvar path = require('path');\n\nvar webpack = require('webpack'); // eslint-disable-next-line global-require\n\n\nvar ReplaceSource = (webpack.sources || require('webpack-sources')).ReplaceSource;\n\nvar util = require('./util');\n\nvar WebIntegrityJsonpMainTemplatePlugin = require('./jmtp');\n\nvar HtmlWebpackPlugin; // https://www.w3.org/TR/2016/REC-SRI-20160623/#cryptographic-hash-functions\n\nvar standardHashFuncNames = ['sha256', 'sha384', 'sha512'];\n\ntry {\n  // eslint-disable-next-line global-require\n  HtmlWebpackPlugin = require('html-webpack-plugin');\n} catch (e) {\n  if (!(e instanceof Error) || e.code !== 'MODULE_NOT_FOUND') {\n    throw e;\n  }\n}\n\nfunction SubresourceIntegrityPlugin(options) {\n  var useOptions;\n\n  if (options === null || typeof options === 'undefined') {\n    useOptions = {};\n  } else if (typeof options === 'object') {\n    useOptions = options;\n  } else {\n    throw new Error('webpack-subresource-integrity: argument must be an object');\n  }\n\n  this.options = {\n    enabled: true\n  };\n  Object.assign(this.options, useOptions);\n  this.emittedMessages = {};\n  this.assetIntegrity = new Map();\n}\n\nSubresourceIntegrityPlugin.prototype.emitMessage = function emitMessage(messages, message) {\n  messages.push(new Error('webpack-subresource-integrity: ' + message));\n};\n\nSubresourceIntegrityPlugin.prototype.emitMessageOnce = function emitMessageOnce(messages, message) {\n  if (!this.emittedMessages[message]) {\n    this.emittedMessages[message] = true;\n    this.emitMessage(messages, message);\n  }\n};\n\nSubresourceIntegrityPlugin.prototype.warnOnce = function warn(compilation, message) {\n  this.emitMessageOnce(compilation.warnings, message);\n};\n\nSubresourceIntegrityPlugin.prototype.error = function error(compilation, message) {\n  this.emitMessage(compilation.errors, message);\n};\n\nSubresourceIntegrityPlugin.prototype.errorOnce = function error(compilation, message) {\n  this.emitMessageOnce(compilation.errors, message);\n};\n\nSubresourceIntegrityPlugin.prototype.validateOptions = function validateOptions(compilation) {\n  if (this.optionsValidated) {\n    return;\n  }\n\n  this.optionsValidated = true;\n\n  if (this.options.enabled && !compilation.compiler.options.output.crossOriginLoading) {\n    this.warnOnce(compilation, 'SRI requires a cross-origin policy, defaulting to \"anonymous\". ' + 'Set webpack option output.crossOriginLoading to a value other than false ' + 'to make this warning go away. ' + 'See https://w3c.github.io/webappsec-subresource-integrity/#cross-origin-data-leakage');\n  }\n\n  this.validateHashFuncNames(compilation);\n};\n\nSubresourceIntegrityPlugin.prototype.validateHashFuncNames = function validateHashFuncNames(compilation) {\n  if (!Array.isArray(this.options.hashFuncNames)) {\n    this.error(compilation, 'options.hashFuncNames must be an array of hash function names, ' + 'instead got \\'' + this.options.hashFuncNames + '\\'.');\n    this.options.enabled = false;\n  } else if (!this.options.hashFuncNames.every(this.validateHashFuncName.bind(this, compilation))) {\n    this.options.enabled = false;\n  } else {\n    this.warnStandardHashFunc(compilation);\n  }\n};\n\nSubresourceIntegrityPlugin.prototype.warnStandardHashFunc = function warnStandardHashFunc(compilation) {\n  var foundStandardHashFunc = false;\n  var i;\n\n  for (i = 0; i < this.options.hashFuncNames.length; i += 1) {\n    if (standardHashFuncNames.indexOf(this.options.hashFuncNames[i]) >= 0) {\n      foundStandardHashFunc = true;\n    }\n  }\n\n  if (!foundStandardHashFunc) {\n    this.warnOnce(compilation, 'It is recommended that at least one hash function is part of the set ' + 'for which support is mandated by the specification. ' + 'These are: ' + standardHashFuncNames.join(', ') + '. ' + 'See http://www.w3.org/TR/SRI/#cryptographic-hash-functions for more information.');\n  }\n};\n\nSubresourceIntegrityPlugin.prototype.validateHashFuncName = function validateHashFuncName(compilation, hashFuncName) {\n  if (typeof hashFuncName !== 'string' && !(hashFuncName instanceof String)) {\n    this.error(compilation, 'options.hashFuncNames must be an array of hash function names, ' + 'but contained ' + hashFuncName + '.');\n    return false;\n  }\n\n  try {\n    crypto.createHash(hashFuncName);\n  } catch (error) {\n    this.error(compilation, 'Cannot use hash function \\'' + hashFuncName + '\\': ' + error.message);\n    return false;\n  }\n\n  return true;\n};\n/*  Given a public URL path to an asset, as generated by\n *  HtmlWebpackPlugin for use as a `<script src>` or `<link href`> URL\n *  in `index.html`, return the path to the asset, suitable as a key\n *  into `compilation.assets`.\n */\n\n\nSubresourceIntegrityPlugin.prototype.hwpAssetPath = function hwpAssetPath(src) {\n  return path.relative(this.hwpPublicPath, src);\n};\n\nSubresourceIntegrityPlugin.prototype.warnIfHotUpdate = function warnIfHotUpdate(compilation, source) {\n  if (source.indexOf('webpackHotUpdate') >= 0) {\n    this.warnOnce(compilation, 'webpack-subresource-integrity may interfere with hot reloading. ' + 'Consider disabling this plugin in development mode.');\n  }\n};\n\nSubresourceIntegrityPlugin.prototype.replaceAsset = function replaceAsset(assets, hashByChunkId, chunkFile) {\n  var oldSource = assets[chunkFile].source();\n  var newAsset;\n  var magicMarker;\n  var magicMarkerPos;\n  var hashFuncNames = this.options.hashFuncNames;\n  newAsset = new ReplaceSource(assets[chunkFile]);\n  Array.from(hashByChunkId.entries()).forEach(function replaceMagicMarkers(idAndHash) {\n    magicMarker = util.makePlaceholder(hashFuncNames, idAndHash[0]);\n    magicMarkerPos = oldSource.indexOf(magicMarker);\n\n    if (magicMarkerPos >= 0) {\n      newAsset.replace(magicMarkerPos, magicMarkerPos + magicMarker.length - 1, idAndHash[1]);\n    }\n  }); // eslint-disable-next-line no-param-reassign\n\n  assets[chunkFile] = newAsset;\n  newAsset.integrity = util.computeIntegrity(hashFuncNames, newAsset.source());\n  return newAsset;\n};\n\nSubresourceIntegrityPlugin.prototype.processChunk = function processChunk(chunk, compilation, assets) {\n  var _this = this;\n\n  var self = this;\n  var newAsset;\n  var hashByChunkId = new Map();\n  Array.from(util.findChunks(chunk)).reverse().forEach(function (childChunk) {\n    var sourcePath;\n    var files = Array.isArray(childChunk.files) ? new Set(childChunk.files) : childChunk.files; // This can happen with invalid Webpack configurations\n\n    if (files.size === 0) return;\n    sourcePath = compilation.sriChunkAssets[childChunk.id];\n\n    if (!files.has(sourcePath)) {\n      self.warnOnce(compilation, 'Cannot determine asset for chunk ' + childChunk.id + ', computed=\"' + sourcePath + '\", available=' + Array.from(childChunk.files)[0] + '. Please report this full error message ' + 'along with your Webpack configuration at ' + 'https://github.com/waysact/webpack-subresource-integrity/issues/new');\n      sourcePath = Array.from(files)[0];\n    }\n\n    self.warnIfHotUpdate(compilation, assets[sourcePath].source());\n    newAsset = self.replaceAsset(assets, hashByChunkId, sourcePath);\n    hashByChunkId.set(childChunk.id, newAsset.integrity);\n\n    _this.assetIntegrity.set(sourcePath, newAsset.integrity);\n  });\n};\n\nSubresourceIntegrityPlugin.prototype.chunkAsset = function chunkAsset(compilation, chunk, asset) {\n  if (compilation.assets[asset]) {\n    // eslint-disable-next-line no-param-reassign\n    compilation.sriChunkAssets[chunk.id] = asset;\n  }\n};\n\nSubresourceIntegrityPlugin.prototype.statsFactory = function stats(compilation, statsFactory) {\n  var _this2 = this;\n\n  statsFactory.hooks.extract.for(\"asset\").tap('SriPlugin', function (object, asset) {\n    if (_this2.assetIntegrity.has(asset.name)) {\n      // eslint-disable-next-line no-param-reassign\n      object.integrity = String(_this2.assetIntegrity.get(asset.name));\n    }\n  });\n};\n\nSubresourceIntegrityPlugin.prototype.addMissingIntegrityHashes = function addMissingIntegrityHashes(assets) {\n  var self = this;\n  Object.keys(assets).forEach(function loop(assetKey) {\n    var asset = assets[assetKey];\n\n    if (!asset.integrity) {\n      asset.integrity = util.computeIntegrity(self.options.hashFuncNames, asset.source());\n    }\n  });\n};\n/*\n *  Calculate SRI values for each chunk and replace the magic\n *  placeholders by the actual values.\n */\n\n\nSubresourceIntegrityPlugin.prototype.afterOptimizeAssets = function afterOptimizeAssets(compilation, assets) {\n  var self = this;\n  Array.from(compilation.chunks).filter(util.isRuntimeChunk).forEach(function forEachChunk(chunk) {\n    self.processChunk(chunk, compilation, assets);\n  });\n  this.addMissingIntegrityHashes(assets);\n};\n\nSubresourceIntegrityPlugin.prototype.processTag = function processTag(compilation, tag) {\n  var src = this.hwpAssetPath(util.getTagSrc(tag));\n  /* eslint-disable no-param-reassign */\n\n  var integrity = util.getIntegrityChecksumForAsset(compilation.assets, src);\n\n  if (!Object.prototype.hasOwnProperty.call(tag.attributes, \"integrity\")) {\n    tag.attributes.integrity = integrity;\n    tag.attributes.crossorigin = compilation.compiler.options.output.crossOriginLoading || 'anonymous';\n  }\n  /* eslint-enable no-param-reassign */\n\n};\n\nSubresourceIntegrityPlugin.prototype.alterAssetTags = function alterAssetTags(compilation, pluginArgs, callback) {\n  /* html-webpack-plugin has added an event so we can pre-process the html tags before they\n     inject them. This does the work.\n  */\n  var processTag = this.processTag.bind(this, compilation);\n  pluginArgs.head.filter(util.filterTag).forEach(processTag);\n  pluginArgs.body.filter(util.filterTag).forEach(processTag);\n  callback(null, pluginArgs);\n};\n/*  Add jsIntegrity and cssIntegrity properties to pluginArgs, to\n *  go along with js and css properties.  These are later\n *  accessible on `htmlWebpackPlugin.files`.\n */\n\n\nSubresourceIntegrityPlugin.prototype.beforeHtmlGeneration = function beforeHtmlGeneration(compilation, pluginArgs, callback) {\n  var self = this;\n  this.hwpPublicPath = pluginArgs.assets.publicPath;\n  this.addMissingIntegrityHashes(compilation.assets);\n  ['js', 'css'].forEach(function addIntegrity(fileType) {\n    // eslint-disable-next-line no-param-reassign\n    pluginArgs.assets[fileType + 'Integrity'] = pluginArgs.assets[fileType].map(function assetIntegrity(filePath) {\n      return util.getIntegrityChecksumForAsset(compilation.assets, self.hwpAssetPath(filePath));\n    });\n  });\n  callback(null, pluginArgs);\n};\n\nSubresourceIntegrityPlugin.prototype.registerJMTP = function registerJMTP(compilation) {\n  var plugin = new WebIntegrityJsonpMainTemplatePlugin(this, compilation);\n\n  if (plugin.apply) {\n    plugin.apply(compilation.mainTemplate);\n  } else {\n    compilation.mainTemplate.apply(plugin);\n  }\n};\n\nSubresourceIntegrityPlugin.prototype.registerHwpHooks = function registerHwpHooks(alterAssetTags, beforeHtmlGeneration, hwpCompilation) {\n  var self = this;\n\n  if (HtmlWebpackPlugin && HtmlWebpackPlugin.getHooks) {\n    // HtmlWebpackPlugin >= 4\n    HtmlWebpackPlugin.getHooks(hwpCompilation).beforeAssetTagGeneration.tapAsync('sri', this.beforeHtmlGeneration.bind(this, hwpCompilation));\n    HtmlWebpackPlugin.getHooks(hwpCompilation).alterAssetTags.tapAsync('sri', function cb(data, callback) {\n      var processTag = self.processTag.bind(self, hwpCompilation);\n      data.assetTags.scripts.filter(util.filterTag).forEach(processTag);\n      data.assetTags.styles.filter(util.filterTag).forEach(processTag);\n      callback(null, data);\n    });\n  } else if (hwpCompilation.hooks.htmlWebpackPluginAlterAssetTags && hwpCompilation.hooks.htmlWebpackPluginBeforeHtmlGeneration) {\n    // HtmlWebpackPlugin 3\n    hwpCompilation.hooks.htmlWebpackPluginAlterAssetTags.tapAsync('SriPlugin', alterAssetTags);\n    hwpCompilation.hooks.htmlWebpackPluginBeforeHtmlGeneration.tapAsync('SriPlugin', beforeHtmlGeneration);\n  }\n};\n\nSubresourceIntegrityPlugin.prototype.thisCompilation = function thisCompilation(compiler, compilation) {\n  this.validateOptions(compilation);\n\n  if (!this.options.enabled) {\n    return;\n  }\n\n  this.registerJMTP(compilation); // FIXME: refactor into separate per-compilation state\n  // eslint-disable-next-line no-param-reassign\n\n  compilation.sriChunkAssets = {};\n  /*\n   *  html-webpack support:\n   *    Modify the asset tags before webpack injects them for anything with an integrity value.\n   */\n\n  if (compiler.hooks) {\n    this.setupHooks(compiler, compilation);\n  } else {\n    this.setupLegacyHooks(compiler, compilation);\n  }\n};\n\nSubresourceIntegrityPlugin.prototype.setupHooks = function setupHooks(compiler, compilation) {\n  var afterOptimizeAssets = this.afterOptimizeAssets.bind(this, compilation);\n  var beforeChunkAssets = this.beforeChunkAssets.bind(this, compilation);\n  var alterAssetTags = this.alterAssetTags.bind(this, compilation);\n  var beforeHtmlGeneration = this.beforeHtmlGeneration.bind(this, compilation);\n\n  if (compilation.hooks.processAssets) {\n    compilation.hooks.processAssets.tap({\n      name: 'SriPlugin',\n      stage: webpack.Compilation.PROCESS_ASSETS_STAGE_OPTIMIZE_HASH\n    }, afterOptimizeAssets);\n  } else {\n    compilation.hooks.afterOptimizeAssets.tap('SriPlugin', afterOptimizeAssets);\n  }\n\n  compilation.hooks.beforeChunkAssets.tap('SriPlugin', beforeChunkAssets);\n  compiler.hooks.compilation.tap('HtmlWebpackPluginHooks', this.registerHwpHooks.bind(this, alterAssetTags, beforeHtmlGeneration));\n};\n\nSubresourceIntegrityPlugin.prototype.setupLegacyHooks = function setupLegacyHooks(compiler, compilation) {\n  var afterOptimizeAssets = this.afterOptimizeAssets.bind(this, compilation);\n  var beforeChunkAssets = this.beforeChunkAssets.bind(this, compilation);\n  var alterAssetTags = this.alterAssetTags.bind(this, compilation);\n  var beforeHtmlGeneration = this.beforeHtmlGeneration.bind(this, compilation);\n  compilation.plugin('after-optimize-assets', afterOptimizeAssets);\n  compilation.plugin('before-chunk-assets', beforeChunkAssets);\n  compilation.plugin('html-webpack-plugin-alter-asset-tags', alterAssetTags);\n  compilation.plugin('html-webpack-plugin-before-html-generation', beforeHtmlGeneration);\n};\n\nSubresourceIntegrityPlugin.prototype.beforeChunkAssets = function afterPlugins(compilation) {\n  var chunkAsset = this.chunkAsset.bind(this, compilation);\n\n  if (compilation.hooks) {\n    compilation.hooks.chunkAsset.tap('SriPlugin', chunkAsset);\n  } else {\n    compilation.plugin('chunk-asset', chunkAsset);\n  }\n};\n\nSubresourceIntegrityPlugin.prototype.afterPlugins = function afterPlugins(compiler) {\n  var _this3 = this;\n\n  if (compiler.hooks) {\n    compiler.hooks.thisCompilation.tap('SriPlugin', this.thisCompilation.bind(this, compiler));\n    compiler.hooks.compilation.tap(\"DefaultStatsFactoryPlugin\", function (compilation) {\n      if (compilation.hooks.statsFactory) {\n        compilation.hooks.statsFactory.tap('SriPlugin', _this3.statsFactory.bind(_this3, compilation));\n      }\n    });\n  } else {\n    compiler.plugin('this-compilation', this.thisCompilation.bind(this, compiler));\n  }\n};\n\nSubresourceIntegrityPlugin.prototype.apply = function apply(compiler) {\n  if (compiler.hooks) {\n    compiler.hooks.afterPlugins.tap('SriPlugin', this.afterPlugins.bind(this));\n  } else {\n    compiler.plugin('after-plugins', this.afterPlugins.bind(this));\n  }\n};\n\nmodule.exports = SubresourceIntegrityPlugin;","map":{"version":3,"sources":["/Users/abdillahihussein/Documents/GitHub/angularProject/node_modules/webpack-subresource-integrity/index.js"],"names":["crypto","require","path","webpack","ReplaceSource","sources","util","WebIntegrityJsonpMainTemplatePlugin","HtmlWebpackPlugin","standardHashFuncNames","e","Error","code","SubresourceIntegrityPlugin","options","useOptions","enabled","Object","assign","emittedMessages","assetIntegrity","Map","prototype","emitMessage","messages","message","push","emitMessageOnce","warnOnce","warn","compilation","warnings","error","errors","errorOnce","validateOptions","optionsValidated","compiler","output","crossOriginLoading","validateHashFuncNames","Array","isArray","hashFuncNames","every","validateHashFuncName","bind","warnStandardHashFunc","foundStandardHashFunc","i","length","indexOf","join","hashFuncName","String","createHash","hwpAssetPath","src","relative","hwpPublicPath","warnIfHotUpdate","source","replaceAsset","assets","hashByChunkId","chunkFile","oldSource","newAsset","magicMarker","magicMarkerPos","from","entries","forEach","replaceMagicMarkers","idAndHash","makePlaceholder","replace","integrity","computeIntegrity","processChunk","chunk","self","findChunks","reverse","childChunk","sourcePath","files","Set","size","sriChunkAssets","id","has","set","chunkAsset","asset","statsFactory","stats","hooks","extract","for","tap","object","name","get","addMissingIntegrityHashes","keys","loop","assetKey","afterOptimizeAssets","chunks","filter","isRuntimeChunk","forEachChunk","processTag","tag","getTagSrc","getIntegrityChecksumForAsset","hasOwnProperty","call","attributes","crossorigin","alterAssetTags","pluginArgs","callback","head","filterTag","body","beforeHtmlGeneration","publicPath","addIntegrity","fileType","map","filePath","registerJMTP","plugin","apply","mainTemplate","registerHwpHooks","hwpCompilation","getHooks","beforeAssetTagGeneration","tapAsync","cb","data","assetTags","scripts","styles","htmlWebpackPluginAlterAssetTags","htmlWebpackPluginBeforeHtmlGeneration","thisCompilation","setupHooks","setupLegacyHooks","beforeChunkAssets","processAssets","stage","Compilation","PROCESS_ASSETS_STAGE_OPTIMIZE_HASH","afterPlugins","module","exports"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) 2015-present, Waysact Pty Ltd\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nvar crypto = require('crypto');\nvar path = require('path');\nvar webpack = require('webpack');\n// eslint-disable-next-line global-require\nvar ReplaceSource = (webpack.sources || require('webpack-sources')).ReplaceSource;\nvar util = require('./util');\nvar WebIntegrityJsonpMainTemplatePlugin = require('./jmtp');\nvar HtmlWebpackPlugin;\n\n// https://www.w3.org/TR/2016/REC-SRI-20160623/#cryptographic-hash-functions\nvar standardHashFuncNames = ['sha256', 'sha384', 'sha512'];\n\ntry {\n  // eslint-disable-next-line global-require\n  HtmlWebpackPlugin = require('html-webpack-plugin');\n} catch (e) {\n  if (!(e instanceof Error) || e.code !== 'MODULE_NOT_FOUND') {\n    throw e;\n  }\n}\n\nfunction SubresourceIntegrityPlugin(options) {\n  var useOptions;\n  if (options === null || typeof options === 'undefined') {\n    useOptions = {};\n  } else if (typeof options === 'object') {\n    useOptions = options;\n  } else {\n    throw new Error('webpack-subresource-integrity: argument must be an object');\n  }\n\n  this.options = {\n    enabled: true\n  };\n\n  Object.assign(this.options, useOptions);\n\n  this.emittedMessages = {};\n\n  this.assetIntegrity = new Map();\n}\n\nSubresourceIntegrityPlugin.prototype.emitMessage = function emitMessage(messages, message) {\n  messages.push(new Error('webpack-subresource-integrity: ' + message));\n};\n\nSubresourceIntegrityPlugin.prototype.emitMessageOnce = function emitMessageOnce(messages, message) {\n  if (!this.emittedMessages[message]) {\n    this.emittedMessages[message] = true;\n    this.emitMessage(messages, message);\n  }\n};\n\nSubresourceIntegrityPlugin.prototype.warnOnce = function warn(compilation, message) {\n  this.emitMessageOnce(compilation.warnings, message);\n};\n\nSubresourceIntegrityPlugin.prototype.error = function error(compilation, message) {\n  this.emitMessage(compilation.errors, message);\n};\n\nSubresourceIntegrityPlugin.prototype.errorOnce = function error(compilation, message) {\n  this.emitMessageOnce(compilation.errors, message);\n};\n\nSubresourceIntegrityPlugin.prototype.validateOptions = function validateOptions(compilation) {\n  if (this.optionsValidated) {\n    return;\n  }\n  this.optionsValidated = true;\n\n  if (this.options.enabled && !compilation.compiler.options.output.crossOriginLoading) {\n    this.warnOnce(\n      compilation,\n      'SRI requires a cross-origin policy, defaulting to \"anonymous\". ' +\n        'Set webpack option output.crossOriginLoading to a value other than false ' +\n        'to make this warning go away. ' +\n        'See https://w3c.github.io/webappsec-subresource-integrity/#cross-origin-data-leakage'\n    );\n  }\n  this.validateHashFuncNames(compilation);\n};\n\nSubresourceIntegrityPlugin.prototype.validateHashFuncNames =\n  function validateHashFuncNames(compilation) {\n    if (!Array.isArray(this.options.hashFuncNames)) {\n      this.error(\n        compilation,\n        'options.hashFuncNames must be an array of hash function names, ' +\n          'instead got \\'' + this.options.hashFuncNames + '\\'.');\n      this.options.enabled = false;\n    } else if (\n      !this.options.hashFuncNames.every(this.validateHashFuncName.bind(this, compilation))\n    ) {\n      this.options.enabled = false;\n    } else {\n      this.warnStandardHashFunc(compilation);\n    }\n  };\n\nSubresourceIntegrityPlugin.prototype.warnStandardHashFunc =\n  function warnStandardHashFunc(compilation) {\n    var foundStandardHashFunc = false;\n    var i;\n    for (i = 0; i < this.options.hashFuncNames.length; i += 1) {\n      if (standardHashFuncNames.indexOf(this.options.hashFuncNames[i]) >= 0) {\n        foundStandardHashFunc = true;\n      }\n    }\n    if (!foundStandardHashFunc) {\n      this.warnOnce(\n        compilation,\n        'It is recommended that at least one hash function is part of the set ' +\n          'for which support is mandated by the specification. ' +\n          'These are: ' + standardHashFuncNames.join(', ') + '. ' +\n          'See http://www.w3.org/TR/SRI/#cryptographic-hash-functions for more information.');\n    }\n  };\n\nSubresourceIntegrityPlugin.prototype.validateHashFuncName =\n  function validateHashFuncName(compilation, hashFuncName) {\n    if (typeof hashFuncName !== 'string' &&\n        !(hashFuncName instanceof String)) {\n      this.error(\n        compilation,\n        'options.hashFuncNames must be an array of hash function names, ' +\n          'but contained ' + hashFuncName + '.');\n      return false;\n    }\n    try {\n      crypto.createHash(hashFuncName);\n    } catch (error) {\n      this.error(\n        compilation,\n        'Cannot use hash function \\'' + hashFuncName + '\\': ' +\n          error.message);\n      return false;\n    }\n    return true;\n  };\n\n/*  Given a public URL path to an asset, as generated by\n *  HtmlWebpackPlugin for use as a `<script src>` or `<link href`> URL\n *  in `index.html`, return the path to the asset, suitable as a key\n *  into `compilation.assets`.\n */\nSubresourceIntegrityPlugin.prototype.hwpAssetPath = function hwpAssetPath(src) {\n  return path.relative(this.hwpPublicPath, src);\n};\n\nSubresourceIntegrityPlugin.prototype.warnIfHotUpdate = function warnIfHotUpdate(\n  compilation, source\n) {\n  if (source.indexOf('webpackHotUpdate') >= 0) {\n    this.warnOnce(\n      compilation,\n      'webpack-subresource-integrity may interfere with hot reloading. ' +\n        'Consider disabling this plugin in development mode.'\n    );\n  }\n};\n\nSubresourceIntegrityPlugin.prototype.replaceAsset = function replaceAsset(\n  assets,\n  hashByChunkId,\n  chunkFile\n) {\n  var oldSource = assets[chunkFile].source();\n  var newAsset;\n  var magicMarker;\n  var magicMarkerPos;\n  var hashFuncNames = this.options.hashFuncNames;\n\n  newAsset = new ReplaceSource(assets[chunkFile]);\n\n  Array.from(hashByChunkId.entries()).forEach(function replaceMagicMarkers(idAndHash) {\n    magicMarker = util.makePlaceholder(hashFuncNames, idAndHash[0]);\n    magicMarkerPos = oldSource.indexOf(magicMarker);\n    if (magicMarkerPos >= 0) {\n      newAsset.replace(\n        magicMarkerPos,\n        (magicMarkerPos + magicMarker.length) - 1,\n        idAndHash[1]);\n    }\n  });\n\n  // eslint-disable-next-line no-param-reassign\n  assets[chunkFile] = newAsset;\n\n  newAsset.integrity = util.computeIntegrity(hashFuncNames, newAsset.source());\n  return newAsset;\n};\n\nSubresourceIntegrityPlugin.prototype.processChunk = function processChunk(\n  chunk, compilation, assets\n) {\n  var self = this;\n  var newAsset;\n  var hashByChunkId = new Map();\n\n  Array.from(util.findChunks(chunk)).reverse().forEach(childChunk => {\n    var sourcePath;\n    var files = Array.isArray(childChunk.files) ? new Set(childChunk.files) : childChunk.files;\n\n    // This can happen with invalid Webpack configurations\n    if (files.size === 0) return;\n\n    sourcePath = compilation.sriChunkAssets[childChunk.id];\n\n    if (!files.has(sourcePath)) {\n      self.warnOnce(\n        compilation,\n        'Cannot determine asset for chunk ' + childChunk.id + ', computed=\"' + sourcePath +\n          '\", available=' + Array.from(childChunk.files)[0] + '. Please report this full error message ' +\n          'along with your Webpack configuration at ' +\n          'https://github.com/waysact/webpack-subresource-integrity/issues/new'\n      );\n      sourcePath = Array.from(files)[0];\n    }\n\n    self.warnIfHotUpdate(compilation, assets[sourcePath].source());\n    newAsset = self.replaceAsset(assets, hashByChunkId, sourcePath);\n    hashByChunkId.set(childChunk.id, newAsset.integrity);\n    this.assetIntegrity.set(sourcePath, newAsset.integrity);\n  });\n};\n\nSubresourceIntegrityPlugin.prototype.chunkAsset =\n  function chunkAsset(compilation, chunk, asset) {\n    if (compilation.assets[asset]) {\n      // eslint-disable-next-line no-param-reassign\n      compilation.sriChunkAssets[chunk.id] = asset;\n    }\n  };\n\nSubresourceIntegrityPlugin.prototype.statsFactory =\n  function stats(compilation, statsFactory) {\n    statsFactory.hooks.extract.for(\"asset\").tap('SriPlugin', (object, asset) => {\n      if (this.assetIntegrity.has(asset.name)) {\n        // eslint-disable-next-line no-param-reassign\n        object.integrity = String(this.assetIntegrity.get(asset.name));\n      }\n    });\n  };\n\nSubresourceIntegrityPlugin.prototype.addMissingIntegrityHashes =\n  function addMissingIntegrityHashes(assets) {\n    var self = this;\n    Object.keys(assets).forEach(function loop(assetKey) {\n      var asset = assets[assetKey];\n      if (!asset.integrity) {\n        asset.integrity = util.computeIntegrity(self.options.hashFuncNames, asset.source());\n      }\n    });\n  };\n\n/*\n *  Calculate SRI values for each chunk and replace the magic\n *  placeholders by the actual values.\n */\nSubresourceIntegrityPlugin.prototype.afterOptimizeAssets =\n  function afterOptimizeAssets(compilation, assets) {\n    var self = this;\n\n    Array.from(compilation.chunks).filter(util.isRuntimeChunk).forEach(function forEachChunk(chunk) {\n      self.processChunk(chunk, compilation, assets);\n    });\n\n    this.addMissingIntegrityHashes(assets);\n  };\n\nSubresourceIntegrityPlugin.prototype.processTag =\n  function processTag(compilation, tag) {\n    var src = this.hwpAssetPath(util.getTagSrc(tag));\n    /* eslint-disable no-param-reassign */\n    var integrity = util.getIntegrityChecksumForAsset(compilation.assets, src);\n    if (!Object.prototype.hasOwnProperty.call(tag.attributes, \"integrity\")) {\n      tag.attributes.integrity = integrity;\n      tag.attributes.crossorigin = compilation.compiler.options.output.crossOriginLoading || 'anonymous';\n    }\n    /* eslint-enable no-param-reassign */\n  };\n\nSubresourceIntegrityPlugin.prototype.alterAssetTags =\n  function alterAssetTags(compilation, pluginArgs, callback) {\n    /* html-webpack-plugin has added an event so we can pre-process the html tags before they\n       inject them. This does the work.\n    */\n    var processTag = this.processTag.bind(this, compilation);\n    pluginArgs.head.filter(util.filterTag).forEach(processTag);\n    pluginArgs.body.filter(util.filterTag).forEach(processTag);\n    callback(null, pluginArgs);\n  };\n\n\n/*  Add jsIntegrity and cssIntegrity properties to pluginArgs, to\n *  go along with js and css properties.  These are later\n *  accessible on `htmlWebpackPlugin.files`.\n */\nSubresourceIntegrityPlugin.prototype.beforeHtmlGeneration =\n  function beforeHtmlGeneration(compilation, pluginArgs, callback) {\n    var self = this;\n    this.hwpPublicPath = pluginArgs.assets.publicPath;\n    this.addMissingIntegrityHashes(compilation.assets);\n\n    ['js', 'css'].forEach(function addIntegrity(fileType) {\n      // eslint-disable-next-line no-param-reassign\n      pluginArgs.assets[fileType + 'Integrity'] =\n        pluginArgs.assets[fileType].map(function assetIntegrity(filePath) {\n          return util.getIntegrityChecksumForAsset(compilation.assets, self.hwpAssetPath(filePath));\n        });\n    });\n    callback(null, pluginArgs);\n  };\n\nSubresourceIntegrityPlugin.prototype.registerJMTP = function registerJMTP(compilation) {\n  var plugin = new WebIntegrityJsonpMainTemplatePlugin(this, compilation);\n  if (plugin.apply) {\n    plugin.apply(compilation.mainTemplate);\n  } else {\n    compilation.mainTemplate.apply(plugin);\n  }\n};\n\nSubresourceIntegrityPlugin.prototype.registerHwpHooks =\n  function registerHwpHooks(alterAssetTags, beforeHtmlGeneration, hwpCompilation) {\n    var self = this;\n    if (HtmlWebpackPlugin && HtmlWebpackPlugin.getHooks) {\n      // HtmlWebpackPlugin >= 4\n      HtmlWebpackPlugin.getHooks(hwpCompilation).beforeAssetTagGeneration.tapAsync(\n        'sri',\n        this.beforeHtmlGeneration.bind(this, hwpCompilation)\n      );\n\n      HtmlWebpackPlugin.getHooks(hwpCompilation).alterAssetTags.tapAsync(\n        'sri',\n        function cb(data, callback) {\n          var processTag = self.processTag.bind(self, hwpCompilation);\n          data.assetTags.scripts.filter(util.filterTag).forEach(processTag);\n          data.assetTags.styles.filter(util.filterTag).forEach(processTag);\n          callback(null, data);\n        }\n      );\n    } else if (hwpCompilation.hooks.htmlWebpackPluginAlterAssetTags &&\n               hwpCompilation.hooks.htmlWebpackPluginBeforeHtmlGeneration) {\n      // HtmlWebpackPlugin 3\n      hwpCompilation.hooks.htmlWebpackPluginAlterAssetTags.tapAsync('SriPlugin', alterAssetTags);\n      hwpCompilation.hooks.htmlWebpackPluginBeforeHtmlGeneration.tapAsync('SriPlugin', beforeHtmlGeneration);\n    }\n  };\n\nSubresourceIntegrityPlugin.prototype.thisCompilation = function thisCompilation(\n  compiler,\n  compilation\n) {\n  this.validateOptions(compilation);\n\n  if (!this.options.enabled) {\n    return;\n  }\n\n  this.registerJMTP(compilation);\n\n  // FIXME: refactor into separate per-compilation state\n  // eslint-disable-next-line no-param-reassign\n  compilation.sriChunkAssets = {};\n\n  /*\n   *  html-webpack support:\n   *    Modify the asset tags before webpack injects them for anything with an integrity value.\n   */\n  if (compiler.hooks) {\n    this.setupHooks(compiler, compilation);\n  } else {\n    this.setupLegacyHooks(compiler, compilation);\n  }\n};\n\nSubresourceIntegrityPlugin.prototype.setupHooks = function setupHooks(\n  compiler,\n  compilation\n) {\n  var afterOptimizeAssets = this.afterOptimizeAssets.bind(this, compilation);\n  var beforeChunkAssets = this.beforeChunkAssets.bind(this, compilation);\n  var alterAssetTags = this.alterAssetTags.bind(this, compilation);\n  var beforeHtmlGeneration = this.beforeHtmlGeneration.bind(this, compilation);\n\n  if (compilation.hooks.processAssets) {\n    compilation.hooks.processAssets.tap(\n      {\n        name: 'SriPlugin',\n        stage: webpack.Compilation.PROCESS_ASSETS_STAGE_OPTIMIZE_HASH\n      },\n      afterOptimizeAssets\n    );\n  } else {\n    compilation.hooks.afterOptimizeAssets.tap('SriPlugin', afterOptimizeAssets);\n  }\n  compilation.hooks.beforeChunkAssets.tap('SriPlugin', beforeChunkAssets);\n  compiler.hooks.compilation.tap(\n    'HtmlWebpackPluginHooks',\n    this.registerHwpHooks.bind(this, alterAssetTags, beforeHtmlGeneration)\n  );\n};\n\nSubresourceIntegrityPlugin.prototype.setupLegacyHooks = function setupLegacyHooks(\n  compiler,\n  compilation\n) {\n  var afterOptimizeAssets = this.afterOptimizeAssets.bind(this, compilation);\n  var beforeChunkAssets = this.beforeChunkAssets.bind(this, compilation);\n  var alterAssetTags = this.alterAssetTags.bind(this, compilation);\n  var beforeHtmlGeneration = this.beforeHtmlGeneration.bind(this, compilation);\n\n  compilation.plugin('after-optimize-assets', afterOptimizeAssets);\n  compilation.plugin('before-chunk-assets', beforeChunkAssets);\n  compilation.plugin('html-webpack-plugin-alter-asset-tags', alterAssetTags);\n  compilation.plugin(\n    'html-webpack-plugin-before-html-generation',\n    beforeHtmlGeneration\n  );\n};\n\nSubresourceIntegrityPlugin.prototype.beforeChunkAssets = function afterPlugins(compilation) {\n  var chunkAsset = this.chunkAsset.bind(this, compilation);\n  if (compilation.hooks) {\n    compilation.hooks.chunkAsset.tap('SriPlugin', chunkAsset);\n  } else {\n    compilation.plugin('chunk-asset', chunkAsset);\n  }\n};\n\nSubresourceIntegrityPlugin.prototype.afterPlugins = function afterPlugins(compiler) {\n  if (compiler.hooks) {\n    compiler.hooks.thisCompilation.tap('SriPlugin', this.thisCompilation.bind(this, compiler));\n\n    compiler.hooks.compilation.tap(\"DefaultStatsFactoryPlugin\", compilation => {\n      if (compilation.hooks.statsFactory) {\n        compilation.hooks.statsFactory.tap('SriPlugin', this.statsFactory.bind(this, compilation));\n      }\n    });\n\n  } else {\n    compiler.plugin('this-compilation', this.thisCompilation.bind(this, compiler));\n  }\n};\n\nSubresourceIntegrityPlugin.prototype.apply = function apply(compiler) {\n  if (compiler.hooks) {\n    compiler.hooks.afterPlugins.tap('SriPlugin', this.afterPlugins.bind(this));\n  } else {\n    compiler.plugin('after-plugins', this.afterPlugins.bind(this));\n  }\n};\n\nmodule.exports = SubresourceIntegrityPlugin;\n"]},"metadata":{},"sourceType":"script"}